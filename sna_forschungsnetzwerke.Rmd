---
title: "NeFo-Workshops Soziale Netzwerkanalyse"
author: "Jonas Geschke"
date: "2017, 2018"
header-includes:
   - \usepackage{longtable}
output:
  pdf_document:
    toc: yes
  documentclass: article
  html_document:
    toc: yes
  classoption: a4paper
  graphics: yes
---

# Einleitung
Dieses ist das Skript der Netzwerkanalyse zu NeFo auf Grundlage des NeFo-Forschungsatlas und der Teilnehmer-Listen der von NeFo organisierten und initiierten Workshops. Die komplette Netzwerkanalyse ist einsehbar unter
XXX

Links for later:
http://tools.medialab.sciences-po.fr/iwanthue/
http://jfaganuk.github.io/2015/01/24/basic-network-analysis/#centrality-and-power-measures


# Einstellungen

```{r set wd - CHOOSE, eval=FALSE}
# If your working directory is not already specified because you are running this
# script within a project, you will need to use the setwd() function below to set
# the path of your working directory. In order to do this just copy the path
# between the quote signs.
# Please note: The different levels of the path need to be separated by slashes
# ("/"), not by backslashes ("\") which are the windows default.
# 
# setwd("")

#setwd("/Volumes/NO NAME/MfN/Netzwerkanalyse_NeFo/R") # Stick
setwd("Z:/Benutzer/Jonas.Geschke/Netzwerkanalyse_NeFo/R") # Buero

load("Z:/Benutzer/Jonas.Geschke/Netzwerkanalyse_NeFo/R/Netzwerkanalyse_NeFo.RData")
```

```{r install packages - RUN, eval=FALSE}
# Installing required packages if not installed yet
if("statnet" %in% rownames(installed.packages())   == FALSE){
  install.packages("statnet")}
if("network" %in% rownames(installed.packages())   == FALSE){
  install.packages("network")}
if("sna" %in% rownames(installed.packages())   == FALSE){
  install.packages("sna")}
if("igraph" %in% rownames(installed.packages())   == FALSE){
  install.packages("igraph")}
if("xts" %in% rownames(installed.packages())   == FALSE){
  install.packages("xts")}
if("xlsx" %in% rownames(installed.packages())   == FALSE){
  install.packages("xlsx")}
if("dplyr" %in% rownames(installed.packages())   == FALSE){
  install.packages("dplyr")}
if("rgl" %in% rownames(installed.packages())   == FALSE){
  install.packages("rgl")}
if("extrafont" %in% rownames(installed.packages())   == FALSE){
  install.packages("extrafont")}
if("circlize" %in% rownames(installed.packages())   == FALSE){
  install.packages("circlize")}
if("RColorBrewer" %in% rownames(installed.packages())   == FALSE){
  install.packages("RColorBrewer")}
```

```{r set additional functions - RUN, eval=FALSE}
as.numeric.factor <- function(x) {as.numeric(levels(x))[x]}

'%!in%' <- function(x,y)!('%in%'(x,y))

delete.isolates <- function(graph, mode = "all"){
  isolates <- which(degree(graph, mode = mode) == 0)
  delete.vertices(graph, isolates)
}

subset_workshops <- function(Gdata, subset = "all"){
  if (subset == "all"){return(Gdata)}
  else if (subset == "ipbesforen"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS7", "WS20", "WS24", "WS28", "WS31", "WS39")))]
    return(Gdata)}
  else if (subset == "nefo"){
    Gdata <- Gdata_WS[,-c(which(names(Gdata_WS) %in% c("WS24", "WS28", "WS31", "WS39")))]
    return(Gdata)}
  else if (subset == "nefobiodiv"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS8", "WS9", "WS11", "WS12", "WS13", "WS14", "WS19", "WS25", "WS26", "WS30", "WS32", "WS35", "WS36", "WS37", "WS40")))]
    return(Gdata)}
  else if (subset == "nefoipbes"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS7", "WS10", "WS15", "WS16", "WS17", "WS18", "WS20", "WS21", "WS22", "WS23", "WS27", "WS29", "WS33", "WS34", "WS38", "WS41")))]
    return(Gdata)}
  else if (subset == "2010"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS1", "WS4")))]
    return(Gdata)}
  else if (subset == "2011"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))]
    return(Gdata)}
  else if (subset == "2012"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS11", "WS12", "WS13", "WS14")))]
    return(Gdata)}
  else if (subset == "2013"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS15", "WS16", "WS17", "WS18", "WS19", "WS20")))]
    return(Gdata)}
  else if (subset == "2014"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS21", "WS22", "WS23", "WS25")))]
    return(Gdata)}
  else if (subset == "2015"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS26", "WS27")))]
    return(Gdata)}
  else if (subset == "2016"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS29", "WS30")))]
    return(Gdata)}
  else if (subset == "2017"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS32", "WS33", "WS34", "WS35", "WS36")))]
    return(Gdata)}
  else if (subset == "2018"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS37", "WS38", "WS40", "WS41")))]
    return(Gdata)}
  else {print("Please set subset: ipbesforen, nefo, nefobiodiv, nefoipbes, 2010, 2011, 2012, 2103, 2014, 2015, 2016, 2017 or 2018")}
}

create_nodes <- function(Gdata, datatype = "workshops"){
  
############################## WORKSHOPS ##############################
  if (datatype == "workshops"){
  #preparation
  Gdata <- subset(Gdata, Gdata$Land == "Deutschland")
  Gdata <- Gdata[order(Gdata$Inst, Gdata$Name),]
  Gdata$overview <- apply(Gdata[,c(5:ncol(Gdata))], 1, paste, collapse = "-")
  todelete <- paste(replicate((ncol(Gdata)-5), "0"), collapse = "-")
  Gdata <- Gdata[-c(which(Gdata[,ncol(Gdata)] == todelete)),]
  Gdata <- Gdata[,-ncol(Gdata)]
  
  if(any(Gdata$Inst == "Selbstst?ndig")==TRUE){
    selbststaendig_alt <- c(which(Gdata$Inst == "Selbstst?ndig"))
    selbststaendig <- c(1:length(selbststaendig_alt))
    selbststaendig_Gdata <- c(paste("Selbstst?ndig", selbststaendig, sep=" "))
    for (r in selbststaendig_alt){
    Gdata[r,2] <- selbststaendig_Gdata[which(selbststaendig_alt == r)]}
    rm(r)}
  if(any(Gdata$Inst == "keine Angabe")==TRUE){
    keineangabe_alt <- c(which(Gdata$Inst == "keine Angabe"))
    keineangabe <- c(1:length(keineangabe_alt))
    keineangabe_Gdata <- c(paste("keine Angabe", keineangabe, sep=" "))
    for (k in keineangabe_alt){
    Gdata[k,2] <- keineangabe_Gdata[which(keineangabe_alt == k)]}
    rm(k)}
  
  institutions <- c(paste(sort(unique(Gdata$Inst))))
  Gdata_institutions <- Gdata[-c(1:nrow(Gdata)),]
  columnstosum <- c(5:ncol(Gdata))
  
  for (i in institutions){
    inst <- subset(Gdata, Gdata$Inst == i)
    inst <- rbind(inst,
                  c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                    colSums(inst[,-c(1:4)])),
                  stringsAsFactors = FALSE)
    Gdata_institutions <- rbind(Gdata_institutions, inst[nrow(inst),])
  }
  rownames(Gdata_institutions) <- Gdata_institutions[,2] #Inst as rownames
  Gdata_K <- as.character(Gdata_institutions$Kategorie)
  Gdata <- Gdata_institutions[,-c(1:4)]
  Gdata_institutions <- institutions
  rm(inst, i, institutions)
  
  #nodes
  w1 <- colnames(Gdata[1:ncol(Gdata)])
  w2 <- rownames(Gdata)
  w3 <- c(paste("ws", c(1:ncol(Gdata)), sep = ""))
  w4 <- c(paste("inst", c(1:nrow(Gdata)), sep = ""))
  w5 <- c(w3, w4)
  w6 <- c(w1, w2)
  nodes <- as.data.frame(cbind(w5, w6))
  names(nodes) <- c("id", "name")
  nodes$type_no <- NA
  nodes[c(1:ncol(Gdata)),3] <- 1
  nodes[c((ncol(Gdata)+1):nrow(nodes)),3] <- 2
  nodes$type <- NA
  nodes[c(1:ncol(Gdata)),4] <- "workshop"
  nodes[c((ncol(Gdata)+1):nrow(nodes)),4] <- "institution"
  nodes$kategorie <- NA
  nodes[c(1:ncol(Gdata)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] 
                                                                     %in% nodes[c(1:ncol(Gdata)),2])]
  nodes[c((ncol(Gdata)+1):nrow(nodes)),5] <- Gdata_K
  nodes$id <- as.character(nodes$id)
  nodes$name <- as.character(nodes$name)
  
  nodes$name[which(nodes$name %in% selbststaendig_Gdata)] <- "Selbstst?ndig"
  nodes$name[which(nodes$name %in% keineangabe_Gdata)] <- "k.A."
  
  return(nodes)}
  
############################## FORSCHUNGSNETZWERKE ##############################
  else if (datatype == "forschungsnetzwerke"){
    w1 <- colnames(Gdata)
    w2 <- rownames(Gdata)
    w3 <- c(paste("net", c(1:ncol(Gdata)), sep = ""))
    w4 <- c(paste("inst", c(1:nrow(Gdata)), sep = ""))
    
    nodes <- as.data.frame(cbind(w4, w2))
    names(nodes) <- c("id", "name")
    nodes$id <- as.character(nodes$id)
    nodes$name <- as.character(nodes$name)
    
    return(nodes)}
  
############################## ELSE ##############################
    else {print("Please set datatype: workshops or forschungsnetzwerke")}

}

create_links <- function(Gdata, datatype = "workshops"){
  
############################## WORKSHOPS ##############################
  if (datatype == "workshops"){
  #preparation
  Gdata <- subset(Gdata, Gdata$Land == "Deutschland")
  Gdata <- Gdata[order(Gdata$Inst, Gdata$Name),]
  Gdata$overview <- apply(Gdata[,c(5:ncol(Gdata))],1,paste,collapse="-")
  Gdata <- Gdata[-c(which(Gdata$overview == paste(replicate((ncol(Gdata)-5), "0"), collapse = "-"))),]
  Gdata <- Gdata[,-ncol(Gdata)]
  
  selbststaendig_alt <- c(which(Gdata$Inst == "Selbstst?ndig"))
  selbststaendig <- c(1:length(selbststaendig_alt))
  selbststaendig_Gdata <- c(paste("Selbstst?ndig", selbststaendig, sep=" "))
  keineangabe_alt <- c(which(Gdata$Inst == "keine Angabe"))
  keineangabe <- c(1:length(keineangabe_alt))
  keineangabe_Gdata <- c(paste("keine Angabe", keineangabe, sep=" "))
  for (r in selbststaendig_alt){
    Gdata[r,2] <- selbststaendig_Gdata[which(selbststaendig_alt == r)]}
  for (k in keineangabe_alt){
    Gdata[k,2] <- keineangabe_Gdata[which(keineangabe_alt == k)]}
  rm(r, k)
  
  institutions <- c(paste(sort(unique(Gdata$Inst))))
  Gdata_institutions <- Gdata[-c(1:nrow(Gdata)),]
  columnstosum <- c(5:ncol(Gdata))
  
  for (i in institutions){
    inst <- subset(Gdata, Gdata$Inst == i)
    inst <- rbind(inst,
                  c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                    colSums(inst[,-c(1:4)])),
                  stringsAsFactors = FALSE)
    Gdata_institutions <- rbind(Gdata_institutions, inst[nrow(inst),])
  }
  rownames(Gdata_institutions) <- Gdata_institutions[,2] #Inst as rownames
  Gdata_K <- as.character(Gdata_institutions$Kategorie)
  Gdata <- Gdata_institutions[,-c(1:4)]
  Gdata_institutions <- institutions
  rm(inst, i, institutions)
  
  ## links
  columnno <- c(1:ncol(Gdata))
  rowno <- c(1:nrow(Gdata))
  
  links_w <- data.frame(from=character(), to=character(), 
                        network_no=character(), network=character(),
                        stringsAsFactors = FALSE)
   for (c in columnno){
    for (r in rowno){
      if (as.numeric(Gdata[r,c]) == 1) {
        links_w <- rbind(links_w,
                         c(w3[c], w4[r], as.numeric(c), colnames(Gdata)[c]), 
                         stringsAsFactors = FALSE)
      } else {}
    }
  }
  
  colnames(links_w) <- c("links_w_1", "links_w_2", "links_w_3", "links_w_4")
  
  links <- data.frame(from=character(), to=character(), 
                      network_no=character(), network=character(),
                      stringsAsFactors = FALSE)
  
  for(n in columnno){
    subset <- subset(links_w, links_w$links_w_4 == w1[n])
    rowssubset <- c(1:nrow(subset))
    for (r in rowssubset){
      t <- 1
      repeat{
        links <- rbind(links,
                       c(subset[r,2], subset[r+t,2], n, paste(w1[n])),
                       stringsAsFactors = FALSE)
        t <- t+1
        if (t==max(rowssubset)){break}}
    }
  }
  
  colnames(links) <- c("from", "to", "network_no", "network")
  links$network_no <- as.numeric(links$network_no)
  links <- subset(links, !is.na(links$to))
  
  return(links)}
  
############################## FORSCHUNGSNETZWERKE ##############################
    else if (datatype == "forschungsnetzwerke"){
    w1 <- colnames(Gdata)
    w2 <- rownames(Gdata)
    w3 <- c(paste("net", c(1:ncol(Gdata)), sep = ""))
    w4 <- c(paste("inst", c(1:nrow(Gdata)), sep = ""))
      
    columns_Gdata <- c(1:ncol(Gdata))
    rows_Gdata <- c(1:nrow(Gdata))
    
    links_w <- data.frame(from=character(), to=character(), 
                          network_no=character(), network=character(),
                          stringsAsFactors = FALSE)
     for (c in columns_Gdata){
      for (r in rows_Gdata){
        if (as.numeric(Gdata[r,c]) == 1) {
          links_w <- rbind(links_w,
                           c(w3[c], w4[r], as.numeric(c), colnames(Gdata)[c]), 
                           stringsAsFactors = FALSE)
        } else {}
      }
    }
    
    colnames(links_w) <- c("links_w_1", "links_w_2", "links_w_3", "links_w_4")
    
    links <- data.frame(from=character(), to=character(), 
                        network_no=character(), network=character(),
                        stringsAsFactors = FALSE)
    
    for(n in columns_Gdata){
      subset <- subset(links_w, links_w$links_w_4 == w1[n])
      rowssubset <- c(1:nrow(subset))
      for (r in rowssubset){
        t <- 1
        repeat{
          links <- rbind(links,
                         c(subset[r,2], subset[r+t,2], n, paste(w1[n])),
                         stringsAsFactors = FALSE)
          t <- t+1
          if (t==max(rowssubset)){break}}
      }
    }
    
    colnames(links) <- c("from", "to", "network_no", "network")
    links$network_no <- as.numeric(links$network_no)
    links <- subset(links, !is.na(links$to))
    
    return(links)}
  
############################## ELSE ##############################
    else {print("Please set datatype: workshops or forschungsnetzwerke")}
}
```


# Forschungsnetzwerke

```{r Laden der Rohdaten und Vorbereitung der Daten, eval=FALSE}
## Load raw data
Raw_forschungsnetzwerk <- read.csv2("Daten/forschungsnetzwerk.csv", sep=",", dec=".", header=T, encoding="UTF-8")

## Prepare dataset "FN"
Gdata_FN <- Raw_forschungsnetzwerk
names(Gdata_FN) <- c("inst", "abbr", "BeGenDiv", "BBIB", "BioFrankfurt", "BION", "iDiv", "Ecornet", "FVB", "GBIF-D", "GFBIO", "HIFMB", "KDM", "LVB")
Gdata_FN <- Gdata_FN[,-9] #Delete FVB
rownames(Gdata_FN) <- Gdata_FN[,2] #Inst oder abbr as rownames
Gdata_FN <- Gdata_FN[,-c(1,2)] #Delete inst and abbr
Gdata_FN <- Gdata_FN[,c(11,8,4,5,2,10,3,6,7,1,9)] #Order by number of members

Gdata_FN$BeGenDiv <- as.numeric(Gdata_FN$BeGenDiv)
Gdata_FN$BBIB <- as.numeric(Gdata_FN$BBIB)
Gdata_FN$BioFrankfurt <- as.numeric(Gdata_FN$BioFrankfurt)
Gdata_FN$BION <- as.numeric(Gdata_FN$BION)
Gdata_FN$iDiv <- as.numeric(Gdata_FN$iDiv)
Gdata_FN$Ecornet <- as.numeric(Gdata_FN$Ecornet)
Gdata_FN$GFBIO <- as.numeric(Gdata_FN$GFBIO)
Gdata_FN$HIFMB <- as.numeric(Gdata_FN$HIFMB)
Gdata_FN$KDM <- as.numeric(Gdata_FN$KDM)
Gdata_FN$LVB <- as.numeric(Gdata_FN$LVB)
Gdata_FN$`GBIF-D` <- as.numeric(Gdata_FN$`GBIF-D`)
```

```{r Graph-objects, eval=FALSE}
library(igraph)

# 1-mode
nodes_fn_inst <- create_nodes(Gdata_FN, datatype = "forschungsnetzwerke")
links_fn_inst <- create_links(Gdata_FN, datatype = "forschungsnetzwerke")
fn1 <- graph_from_data_frame(d = links_fn_inst, vertices = nodes_fn_inst, directed = F)
fn1_cut <- delete.isolates(fn1)

# 2-mode
fn2 <- graph.incidence(Gdata_FN)
fn2_cut <- delete.isolates(fn2)

# Berechnung statistischer Standardwerte
V(fn1)$degree <- degree(fn1)
V(fn1)$betweenness <- betweenness(fn1, directed = F)
V(fn1_cut)$degree <- degree(fn1_cut)
V(fn1_cut)$betweenness <- betweenness(fn1_cut, directed = F)
V(fn2)$degree <- degree(fn2)
V(fn2)$betweenness <- betweenness(fn2, directed = F)
V(fn2_cut)$degree <- degree(fn2_cut)
V(fn2_cut)$betweenness <- betweenness(fn2_cut, directed = F)

detach("package:igraph", unload=TRUE)
```

```{r SNA, eval=FALSE}
forschungsnetzwerke_sna <- data.frame(name = append(colnames(Gdata_FN),rownames(Gdata_FN)))
forschungsnetzwerke_sna$fullname <- NA
forschungsnetzwerke_sna[c((length(colnames(Gdata_FN))+1):nrow(forschungsnetzwerke_sna)),2] <- paste(Raw_forschungsnetzwerk$Name)
forschungsnetzwerke_sna$type <- NA
forschungsnetzwerke_sna[1:length(colnames(Gdata_FN)),3] <- "netzwerk"
forschungsnetzwerke_sna[c((length(colnames(Gdata_FN))+1):nrow(forschungsnetzwerke_sna)),3] <- "institution"
forschungsnetzwerke_sna$kategorie <- NA
forschungsnetzwerke_sna$degree1 <- NA
forschungsnetzwerke_sna$betweenness1 <- NA
forschungsnetzwerke_sna$degree2 <- NA
forschungsnetzwerke_sna$betweenness2 <- NA

rows1 <- c((ncol(Gdata_FN)+1):nrow(forschungsnetzwerke_sna))
rows2 <- c(1:ncol(Gdata_FN))
forschungsnetzwerke_sna[rows1,5] <- igraph::degree(fn1)
forschungsnetzwerke_sna[rows1,6] <- round(igraph::betweenness(fn1),digits=2)
forschungsnetzwerke_sna[rows1,7] <- igraph::degree(fn2)[1:nrow(Gdata_FN)]
forschungsnetzwerke_sna[rows2,7] <- igraph::degree(fn2)[(nrow(Gdata_FN)+1):nrow(forschungsnetzwerke_sna)]
forschungsnetzwerke_sna[rows1,8] <- round((igraph::betweenness(fn2)[1:nrow(Gdata_FN)]),digits=2)
forschungsnetzwerke_sna[rows2,8] <- round((igraph::betweenness(fn2)[(nrow(Gdata_FN)+1):nrow(forschungsnetzwerke_sna)]),digits=2)

forschungsnetzwerke_sna$degree1rel <- NA
forschungsnetzwerke_sna$degree2rel <- NA
forschungsnetzwerke_sna$betweenness1rel <- NA
forschungsnetzwerke_sna$betweenness2rel <- NA
forschungsnetzwerke_sna[rows1,9] <- round(forschungsnetzwerke_sna[rows1,5] / max(forschungsnetzwerke_sna[rows1,5]),digits=2)
forschungsnetzwerke_sna[,10] <- round(forschungsnetzwerke_sna[,7] / max(forschungsnetzwerke_sna[,7]),digits=2)
forschungsnetzwerke_sna[rows1,11] <- round(forschungsnetzwerke_sna[rows1,6] / max(forschungsnetzwerke_sna[rows1,6]),digits=2)
forschungsnetzwerke_sna[,12] <- round(forschungsnetzwerke_sna[,8] / max(forschungsnetzwerke_sna[,8]),digits=2)

rm(rows1, rows2)
xlsx::write.xlsx(forschungsnetzwerke_sna, file = "SNA_Statistik_Forschungsnetzwerke.xls")

igraph::graph.density(fn1)
igraph::graph.density(fn1_cut)
```

```{r circlize, eval=FALSE}
library(circlize)
library(statnet)
library(igraph)
library(RColorBrewer)

# Berechnung einer Farbpalette
coul6 <- brewer.pal(6, "YlOrBr")
palette_fn1 <- as.numeric(igraph::degree(fn1)+1) # Farbpalette entsprechend vertex.size
farben_fn1 <- coul6[palette_fn1]
palette_fn1[which(palette_fn1 == 1)] <- 1
palette_fn1[which(palette_fn1 %in% c(2:10))] <- 2
palette_fn1[palette_fn1 %in% c(11:20)] <- 3
palette_fn1[palette_fn1 %in% c(21:30)] <- 4
palette_fn1[palette_fn1 %in% c(31:40)] <- 5
palette_fn1[palette_fn1 > 40] <- 6
farben_fn1 <- coul6[palette_fn1]


# Preparation von Zirkel-Links
links_chord <- links_fn_inst
colno <- c(1,2)
rowno <- c(1:nrow(links_chord))
for (c in colno){
  for (r in rowno){
    links_chord[r,c] <- nodes_fn_inst$name[which(nodes_fn_inst[,1] %in% links_chord[r,c])]
  }
}
rm(colno, rowno, c, r)
links_chord <- links_chord[order(links_chord$network_no, links_chord$from, links_chord$to),]
links_chord$value <- c(1:nrow(links_chord))
institutions <- nodes_fn_inst$name
farben10 <- c("greenyellow", "green", "forestgreen", "darkseagreen", "cornflowerblue", "lightslateblue", "navy", "red", "deeppink2", "chocolate4", "black")
coul10 <- c()
rowno <- c(1:nrow(links_chord))
for (r in rowno){
  coul10 <- append(coul10, farben10[links_chord[r,3]])
}
rm(rowno, r)
names(links_chord) <- c("from", "to", "width", "network", "value")
links_chord$width <- 1

# Preparation der Reihenfolge des plottens
order_chord <- data.frame(betweenness = round(igraph::betweenness(igraph::graph_from_data_frame(d = links_chord, vertices = data.frame(name = institutions), directed = F))), degree = igraph::degree(igraph::graph_from_data_frame(d = links_chord, vertices = data.frame(name = institutions), directed = F)), actor_abbr = nodes_fn_inst$name, gridcol = farben_fn1)
order_chord <- order_chord[order(order_chord$degree),]
gridcol <- as.vector(order_chord$gridcol)
names(gridcol) <- order_chord$actor_abbr

# Plot
par(mfrow=c(1,1))
chordDiagram(links_chord,
             order = order_chord$actor_abbr,
             annotationTrack = "grid", preAllocateTracks = 1,
             grid.col = gridcol,
             col = coul10,
             link.sort = "overall")#, ink.decreasing = FALSE)
circos.trackPlotRegion(track.index = 1, panel.fun = function(x, y) {
  xlim = get.cell.meta.data("xlim")
  ylim = get.cell.meta.data("ylim")
  sector.name = get.cell.meta.data("sector.index")
  circos.text(mean(xlim), ylim[1] + .1, sector.name, facing = "clockwise", niceFacing = TRUE, adj = c(0, 0.5), cex = 0.6)
  }, bg.border = NA)

detach("package:circlize", unload=TRUE)
detach("package:statnet", unload=TRUE)
detach("package:igraph", unload=TRUE)
detach("package:RColorBrewer", unload=TRUE)
```

```{r igraph, eval=FALSE}
library(igraph)
library(RColorBrewer)

# Berechnung der Farbpaletten
coul5 <- brewer.pal(5, "YlOrBr")
coul6 <- brewer.pal(6, "YlOrBr")

palette_fn1 <- as.numeric(degree(fn1)+1) # Farbpalette entsprechend vertex.size
farben_fn1 <- coul6[palette_fn1]
palette_fn1[which(palette_fn1 == 1)] <- 1
palette_fn1[which(palette_fn1 %in% c(2:10))] <- 2
palette_fn1[palette_fn1 %in% c(11:20)] <- 3
palette_fn1[palette_fn1 %in% c(21:30)] <- 4
palette_fn1[palette_fn1 %in% c(31:40)] <- 5
palette_fn1[palette_fn1 > 40] <- 6
farben_fn1 <- coul6[palette_fn1]

palette_fn1_cut <- as.numeric(degree(fn1_cut)+1) # Farbpalette entsprechend vertex.size
farben_fn1_cut <- coul6[palette_fn1_cut]
palette_fn1_cut[which(palette_fn1_cut == 1)] <- 1
palette_fn1_cut[which(palette_fn1_cut %in% c(2:10))] <- 2
palette_fn1_cut[palette_fn1_cut %in% c(11:20)] <- 3
palette_fn1_cut[palette_fn1_cut %in% c(21:30)] <- 4
palette_fn1_cut[palette_fn1_cut %in% c(31:40)] <- 5
palette_fn1_cut[palette_fn1_cut > 40] <- 6
farben_fn1_cut <- coul6[palette_fn1_cut]

palette_fn2 <- as.numeric(degree(fn2)+1) # Farbpalette entsprechend vertex.size
farben_fn2 <- coul6[palette_fn2]
farben_fn2[(length(degree(fn2))-10):length(degree(fn2))] <- "dark grey"

palette_fn2_cut <- as.numeric(degree(fn2_cut)+1) # Farbpalette entsprechend vertex.size
farben_fn2_cut <- coul6[palette_fn2_cut]
farben_fn2_cut[(length(degree(fn2_cut))-10):length(degree(fn2_cut))] <- "dark grey"

palette_fn2_cut_netzwerke <- as.numeric(degree(fn2_cut)+1)
palette_fn2_cut_netzwerke[which(palette_fn2_cut_netzwerke == 1)] <- 1
palette_fn2_cut_netzwerke[which(palette_fn2_cut_netzwerke %in% c(2:5))] <- 2
palette_fn2_cut_netzwerke[which(palette_fn2_cut_netzwerke %in% c(6:10))] <- 3
palette_fn2_cut_netzwerke[which(palette_fn2_cut_netzwerke %in% c(11:15))] <- 4
palette_fn2_cut_netzwerke[which(palette_fn2_cut_netzwerke %in% c(16:20))] <- 5
palette_fn2_cut_netzwerke[which(palette_fn2_cut_netzwerke > 20)] <- 6
farben_fn2_cut_netzwerke <- coul6[palette_fn2_cut_netzwerke]
farben_fn2_cut_netzwerke[1:(length(degree(fn2_cut))-ncol(Gdata_FN))] <- NA


# Plotten
#lyout_fn2 <- layout.fruchterman.reingold(fn2)
#write.table(lyout_fn2, file = "lyout_fn2.csv")
test <- as.matrix(sapply(read.table("lyout_fn2.csv"), as.numeric))#  as.matrix(read.table("lyout_fn2.csv"))
#lyout_fn2_cut <- layout.fruchterman.reingold(fn2_cut)
#write.table(lyout_fn2_cut, file = "lyout_fn2_cut.csv")

## Forschungsatlas gesamt mit Netzwerken
E(fn2)$color <- "grey"
par(mfrow=c(1,1))
plot(fn2, vertex.size = 3, vertex.color = farben_fn2,
     vertex.label = V(fn2)$name, vertex.label.family = "Calibri", vertex.label.cex = 0.6,
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = test)

## Forschungsatlas cut mit Netzwerken
E(fn2_cut)$color <- "grey"
par(mfrow=c(1,1))
plot(fn2_cut, vertex.size = 3, vertex.color = farben_fn2_cut,
     vertex.label = V(fn2_cut)$name, vertex.label.family = "Calibri", vertex.label.cex = 0.6,
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_fn2_cut)

## Kombination
par(mfrow=c(1,2))
plot(fn2, vertex.size = 3, vertex.color = farben_fn2,
     vertex.label = V(fn2)$name, vertex.label.family = "Calibri", vertex.label.cex = 0.5,
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_fn2)
plot(fn2_cut, vertex.size = 3, vertex.color = farben_fn2_cut,
     vertex.label = V(fn2_cut)$name, vertex.label.family = "Calibri", vertex.label.cex = 0.8,
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_fn2_cut)

## Forschungsnetzwerke Netzwerke
fn2_cut_netzwerke <- fn2_cut
V(fn2_cut_netzwerke)$color[V(fn2_cut_netzwerke)$type == TRUE] <- farben_fn2_cut_netzwerke[V(fn2_cut_netzwerke)$type == TRUE] # Netzwerke
V(fn2_cut_netzwerke)$color[V(fn2_cut_netzwerke)$type == FALSE] <- "grey" # Institutionen
V(fn2_cut_netzwerke)$label.cex[V(fn2_cut_netzwerke)$type == TRUE] <- 1.5 * 
  V(fn2_cut_netzwerke)$betweenness[V(fn2_cut_netzwerke)$type == TRUE] / max(V(fn2_cut_netzwerke)$betweenness[V(fn2_cut_netzwerke)$type == TRUE])+ 0.5 # Netzwerke
V(fn2_cut_netzwerke)$name[V(fn2_cut_netzwerke)$type == FALSE] <- NA # Institutionen
par(mfrow=c(1,1))
plot(fn2_cut_netzwerke, vertex.size = 3, vertex.color = V(fn2_cut_netzwerke)$color,
     vertex.label = V(fn2_cut_netzwerke)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_fn2_cut)

## Forschungsnetzwerke Institutionen
fn2_cut_institutionen <- fn2_cut
V(fn2_cut_institutionen)$color[V(fn2_cut_institutionen)$type == FALSE] <- farben_fn2_cut[V(fn2_cut_institutionen)$type == FALSE] # Institutionen
V(fn2_cut_institutionen)$color[V(fn2_cut_institutionen)$type == TRUE] <- "grey" # Netzwerke
V(fn2_cut_institutionen)$label.cex[V(fn2_cut_institutionen)$type == FALSE] <- 1.5 * V(fn2_cut_institutionen)$betweenness[V(fn2_cut_institutionen)$type == FALSE] / max(V(fn2_cut_institutionen)$betweenness[V(fn2_cut_institutionen)$type == FALSE])+ 0.5 # Institutionen
V(fn2_cut_institutionen)$name[V(fn2_cut_institutionen)$type == TRUE] <- NA # Netzwerke
par(mfrow=c(1,1))
plot(fn2_cut_institutionen, vertex.size = 3, vertex.color = V(fn2_cut_institutionen)$color,
     vertex.label = V(fn2_cut_institutionen)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_fn2_cut)

## Kombination
par(mfrow=c(1,2))
plot(fn2_cut_netzwerke, vertex.size = 3, vertex.color = V(fn2_cut_netzwerke)$color,
     vertex.label = V(fn2_cut_netzwerke)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_fn2_cut)
plot(fn2_cut_institutionen, vertex.size = 3, vertex.color = V(fn2_cut_institutionen)$color,
     vertex.label = V(fn2_cut_institutionen)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_fn2_cut)

detach("package:igraph", unload=TRUE)
detach("package:RColorBrewer", unload=TRUE)
```

# NeFo-Workshops

```{r Laden der Rohdaten - RUN, eval=FALSE}
library(xlsx)

## Load raw data
Raw_workshops <- read.xlsx(file = "Daten/workshopdaten_20180619.xlsx", sheetIndex = 1, encoding="UTF-8")
Raw_workshops_info <- read.xlsx(file = "Daten/workshopdaten_20180619.xlsx", sheetIndex = 2, encoding="UTF-8")

detach("package:xlsx", unload=TRUE)
```

```{r Vorbereitung der Daten, eval=FALSE}
## Edit WS info
WS_info <- Raw_workshops_info
WS_info <- WS_info[-c(42,43),-c(6,8:ncol(WS_info))]
WS_info$Workshop <- as.character(WS_info$Workshop)

## Prepare datasets "WS"
Gdata_WS <- Raw_workshops
Gdata_WS <- Gdata_WS[-c(1,1278:nrow(Gdata_WS)),-c(52:57)] # Zeilen und Spalten loeschen
names(Gdata_WS) <- c("Titel", "cutoff", "Name", "Inst", "Land",
                  "Inst_lang", "addinfo", "Kategorie", "Inst_alt", "Kontakt", 
                  "WS1", "WS2", "WS3", "WS4", "WS5", 
                  "WS6", "WS7", "WS8", "WS9", "WS10",
                  "WS11", "WS12", "WS13", "WS14", "WS15", 
                  "WS16", "WS17", "WS18", "WS19", "WS20",
                  "WS21", "WS22", "WS23", "WS24", "WS25", 
                  "WS26", "WS27", "WS28", "WS29", "WS30",
                  "WS31", "WS32", "WS33", "WS34", "WS35",
                  "WS36", "WS37", "WS38", "WS39", "WS40", "WS41")
Gdata_WS <- Gdata_WS[,-c(1,6,7,9,10)]
Gdata_WS <- Gdata_WS[-c(which(Gdata_WS$cutoff == "1")),] # Institutswechsel Zeilen loeschen
Gdata_WS <- Gdata_WS[,-1] # Cutoff loeschen

Gdata_WS$Name <- as.character(Gdata_WS$Name)
Gdata_WS$Inst <- as.character(Gdata_WS$Inst)
Gdata_WS$Land <- as.character(Gdata_WS$Land)
Gdata_WS$Kategorie <- as.character(Gdata_WS$Kategorie)
columnno5 <- c(5:ncol(Gdata_WS))
for (c in columnno5){
  Gdata_WS[,c] <- as.numeric.factor(Gdata_WS[,c])
  }
rowno <- c(1:nrow(Gdata_WS))
for (r in rowno){
  if ((Gdata_WS[r,2] == "keine Angabe") & (Gdata_WS[r,3] == "keine Angabe")){
  Gdata_WS[r,3] <- "Deutschland"}
  if (Gdata_WS[r,4] == "Beh?rde"){
    Gdata_WS[r,4] <- "Behoerde"}
  if (Gdata_WS[r,4] == "Verb?nde"){
    Gdata_WS[r,4] <- "Verbaende"}
}
rm(c, columnno5, r, rowno)
```

```{r Subset der Daten, eval=FALSE}
Gdata_2017 <- subset_workshops(Gdata_WS, subset = "2017")
```

```{r Graph-objects, eval=FALSE}
library(igraph)

# 1-mode
nodes_ws <- create_nodes(Gdata_2017, datatype = "workshops")
links_ws <- create_links(Gdata_2017, datatype = "workshops")
ws1 <- graph_from_data_frame(d = nodes_ws, vertices = links_ws, directed = F)

# 2-mode
fn2 <- graph.incidence(Gdata_FN)
fn2_cut <- delete.isolates(fn2)

# Berechnung statistischer Standardwerte
V(fn1)$degree <- degree(fn1)
V(fn1)$betweenness <- betweenness(fn1, directed = F)
V(fn1_cut)$degree <- degree(fn1_cut)
V(fn1_cut)$betweenness <- betweenness(fn1_cut, directed = F)
V(fn2)$degree <- degree(fn2)
V(fn2)$betweenness <- betweenness(fn2, directed = F)
V(fn2_cut)$degree <- degree(fn2_cut)
V(fn2_cut)$betweenness <- betweenness(fn2_cut, directed = F)

detach("package:igraph", unload=TRUE)
```

```{r SNA, eval=FALSE}
forschungsnetzwerke_sna <- data.frame(name = append(colnames(Gdata_FN),rownames(Gdata_FN)))
forschungsnetzwerke_sna$fullname <- NA
forschungsnetzwerke_sna[c((length(colnames(Gdata_FN))+1):nrow(forschungsnetzwerke_sna)),2] <- paste(Raw_forschungsnetzwerk$Name)
forschungsnetzwerke_sna$type <- NA
forschungsnetzwerke_sna[1:length(colnames(Gdata_FN)),3] <- "netzwerk"
forschungsnetzwerke_sna[c((length(colnames(Gdata_FN))+1):nrow(forschungsnetzwerke_sna)),3] <- "institution"
forschungsnetzwerke_sna$kategorie <- NA
forschungsnetzwerke_sna$degree1 <- NA
forschungsnetzwerke_sna$betweenness1 <- NA
forschungsnetzwerke_sna$degree2 <- NA
forschungsnetzwerke_sna$betweenness2 <- NA

rows1 <- c((ncol(Gdata_FN)+1):nrow(forschungsnetzwerke_sna))
rows2 <- c(1:ncol(Gdata_FN))
forschungsnetzwerke_sna[rows1,5] <- igraph::degree(fn1)
forschungsnetzwerke_sna[rows1,6] <- round(igraph::betweenness(fn1),digits=2)
forschungsnetzwerke_sna[rows1,7] <- igraph::degree(fn2)[1:nrow(Gdata_FN)]
forschungsnetzwerke_sna[rows2,7] <- igraph::degree(fn2)[(nrow(Gdata_FN)+1):nrow(forschungsnetzwerke_sna)]
forschungsnetzwerke_sna[rows1,8] <- round((igraph::betweenness(fn2)[1:nrow(Gdata_FN)]),digits=2)
forschungsnetzwerke_sna[rows2,8] <- round((igraph::betweenness(fn2)[(nrow(Gdata_FN)+1):nrow(forschungsnetzwerke_sna)]),digits=2)

forschungsnetzwerke_sna$degree1rel <- NA
forschungsnetzwerke_sna$degree2rel <- NA
forschungsnetzwerke_sna$betweenness1rel <- NA
forschungsnetzwerke_sna$betweenness2rel <- NA
forschungsnetzwerke_sna[rows1,9] <- round(forschungsnetzwerke_sna[rows1,5] / max(forschungsnetzwerke_sna[rows1,5]),digits=2)
forschungsnetzwerke_sna[,10] <- round(forschungsnetzwerke_sna[,7] / max(forschungsnetzwerke_sna[,7]),digits=2)
forschungsnetzwerke_sna[rows1,11] <- round(forschungsnetzwerke_sna[rows1,6] / max(forschungsnetzwerke_sna[rows1,6]),digits=2)
forschungsnetzwerke_sna[,12] <- round(forschungsnetzwerke_sna[,8] / max(forschungsnetzwerke_sna[,8]),digits=2)

rm(rows1, rows2)
xlsx::write.xlsx(forschungsnetzwerke_sna, file = "SNA_Statistik_Forschungsnetzwerke.xls")

igraph::graph.density(fn1)
igraph::graph.density(fn1_cut)
```




### IPBES Nationale Foren
```{r Deskriptive Analyse, eval=FALSE}
Gdata_WS_ipbesforen$Name <- as.character(Gdata_WS_ipbesforen$Name)
Gdata_WS_ipbesforen$Inst <- as.character(Gdata_WS_ipbesforen$Inst)
Gdata_WS_ipbesforen$Land <- as.character(Gdata_WS_ipbesforen$Land)
Gdata_WS_ipbesforen$Kategorie <- as.character(Gdata_WS_ipbesforen$Kategorie)
columnno <- c(5:ncol(Gdata_WS_ipbesforen))
for (c in columnno){
  Gdata_WS_ipbesforen[,c] <- as.numeric.factor(Gdata_WS_ipbesforen[,c])
  }
rm(columnno, c)

rowno <- c(1:nrow(Gdata_WS_ipbesforen))
for (r in rowno){
  if ((Gdata_WS_ipbesforen[r,2] == "keine Angabe") & (Gdata_WS_ipbesforen[r,3] == "keine Angabe")){
    Gdata_WS_ipbesforen[r,3] <- "Deutschland"}
  if (Gdata_WS_ipbesforen[r,4] == "Beh?rde"){
    Gdata_WS_ipbesforen[r,4] <- "Behoerde"}
  if (Gdata_WS_ipbesforen[r,4] == "Verb?nde"){
    Gdata_WS_ipbesforen[r,4] <- "Verbaende"}
}
rm(rowno, r)
Gdata_WS_ipbesforen <- subset(Gdata_WS_ipbesforen, Gdata_WS_ipbesforen$Land == "Deutschland")
Gdata_WS_ipbesforen <- Gdata_WS_ipbesforen[order(Gdata_WS_ipbesforen$Inst, Gdata_WS_ipbesforen$Name),]
Gdata_WS_ipbesforen$overview <- apply(Gdata_WS_ipbesforen[,c(5:ncol(Gdata_WS_ipbesforen))],1,paste,collapse="-")
Gdata_WS_ipbesforen <- Gdata_WS_ipbesforen[-c(which(Gdata_WS_ipbesforen$overview == paste(replicate((ncol(Gdata_WS_ipbesforen)-5), "0"), collapse = "-"))),]
Gdata_WS_ipbesforen <- Gdata_WS_ipbesforen[,-ncol(Gdata_WS_ipbesforen)]

selbststaendig_alt <- c(which(Gdata_WS_ipbesforen$Inst == "Selbstst?ndig"))
selbststaendig <- c(1:length(selbststaendig_alt))
selbststaendig_ipbesforen <- c(paste("Selbstst?ndig", selbststaendig, sep=" "))
keineangabe_alt <- c(which(Gdata_WS_ipbesforen$Inst == "keine Angabe"))
keineangabe <- c(1:length(keineangabe_alt))
keineangabe_ipbesforen <- c(paste("keine Angabe", keineangabe, sep=" "))
for (r in selbststaendig_alt){
  Gdata_WS_ipbesforen[r,2] <- selbststaendig_ipbesforen[which(selbststaendig_alt == r)]}
for (k in keineangabe_alt){
  Gdata_WS_ipbesforen[k,2] <- keineangabe_ipbesforen[which(keineangabe_alt == k)]}
rm(r, k, selbststaendig, selbststaendig_alt, keineangabe, keineangabe_alt)

length(unique(Gdata_WS_ipbesforen$Name)) # Anzahl Teilnehmer_innen: 257
length(unique(Gdata_WS_ipbesforen$Inst)) # Anzahl Institutionen: 105
length(unique(Gdata_WS_ipbesforen[duplicated(Gdata_WS_ipbesforen$Name),]$Name)) # Anzahl Teilnehmer_innen mit verschiedenen Inst: 14

# Anzahl Personen pro Kategorie
length(unique(Gdata_WS_ipbesforen$Name[which(Gdata_WS_ipbesforen$Kategorie == "Wissenschaft")])) #137
length(unique(Gdata_WS_ipbesforen$Name[which(Gdata_WS_ipbesforen$Kategorie == "Behoerde")])) #67
length(unique(Gdata_WS_ipbesforen$Name[which(Gdata_WS_ipbesforen$Kategorie == "Wirtschaft")])) #24
length(unique(Gdata_WS_ipbesforen$Name[which(Gdata_WS_ipbesforen$Kategorie == "Verbaende")])) #27
length(unique(Gdata_WS_ipbesforen$Name[which(Gdata_WS_ipbesforen$Kategorie == "Medien")])) #0
length(unique(Gdata_WS_ipbesforen$Name[which(Gdata_WS_ipbesforen$Kategorie == "keine Angabe")])) #6
261-257 # Anzahl Personen, die mit Inst-Wechsel auch Kat-Wechsel hatten: 10

# Anzahl Institutionen pro Kategorie
length(unique(Gdata_WS_ipbesforen$Inst[which(Gdata_WS_ipbesforen$Kategorie == "Wissenschaft")])) #57
length(unique(Gdata_WS_ipbesforen$Inst[which(Gdata_WS_ipbesforen$Kategorie == "Behoerde")])) #13
length(unique(Gdata_WS_ipbesforen$Inst[which(Gdata_WS_ipbesforen$Kategorie == "Wirtschaft")])) #11
length(unique(Gdata_WS_ipbesforen$Inst[which(Gdata_WS_ipbesforen$Kategorie == "Verbaende")])) #20
length(unique(Gdata_WS_ipbesforen$Inst[which(Gdata_WS_ipbesforen$Kategorie == "Medien")])) #0
length(unique(Gdata_WS_ipbesforen$Inst[which(Gdata_WS_ipbesforen$Kategorie == "keine Angabe")])) #6

# Kategorien prozentual
round(100/105*57, digits = 0) #54
round(100/105*13, digits = 0) #12
round(100/105*11, digits = 0) #10
round(100/105*20, digits = 0) #19
round(100/105*0, digits = 0) #0
round(100/105*6, digits = 0) #6

colno <- c(5:ncol(Gdata_WS_ipbesforen))
WS_ipbesforen_TN  <- 0
for (c in colno){
  WS_ipbesforen_TN <- WS_ipbesforen_TN + sum(as.numeric(Gdata_WS_ipbesforen[,c]))
}
rm(colno, c)
WS_ipbesforen_TN # Summe Teilnehmende an NeFo-Workshops: 438
WS_ipbesforen_TN/6 # Durchschnitt der Anzahl Teilnehmender: 73
```
```{r Transformation f?r Visualisierung, eval=FALSE}
WS_ipbesforen_institutions <- c(paste(sort(unique(Gdata_WS_ipbesforen$Inst))))
Gdata_WS_ipbesforen_institutions <- Gdata_WS_ipbesforen[-c(1:nrow(Gdata_WS_ipbesforen)),]
for (i in WS_ipbesforen_institutions){
  inst <- subset(Gdata_WS_ipbesforen, Gdata_WS_ipbesforen$Inst == i)
  inst <- rbind(inst,
                c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                  sum(inst[,5]),sum(inst[,6]),sum(inst[,7]),
                  sum(inst[,8]),sum(inst[,9]),sum(inst[,10])),
                stringsAsFactors = FALSE)
  Gdata_WS_ipbesforen_institutions <- rbind(Gdata_WS_ipbesforen_institutions, inst[nrow(inst),])
}
rownames(Gdata_WS_ipbesforen_institutions) <- Gdata_WS_ipbesforen_institutions[,2] #Inst as rownames
Gdata_WS_ipbesforen_K <- as.character(Gdata_WS_ipbesforen_institutions$Kategorie)
Gdata_WS_ipbesforen <- Gdata_WS_ipbesforen_institutions[,-c(1:4)]
Gdata_WS_ipbesforen_institutions <- WS_ipbesforen_institutions
rm(inst, i, WS_ipbesforen_institutions)
```
```{r Visualisierung, eval=FALSE}
# edgelist
## nodes
w1 <- colnames(Gdata_WS_ipbesforen[1:ncol(Gdata_WS_ipbesforen)])
w2 <- rownames(Gdata_WS_ipbesforen)
w3 <- c(paste("ws", c(1:ncol(Gdata_WS_ipbesforen)), sep = ""))
w4 <- c(paste("inst", c(1:nrow(Gdata_WS_ipbesforen)), sep = ""))
w5 <- c(w3, w4)
w6 <- c(w1, w2)
nodes <- as.data.frame(cbind(w5, w6))
names(nodes) <- c("id", "name")
nodes$type_no <- NA
nodes[c(1:ncol(Gdata_WS_ipbesforen)),3] <- 1
nodes[c((ncol(Gdata_WS_ipbesforen)+1):nrow(nodes)),3] <- 2
nodes$type <- NA
nodes[c(1:ncol(Gdata_WS_ipbesforen)),4] <- "workshop"
nodes[c((ncol(Gdata_WS_ipbesforen)+1):nrow(nodes)),4] <- "institution"
nodes$kategorie <- NA
nodes[c(1:ncol(Gdata_WS_ipbesforen)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] %in% nodes[c(1:ncol(Gdata_WS_ipbesforen)),2])]
nodes[c((ncol(Gdata_WS_ipbesforen)+1):nrow(nodes)),5] <- Gdata_WS_ipbesforen_K
#nodes$weight <- NA
nodes$id <- as.character(nodes$id)
nodes$name <- as.character(nodes$name)

nodes[c(1:ncol(Gdata_WS_ipbesforen)),2] <- c("1", "2", "3", "4", "5", "6")
nodes$name[which(nodes$name %in% selbststaendig_ipbesforen)] <- "Selbstst?ndig"
nodes$name[which(nodes$name %in% keineangabe_ipbesforen)] <- "k.A."


## links
columns_Gdata <- c(1:ncol(Gdata_WS_ipbesforen))
rows_Gdata <- c(1:nrow(Gdata_WS_ipbesforen))
links <- data.frame(from=character(), to=character(), type=character(), no_participants=numeric(),
                        stringsAsFactors = FALSE)
for (c in columns_Gdata){
  for (r in rows_Gdata){
    if (Gdata_WS_ipbesforen[r,c]!=0){
      links <- rbind(links,
                     c(w3[c], w4[r], "participated", Gdata_WS_ipbesforen[r,c]),
                     stringsAsFactors = FALSE)
    } else {}
  }
}
colnames(links) <- c("from", "to", "type", "no_participants")
links$no_participants <- as.numeric(links$no_participants)

nodes_ipbesforen <- nodes
links_ipbesforen <- links
rm(w1, w2, w3, w4, w5, w6, columns_Gdata, rows_Gdata, c, r, nodes, links)


# Visualisierung
library(igraph)
library(RColorBrewer)

## Erstellen des Graph-Objektes
WS_ipbesforen <- graph_from_data_frame(d = links_ipbesforen, vertices = nodes_ipbesforen, directed = F)
WS_ipbesforen <- delete.isolates(WS_ipbesforen) ### deleting isolates

## Berechnung statistischer Werte
V(WS_ipbesforen)$degree <- degree(WS_ipbesforen)
V(WS_ipbesforen)$betweenness <- betweenness(WS_ipbesforen, directed = F)

## Berechnung einer Farbpalette
coul6 <- brewer.pal(6, "YlOrBr")
palette_ipbesforen <- as.numeric(degree(WS_ipbesforen))  # Farbpalette entsprechend vertex.size
farben_ipbesforen <- coul6[palette_ipbesforen]
farben_ipbesforen[1:6] <- "dark grey"

## Plotten 1
V(WS_ipbesforen)$vertex.size <- 3 * V(WS_ipbesforen)$degree / max(V(WS_ipbesforen)$degree) + 5
V(WS_ipbesforen)$label.cex <- 1.5 * V(WS_ipbesforen)$betweenness / max(V(WS_ipbesforen)$betweenness)+ 0.5
V(WS_ipbesforen)$color[V(WS_ipbesforen)$type == "workshop"] <- rgb(69,121,163,max=255)
V(WS_ipbesforen)$color[V(WS_ipbesforen)$type == "institution"] <- "light grey"
V(WS_ipbesforen)$color[V(WS_ipbesforen)$type == "institution"] <- "light grey" # Institution in FN
E(WS_ipbesforen)$color <- "light grey" #rgb(173,198,70,max=255)

lyout_WS_ipbesforen <- layout.fruchterman.reingold(WS_ipbesforen)

plot(WS_ipbesforen, vertex.size = V(WS_ipbesforen)$vertex.size, vertex.color = farben_ipbesforen,
     vertex.label = V(WS_ipbesforen)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_ipbesforen)
plot(WS_ipbesforen, vertex.size = 3, vertex.color = farben_ipbesforen,
     vertex.label = NA, vertex.label.family = "Calibri",
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_ipbesforen)

## Plotten 2
V(WS_ipbesforen)$vertex.size <- 3 * V(WS_ipbesforen)$degree / max(V(WS_ipbesforen)$degree) + 5
V(WS_ipbesforen)$label.cex <- 1.5 * V(WS_ipbesforen)$betweenness / max(V(WS_ipbesforen)$betweenness)+ 0.5
V(WS_ipbesforen)$color[V(WS_ipbesforen)$type == "workshop"] <- "dark grey"
V(WS_ipbesforen)$color[V(WS_ipbesforen)$kategorie == "Wissenschaft"] <- rgb(92,139,255,max=255)
V(WS_ipbesforen)$color[V(WS_ipbesforen)$kategorie == "Behoerde"] <- rgb(219,174,0,max=255)
V(WS_ipbesforen)$color[V(WS_ipbesforen)$kategorie == "Wirtschaft"] <- rgb(11,33,94,max=255)
V(WS_ipbesforen)$color[V(WS_ipbesforen)$kategorie == "Verbaende"] <- rgb(0,155,68,max=255)
V(WS_ipbesforen)$color[V(WS_ipbesforen)$kategorie == "Medien"] <- rgb(180,33,0,max=255)
V(WS_ipbesforen)$color[V(WS_ipbesforen)$kategorie == "keine Angabe"] <- rgb(255,161,213,max=255)
E(WS_ipbesforen)$color <- "light grey"

plot(WS_ipbesforen, vertex.size = V(WS_ipbesforen)$vertex.size, vertex.color = V(WS_ipbesforen)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS_ipbesforen)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_ipbesforen)

par(mfrow=c(1,2))
plot(WS_ipbesforen, vertex.size = V(WS_ipbesforen)$vertex.size, vertex.color = farben_ipbesforen,
     vertex.label = V(WS_ipbesforen)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_ipbesforen)
plot(WS_ipbesforen, vertex.size = V(WS_ipbesforen)$vertex.size, vertex.color = V(WS_ipbesforen)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS_ipbesforen)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_ipbesforen)     
```
```{r SNA Nationale IPBES-Foren, eval=FALSE}
ntw_WS_ipbesforen <- network::network(Gdata_WS_ipbesforen)
summary(ntw_WS_ipbesforen)
igraph::graph.density(igraph::graph.incidence(Gdata_WS_ipbesforen))

round(sna::betweenness(ntw_WS_ipbesforen))
betw_values_WS_ipbesforen <- data.frame(betweenness = round(sna::betweenness(ntw_WS_ipbesforen)), actor_abbr = c(row.names(Gdata_WS_ipbesforen), c("1", "2", "3", "4", "5", "6")), kat = c(Gdata_WS_ipbesforen_K, nodes_ipbesforen[c(1:6),5]))
betw_values_WS_ipbesforen <- sort(betw_values_WS_ipbesforen, decreasing = T)
xlsx::write.xlsx(betw_values_WS_ipbesforen, file = "Workshops_ipbesforen_betweenness.xls")

```

### NeFo-Workshops
```{r Deskriptive Analyse, eval=FALSE}
Gdata_WS_nefo$Name <- as.character(Gdata_WS_nefo$Name)
Gdata_WS_nefo$Inst <- as.character(Gdata_WS_nefo$Inst)
Gdata_WS_nefo$Land <- as.character(Gdata_WS_nefo$Land)
Gdata_WS_nefo$Kategorie <- as.character(Gdata_WS_nefo$Kategorie)
columnno <- c(5:ncol(Gdata_WS_nefo))
for (c in columnno){
  Gdata_WS_nefo[,c] <- as.numeric.factor(Gdata_WS_nefo[,c])
  }
rm(columnno, c)

rowno <- c(1:nrow(Gdata_WS_nefo))
for (r in rowno){
  if ((Gdata_WS_nefo[r,2] == "keine Angabe") & (Gdata_WS_nefo[r,3] == "keine Angabe")){
    Gdata_WS_nefo[r,3] <- "Deutschland"}
  if (Gdata_WS_nefo[r,4] == "Beh?rde"){
    Gdata_WS_nefo[r,4] <- "Behoerde"}
  if (Gdata_WS_nefo[r,4] == "Verb?nde"){
    Gdata_WS_nefo[r,4] <- "Verbaende"}
}
rm(rowno, r)
Gdata_WS_nefo <- subset(Gdata_WS_nefo, Gdata_WS_nefo$Land == "Deutschland")
Gdata_WS_nefo <- Gdata_WS_nefo[order(Gdata_WS_nefo$Inst, Gdata_WS_nefo$Name),]
Gdata_WS_nefo$overview <- apply(Gdata_WS_nefo[,c(5:ncol(Gdata_WS_nefo))],1,paste,collapse="-")
Gdata_WS_nefo <- Gdata_WS_nefo[-c(which(Gdata_WS_nefo$overview == paste(replicate((ncol(Gdata_WS_nefo)-5), "0"), collapse = "-"))),]
Gdata_WS_nefo <- Gdata_WS_nefo[,-ncol(Gdata_WS_nefo)]

selbststaendig_alt <- c(which(Gdata_WS_nefo$Inst == "Selbstst?ndig"))
selbststaendig <- c(1:length(selbststaendig_alt))
selbststaendig_nefo <- c(paste("Selbstst?ndig", selbststaendig, sep=" "))
keineangabe_alt <- c(which(Gdata_WS_nefo$Inst == "keine Angabe"))
keineangabe <- c(1:length(keineangabe_alt))
keineangabe_nefo <- c(paste("keine Angabe", keineangabe, sep=" "))
for (r in selbststaendig_alt){
  Gdata_WS_nefo[r,2] <- selbststaendig_nefo[which(selbststaendig_alt == r)]}
for (k in keineangabe_alt){
  Gdata_WS_nefo[k,2] <- keineangabe_nefo[which(keineangabe_alt == k)]}
rm(r, k, selbststaendig, selbststaendig_alt, keineangabe, keineangabe_alt)

length(unique(Gdata_WS_nefo$Name)) # Anzahl Teilnehmer_innen: 760
length(unique(Gdata_WS_nefo$Inst)) # Anzahl Institutionen: 288
length(unique(Gdata_WS_nefo[duplicated(Gdata_WS_nefo$Name),]$Name)) # Anzahl Teilnehmer_innen mit verschiedenen Inst: 22

# Anzahl Personen pro Kategorie
length(unique(Gdata_WS_nefo$Name[which(Gdata_WS_nefo$Kategorie == "Wissenschaft")])) #484
length(unique(Gdata_WS_nefo$Name[which(Gdata_WS_nefo$Kategorie == "Behoerde")])) #103
length(unique(Gdata_WS_nefo$Name[which(Gdata_WS_nefo$Kategorie == "Wirtschaft")])) #77
length(unique(Gdata_WS_nefo$Name[which(Gdata_WS_nefo$Kategorie == "Verbaende")])) #63
length(unique(Gdata_WS_nefo$Name[which(Gdata_WS_nefo$Kategorie == "Medien")])) #8
length(unique(Gdata_WS_nefo$Name[which(Gdata_WS_nefo$Kategorie == "keine Angabe")])) #35
770-760 # Anzahl Personen, die mit Inst-Wechsel auch Kat-Wechsel hatten: 10

# Anzahl Institutionen pro Kategorie
length(unique(Gdata_WS_nefo$Inst[which(Gdata_WS_nefo$Kategorie == "Wissenschaft")])) #108
length(unique(Gdata_WS_nefo$Inst[which(Gdata_WS_nefo$Kategorie == "Behoerde")])) #39
length(unique(Gdata_WS_nefo$Inst[which(Gdata_WS_nefo$Kategorie == "Wirtschaft")])) #55
length(unique(Gdata_WS_nefo$Inst[which(Gdata_WS_nefo$Kategorie == "Verbaende")])) #44
length(unique(Gdata_WS_nefo$Inst[which(Gdata_WS_nefo$Kategorie == "Medien")])) #7
length(unique(Gdata_WS_nefo$Inst[which(Gdata_WS_nefo$Kategorie == "keine Angabe")])) #35

# Kategorien prozentual
round(100/288*108, digits = 0) #38
round(100/288*39, digits = 0) #14
round(100/288*55, digits = 0) #19
round(100/288*44, digits = 0) #15
round(100/288*7, digits = 0) #2
round(100/288*35, digits = 0) #12

colno <- c(5:ncol(Gdata_WS_nefo))
WS_nefo_TN  <- 0
for (c in colno){
  WS_nefo_TN <- WS_nefo_TN + sum(as.numeric(Gdata_WS_nefo[,c]))
}
rm(colno, c)
WS_nefo_TN # Summe Teilnehmende an NeFo-Workshops: 1163
WS_nefo_TN/37 # Durchschnitt der Anzahl Teilnehmender: 31
```
```{r Transformation f?r Visualisierung, eval=FALSE}
WS_nefo_institutions <- c(paste(sort(unique(Gdata_WS_nefo$Inst))))
Gdata_WS_nefo_institutions <- Gdata_WS_nefo[-c(1:nrow(Gdata_WS_nefo)),]
for (i in WS_nefo_institutions){
  inst <- subset(Gdata_WS_nefo, Gdata_WS_nefo$Inst == i)
  inst <- rbind(inst,
                c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                  sum(inst[,5]),sum(inst[,6]),sum(inst[,7]),
                  sum(inst[,8]),sum(inst[,9]),sum(inst[,10]),sum(inst[,11]),
                  sum(inst[,12]),sum(inst[,13]),sum(inst[,14]),sum(inst[,15]),
                  sum(inst[,16]),sum(inst[,17]),sum(inst[,18]),sum(inst[,19]),
                  sum(inst[,20]),sum(inst[,21]),sum(inst[,22]),sum(inst[,23]),
                  sum(inst[,24]),sum(inst[,25]),sum(inst[,26]),sum(inst[,27]),
                  sum(inst[,28]),sum(inst[,29]),sum(inst[,30]),sum(inst[,31]),
                  sum(inst[,32]),sum(inst[,33]),sum(inst[,34]),sum(inst[,35]),
                  sum(inst[,36]),sum(inst[,37]),sum(inst[,38]),sum(inst[,39]),
                  sum(inst[,40]), sum(inst[,41])),
                stringsAsFactors = FALSE)
  Gdata_WS_nefo_institutions <- rbind(Gdata_WS_nefo_institutions, inst[nrow(inst),])
}
rownames(Gdata_WS_nefo_institutions) <- Gdata_WS_nefo_institutions[,2] #Inst as rownames
Gdata_WS_nefo_K <- as.character(Gdata_WS_nefo_institutions$Kategorie)
Gdata_WS_nefo <- Gdata_WS_nefo_institutions[,-c(1:4)]
Gdata_WS_nefo_institutions <- WS_nefo_institutions
rm(inst, i, WS_nefo_institutions)
```
```{r Visualisierung, eval=FALSE}
# edgelist
## nodes
w1 <- colnames(Gdata_WS_nefo[1:ncol(Gdata_WS_nefo)])
w2 <- rownames(Gdata_WS_nefo)
w3 <- c(paste("ws", c(1:ncol(Gdata_WS_nefo)), sep = ""))
w4 <- c(paste("inst", c(1:nrow(Gdata_WS_nefo)), sep = ""))
w5 <- c(w3, w4)
w6 <- c(w1, w2)
nodes <- as.data.frame(cbind(w5, w6))
names(nodes) <- c("id", "name")
nodes$type_no <- NA
nodes[c(1:ncol(Gdata_WS_nefo)),3] <- 1
nodes[c((ncol(Gdata_WS_nefo)+1):nrow(nodes)),3] <- 2
nodes$type <- NA
nodes[c(1:ncol(Gdata_WS_nefo)),4] <- "workshop"
nodes[c((ncol(Gdata_WS_nefo)+1):nrow(nodes)),4] <- "institution"
nodes$kategorie <- NA
nodes[c(1:ncol(Gdata_WS_nefo)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] %in% nodes[c(1:ncol(Gdata_WS_nefo)),2])]
nodes[c((ncol(Gdata_WS_nefo)+1):nrow(nodes)),5] <- Gdata_WS_nefo_K
#nodes$weight <- NA
nodes$id <- as.character(nodes$id)
nodes$name <- as.character(nodes$name)

nodes$name[which(nodes$name %in% selbststaendig_nefo)] <- "Selbstst?ndig"
nodes$name[which(nodes$name %in% keineangabe_nefo)] <- "k.A."

## links
columns_Gdata <- c(1:ncol(Gdata_WS_nefo))
rows_Gdata <- c(1:nrow(Gdata_WS_nefo))
links <- data.frame(from=character(), to=character(), type=character(), no_participants=numeric(),
                        stringsAsFactors = FALSE)
for (c in columns_Gdata){
  for (r in rows_Gdata){
    if (Gdata_WS_nefo[r,c]!=0){
      links <- rbind(links,
                     c(w3[c], w4[r], "participated", Gdata_WS_nefo[r,c]),
                     stringsAsFactors = FALSE)
    } else {}
  }
}
colnames(links) <- c("from", "to", "type", "no_participants")
links$no_participants <- as.numeric(links$no_participants)

nodes_nefo <- nodes
links_nefo <- links
rm(w1, w2, w3, w4, w5, w6, columns_Gdata, rows_Gdata, c, r, nodes, links)


# Visualisierung
library(igraph)
library(RColorBrewer)

## Erstellen des Graph-Objektes
WS_nefo <- graph_from_data_frame(d = links_nefo, vertices = nodes_nefo, directed = F)
WS_nefo <- delete.isolates(WS_nefo) ### deleting isolates

## Berechnung statistischer Werte
V(WS_nefo)$degree <- degree(WS_nefo)
V(WS_nefo)$betweenness <- betweenness(WS_nefo, directed = F)

## Berechnung einer Farbpalette
coul6 <- brewer.pal(6, "YlOrBr")
palette_nefo <- as.numeric(degree(WS_nefo))  # Farbpalette entsprechend vertex.size
palette_nefo[which(palette_nefo == 1)] <- 1
palette_nefo[which(palette_nefo %in% c(2:5))] <- 2
palette_nefo[palette_nefo %in% c(6:10)] <- 3
palette_nefo[palette_nefo %in% c(11:15)] <- 4
palette_nefo[palette_nefo %in% c(16:20)] <- 5
palette_nefo[palette_nefo > 20] <- 6
farben_nefo <- coul6[palette_nefo]
farben_nefo[1:37] <- "dark grey"

## Plotten 1
V(WS_nefo)$vertex.size <- 3 * V(WS_nefo)$degree / max(V(WS_nefo)$degree) + 5
V(WS_nefo)$label.cex <- 1.5 * V(WS_nefo)$betweenness / max(V(WS_nefo)$betweenness)+ 0.5
V(WS_nefo)$color[V(WS_nefo)$type == "workshop"] <- rgb(69,121,163,max=255)
V(WS_nefo)$color[V(WS_nefo)$type == "institution"] <- "light grey"
V(WS_nefo)$color[V(WS_nefo)$type == "institution"] <- "light grey" # Institution in FN
E(WS_nefo)$color <- "light grey" #rgb(173,198,70,max=255)

V(WS_nefo)$namecover <- V(WS_nefo)$name
V(WS_nefo)$namecover[1:37] <- NA
V(WS_nefo)$framecolorcover <- NA
V(WS_nefo)$framecolorcover[1:37] <- "black"

lyout_WS_nefo <- layout.fruchterman.reingold(WS_nefo)

plot(WS_nefo, vertex.size = V(WS_nefo)$vertex.size, vertex.color = farben_nefo,
     vertex.label = V(WS_nefo)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefo)
plot(WS_nefo, vertex.size = 3, vertex.color = farben_nefo,
     vertex.label = NA, vertex.label.family = "Calibri",
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefo)
plot(WS_nefo, vertex.size = V(WS_nefo)$vertex.size, vertex.color = farben_nefo,
     vertex.label = V(WS_nefo)$namecover, vertex.label.family = "Calibri",
     vertex.frame.color = V(WS_nefo)$framecolorcover, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefo)

## Plotten 2
V(WS_nefo)$vertex.size <- 3 * V(WS_nefo)$degree / max(V(WS_nefo)$degree) + 5
V(WS_nefo)$label.cex <- 1.5 * V(WS_nefo)$betweenness / max(V(WS_nefo)$betweenness)+ 0.5
V(WS_nefo)$color[V(WS_nefo)$type == "workshop"] <- "dark grey"
V(WS_nefo)$color[V(WS_nefo)$kategorie == "Wissenschaft"] <- rgb(92,139,255,max=255)
V(WS_nefo)$color[V(WS_nefo)$kategorie == "Behoerde"] <- rgb(219,174,0,max=255)
V(WS_nefo)$color[V(WS_nefo)$kategorie == "Wirtschaft"] <- rgb(11,33,94,max=255)
V(WS_nefo)$color[V(WS_nefo)$kategorie == "Verbaende"] <- rgb(0,155,68,max=255)
V(WS_nefo)$color[V(WS_nefo)$kategorie == "Medien"] <- rgb(180,33,0,max=255)
V(WS_nefo)$color[V(WS_nefo)$kategorie == "keine Angabe"] <- rgb(255,161,213,max=255)
E(WS_nefo)$color <- "light grey"

plot(WS_nefo, vertex.size = V(WS_nefo)$vertex.size, vertex.color = V(WS_nefo)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefo)

par(mfrow=c(1,2))
plot(WS_nefo, vertex.size = V(WS_nefo)$vertex.size, vertex.color = farben_nefo,
     vertex.label = V(WS_nefo)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefo)
plot(WS_nefo, vertex.size = V(WS_nefo)$vertex.size, vertex.color = V(WS_nefo)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefo)

####
#ceb <- cluster_edge_betweenness(WS_nefo)
#dendPlot(ceb, mode="hclust")
#plot(ceb, WS_nefo)
#length(ceb)
#sort(membership(ceb))
```
```{r SNA, eval=FALSE}
ntw_WS_nefo <- network::network(Gdata_WS_nefo)
summary(ntw_WS_nefo)
igraph::graph.density(igraph::graph.incidence(Gdata_WS_nefo))

round(sna::betweenness(ntw_WS_nefo))
betw_values_WS_nefo <- data.frame(betweenness = round(sna::betweenness(ntw_WS_nefo)), actor_abbr = c(row.names(Gdata_WS_nefo), names(Gdata_WS_nefo)), kat = c(Gdata_WS_nefo_K, nodes_nefo[c(1:37),5]))
betw_values_WS_nefo <- sort(betw_values_WS_nefo, decreasing = T)
xlsx::write.xlsx(betw_values_WS_nefo, file = "Workshops_nefo_betweenness.xls")

```

### NeFo-Workshops biodiv
```{r Deskriptive Analyse, eval=FALSE}
Gdata_WS_nefobiodiv$Name <- as.character(Gdata_WS_nefobiodiv$Name)
Gdata_WS_nefobiodiv$Inst <- as.character(Gdata_WS_nefobiodiv$Inst)
Gdata_WS_nefobiodiv$Land <- as.character(Gdata_WS_nefobiodiv$Land)
Gdata_WS_nefobiodiv$Kategorie <- as.character(Gdata_WS_nefobiodiv$Kategorie)
columnno <- c(5:ncol(Gdata_WS_nefobiodiv))
for (c in columnno){
  Gdata_WS_nefobiodiv[,c] <- as.numeric.factor(Gdata_WS_nefobiodiv[,c])
  }
rm(columnno, c)

rowno <- c(1:nrow(Gdata_WS_nefobiodiv))
for (r in rowno){
  if ((Gdata_WS_nefobiodiv[r,2] == "keine Angabe") & (Gdata_WS_nefobiodiv[r,3] == "keine Angabe")){
    Gdata_WS_nefobiodiv[r,3] <- "Deutschland"}
  if (Gdata_WS_nefobiodiv[r,4] == "Beh?rde"){
    Gdata_WS_nefobiodiv[r,4] <- "Behoerde"}
  if (Gdata_WS_nefobiodiv[r,4] == "Verb?nde"){
    Gdata_WS_nefobiodiv[r,4] <- "Verbaende"}
}
rm(rowno, r)
Gdata_WS_nefobiodiv <- subset(Gdata_WS_nefobiodiv, Gdata_WS_nefobiodiv$Land == "Deutschland")
Gdata_WS_nefobiodiv <- Gdata_WS_nefobiodiv[order(Gdata_WS_nefobiodiv$Inst, Gdata_WS_nefobiodiv$Name),]
Gdata_WS_nefobiodiv$overview <- apply(Gdata_WS_nefobiodiv[,c(5:ncol(Gdata_WS_nefobiodiv))],1,paste,collapse="-")
Gdata_WS_nefobiodiv <- Gdata_WS_nefobiodiv[-c(which(Gdata_WS_nefobiodiv$overview == paste(replicate((ncol(Gdata_WS_nefobiodiv)-5), "0"), collapse = "-"))),]
Gdata_WS_nefobiodiv <- Gdata_WS_nefobiodiv[,-ncol(Gdata_WS_nefobiodiv)]

selbststaendig_alt <- c(which(Gdata_WS_nefobiodiv$Inst == "Selbstst?ndig"))
selbststaendig <- c(1:length(selbststaendig_alt))
selbststaendig_nefobiodiv <- c(paste("Selbstst?ndig", selbststaendig, sep=" "))
keineangabe_alt <- c(which(Gdata_WS_nefobiodiv$Inst == "keine Angabe"))
keineangabe <- c(1:length(keineangabe_alt))
keineangabe_nefobiodiv <- c(paste("keine Angabe", keineangabe, sep=" "))
for (r in selbststaendig_alt){
  Gdata_WS_nefobiodiv[r,2] <- selbststaendig_nefobiodiv[which(selbststaendig_alt == r)]}
for (k in keineangabe_alt){
  Gdata_WS_nefobiodiv[k,2] <- keineangabe_nefobiodiv[which(keineangabe_alt == k)]}
rm(r, k, selbststaendig, selbststaendig_alt, keineangabe, keineangabe_alt)

length(unique(Gdata_WS_nefobiodiv$Name)) # Anzahl Teilnehmer_innen: 600
length(unique(Gdata_WS_nefobiodiv$Inst)) # Anzahl Institutionen: 256
length(unique(Gdata_WS_nefobiodiv[duplicated(Gdata_WS_nefobiodiv$Name),]$Name)) # Anzahl Teilnehmer_innen mit verschiedenen Inst: 15

# Anzahl Personen pro Kategorie
length(unique(Gdata_WS_nefobiodiv$Name[which(Gdata_WS_nefobiodiv$Kategorie == "Wissenschaft")])) #369
length(unique(Gdata_WS_nefobiodiv$Name[which(Gdata_WS_nefobiodiv$Kategorie == "Behoerde")])) #77
length(unique(Gdata_WS_nefobiodiv$Name[which(Gdata_WS_nefobiodiv$Kategorie == "Wirtschaft")])) #69
length(unique(Gdata_WS_nefobiodiv$Name[which(Gdata_WS_nefobiodiv$Kategorie == "Verbaende")])) #56
length(unique(Gdata_WS_nefobiodiv$Name[which(Gdata_WS_nefobiodiv$Kategorie == "Medien")])) #7
length(unique(Gdata_WS_nefobiodiv$Name[which(Gdata_WS_nefobiodiv$Kategorie == "keine Angabe")])) #28
606-600 # Anzahl Personen, die mit Inst-Wechsel auch Kat-Wechsel hatten: 6

# Anzahl Institutionen pro Kategorie
length(unique(Gdata_WS_nefobiodiv$Inst[which(Gdata_WS_nefobiodiv$Kategorie == "Wissenschaft")])) #97
length(unique(Gdata_WS_nefobiodiv$Inst[which(Gdata_WS_nefobiodiv$Kategorie == "Behoerde")])) #34
length(unique(Gdata_WS_nefobiodiv$Inst[which(Gdata_WS_nefobiodiv$Kategorie == "Wirtschaft")])) #52
length(unique(Gdata_WS_nefobiodiv$Inst[which(Gdata_WS_nefobiodiv$Kategorie == "Verbaende")])) #39
length(unique(Gdata_WS_nefobiodiv$Inst[which(Gdata_WS_nefobiodiv$Kategorie == "Medien")])) #6
length(unique(Gdata_WS_nefobiodiv$Inst[which(Gdata_WS_nefobiodiv$Kategorie == "keine Angabe")])) #28

# Kategorien prozentual
round(100/256*97, digits = 0) #38
round(100/256*34, digits = 0) #13
round(100/256*52, digits = 0) #20
round(100/256*39, digits = 0) #15
round(100/256*6, digits = 0) #2
round(100/256*28, digits = 0) #11

colno <- c(5:ncol(Gdata_WS_nefobiodiv))
WS_nefobiodiv_TN  <- 0
for (c in colno){
  WS_nefobiodiv_TN <- WS_nefobiodiv_TN + sum(as.numeric(Gdata_WS_nefobiodiv[,c]))
}
rm(colno, c)
WS_nefobiodiv_TN # Summe Teilnehmende an NeFo-Workshops: 766
WS_nefobiodiv_TN/21 # Durchschnitt der Anzahl Teilnehmender: 36
```
```{r Transformation f?r Visualisierung, eval=FALSE}
WS_nefobiodiv_institutions <- c(paste(sort(unique(Gdata_WS_nefobiodiv$Inst))))
Gdata_WS_nefobiodiv_institutions <- Gdata_WS_nefobiodiv[-c(1:nrow(Gdata_WS_nefobiodiv)),]
for (i in WS_nefobiodiv_institutions){
  inst <- subset(Gdata_WS_nefobiodiv, Gdata_WS_nefobiodiv$Inst == i)
  inst <- rbind(inst,
                c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                  sum(inst[,5]),sum(inst[,6]),sum(inst[,7]),
                  sum(inst[,8]),sum(inst[,9]),sum(inst[,10]),sum(inst[,11]),
                  sum(inst[,12]),sum(inst[,13]),sum(inst[,14]),sum(inst[,15]),
                  sum(inst[,16]),sum(inst[,17]),sum(inst[,18]),sum(inst[,19]),
                  sum(inst[,20]),sum(inst[,21]),sum(inst[,22]),sum(inst[,23]),
                  sum(inst[,24]),sum(inst[,25])),
                stringsAsFactors = FALSE)
  Gdata_WS_nefobiodiv_institutions <- rbind(Gdata_WS_nefobiodiv_institutions, inst[nrow(inst),])
}
rownames(Gdata_WS_nefobiodiv_institutions) <- Gdata_WS_nefobiodiv_institutions[,2] #Inst as rownames
Gdata_WS_nefobiodiv_K <- as.character(Gdata_WS_nefobiodiv_institutions$Kategorie)
Gdata_WS_nefobiodiv <- Gdata_WS_nefobiodiv_institutions[,-c(1:4)]
Gdata_WS_nefobiodiv_institutions <- WS_nefobiodiv_institutions
rm(inst, i, WS_nefobiodiv_institutions)
```
```{r Visualisierung, eval=FALSE}
# edgelist
## nodes
w1 <- colnames(Gdata_WS_nefobiodiv[1:ncol(Gdata_WS_nefobiodiv)])
w2 <- rownames(Gdata_WS_nefobiodiv)
w3 <- c(paste("ws", c(1:ncol(Gdata_WS_nefobiodiv)), sep = ""))
w4 <- c(paste("inst", c(1:nrow(Gdata_WS_nefobiodiv)), sep = ""))
w5 <- c(w3, w4)
w6 <- c(w1, w2)
nodes <- as.data.frame(cbind(w5, w6))
names(nodes) <- c("id", "name")
nodes$type_no <- NA
nodes[c(1:ncol(Gdata_WS_nefobiodiv)),3] <- 1
nodes[c((ncol(Gdata_WS_nefobiodiv)+1):nrow(nodes)),3] <- 2
nodes$type <- NA
nodes[c(1:ncol(Gdata_WS_nefobiodiv)),4] <- "workshop"
nodes[c((ncol(Gdata_WS_nefobiodiv)+1):nrow(nodes)),4] <- "institution"
nodes$kategorie <- NA
nodes[c(1:ncol(Gdata_WS_nefobiodiv)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] %in% nodes[c(1:ncol(Gdata_WS_nefobiodiv)),2])]
nodes[c((ncol(Gdata_WS_nefobiodiv)+1):nrow(nodes)),5] <- Gdata_WS_nefobiodiv_K
#nodes$weight <- NA
nodes$id <- as.character(nodes$id)
nodes$name <- as.character(nodes$name)

nodes$name[which(nodes$name %in% selbststaendig_nefobiodiv)] <- "Selbstst?ndig"
nodes$name[which(nodes$name %in% keineangabe_nefobiodiv)] <- "k.A."

## links
columns_Gdata <- c(1:ncol(Gdata_WS_nefobiodiv))
rows_Gdata <- c(1:nrow(Gdata_WS_nefobiodiv))
links <- data.frame(from=character(), to=character(), type=character(), no_participants=numeric(),
                        stringsAsFactors = FALSE)
for (c in columns_Gdata){
  for (r in rows_Gdata){
    if (Gdata_WS_nefobiodiv[r,c]!=0){
      links <- rbind(links,
                     c(w3[c], w4[r], "participated", Gdata_WS_nefobiodiv[r,c]),
                     stringsAsFactors = FALSE)
    } else {}
  }
}
colnames(links) <- c("from", "to", "type", "no_participants")
links$no_participants <- as.numeric(links$no_participants)

nodes_nefobiodiv <- nodes
links_nefobiodiv <- links
rm(w1, w2, w3, w4, w5, w6, columns_Gdata, rows_Gdata, c, r, nodes, links)


# Visualisierung
library(igraph)
library(RColorBrewer)

## Erstellen des Graph-Objektes
WS_nefobiodiv <- graph_from_data_frame(d = links_nefobiodiv, vertices = nodes_nefobiodiv, directed = F)
WS_nefobiodiv <- delete.isolates(WS_nefobiodiv) ### deleting isolates

## Berechnung statistischer Werte
V(WS_nefobiodiv)$degree <- degree(WS_nefobiodiv)
V(WS_nefobiodiv)$betweenness <- betweenness(WS_nefobiodiv, directed = F)

## Berechnung einer Farbpalette
coul6 <- brewer.pal(6, "YlOrBr")
palette_nefobiodiv <- as.numeric(degree(WS_nefobiodiv))  # Farbpalette entsprechend vertex.size
palette_nefobiodiv[which(palette_nefobiodiv == 1)] <- 1
palette_nefobiodiv[which(palette_nefobiodiv %in% c(2:5))] <- 2
palette_nefobiodiv[palette_nefobiodiv %in% c(6:10)] <- 3
palette_nefobiodiv[palette_nefobiodiv %in% c(11:15)] <- 4
palette_nefobiodiv[palette_nefobiodiv %in% c(16:20)] <- 5
palette_nefobiodiv[palette_nefobiodiv > 20] <- 6
farben_nefobiodiv <- coul6[palette_nefobiodiv]
farben_nefobiodiv[1:21] <- "dark grey"

## Plotten 1
V(WS_nefobiodiv)$vertex.size <- 3 * V(WS_nefobiodiv)$degree / max(V(WS_nefobiodiv)$degree) + 5
V(WS_nefobiodiv)$label.cex <- 1.5 * V(WS_nefobiodiv)$betweenness / max(V(WS_nefobiodiv)$betweenness)+ 0.5
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$type == "workshop"] <- rgb(69,121,163,max=255)
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$type == "institution"] <- "light grey"
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$type == "institution"] <- "light grey" # Institution in FN
E(WS_nefobiodiv)$color <- "light grey" #rgb(173,198,70,max=255)

lyout_WS_nefobiodiv <- layout.fruchterman.reingold(WS_nefobiodiv)

plot(WS_nefobiodiv, vertex.size = V(WS_nefobiodiv)$vertex.size, vertex.color = farben_nefobiodiv,
     vertex.label = V(WS_nefobiodiv)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefobiodiv)
plot(WS_nefobiodiv, vertex.size = 3, vertex.color = farben_nefobiodiv,
     vertex.label = NA, vertex.label.family = "Calibri",
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefobiodiv)

## Plotten 2
V(WS_nefobiodiv)$vertex.size <- 3 * V(WS_nefobiodiv)$degree / max(V(WS_nefobiodiv)$degree) + 5
V(WS_nefobiodiv)$label.cex <- 1.5 * V(WS_nefobiodiv)$betweenness / max(V(WS_nefobiodiv)$betweenness)+ 0.5
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$type == "workshop"] <- "dark grey"
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$kategorie == "Wissenschaft"] <- rgb(92,139,255,max=255)
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$kategorie == "Behoerde"] <- rgb(219,174,0,max=255)
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$kategorie == "Wirtschaft"] <- rgb(11,33,94,max=255)
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$kategorie == "Verbaende"] <- rgb(0,155,68,max=255)
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$kategorie == "Medien"] <- rgb(180,33,0,max=255)
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$kategorie == "keine Angabe"] <- rgb(255,161,213,max=255)
E(WS_nefobiodiv)$color <- "light grey"

plot(WS_nefobiodiv, vertex.size = V(WS_nefobiodiv)$vertex.size, vertex.color = V(WS_nefobiodiv)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS_nefobiodiv)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefobiodiv)

par(mfrow=c(1,2))
plot(WS_nefobiodiv, vertex.size = V(WS_nefobiodiv)$vertex.size, vertex.color = farben_nefobiodiv,
     vertex.label = V(WS_nefobiodiv)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefobiodiv)
plot(WS_nefobiodiv, vertex.size = V(WS_nefobiodiv)$vertex.size, vertex.color = V(WS_nefobiodiv)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS_nefobiodiv)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefobiodiv)
```
```{r SNA, eval=FALSE}
ntw_WS_nefobiodiv <- network::network(Gdata_WS_nefobiodiv)
summary(ntw_WS_nefobiodiv)
igraph::graph.density(igraph::graph.incidence(Gdata_WS_nefobiodiv))

round(sna::betweenness(ntw_WS_nefobiodiv))
betw_values_WS_nefobiodiv <- data.frame(betweenness = round(sna::betweenness(ntw_WS_nefobiodiv)), actor_abbr = c(row.names(Gdata_WS_nefobiodiv), names(Gdata_WS_nefobiodiv)), kat = c(Gdata_WS_nefobiodiv_K, nodes_nefobiodiv[c(1:21),5]))
betw_values_WS_nefobiodiv <- sort(betw_values_WS_nefobiodiv, decreasing = T)
xlsx::write.xlsx(betw_values_WS_nefobiodiv, file = "Workshops_nefobiodiv_betweenness.xls")

```

### NeFo-Workshops ipbes
```{r Deskriptive Analyse, eval=FALSE}
Gdata_WS_nefoipbes$Name <- as.character(Gdata_WS_nefoipbes$Name)
Gdata_WS_nefoipbes$Inst <- as.character(Gdata_WS_nefoipbes$Inst)
Gdata_WS_nefoipbes$Land <- as.character(Gdata_WS_nefoipbes$Land)
Gdata_WS_nefoipbes$Kategorie <- as.character(Gdata_WS_nefoipbes$Kategorie)
columnno <- c(5:ncol(Gdata_WS_nefoipbes))
for (c in columnno){
  Gdata_WS_nefoipbes[,c] <- as.numeric.factor(Gdata_WS_nefoipbes[,c])
  }
rm(columnno, c)

rowno <- c(1:nrow(Gdata_WS_nefoipbes))
for (r in rowno){
  if ((Gdata_WS_nefoipbes[r,2] == "keine Angabe") & (Gdata_WS_nefoipbes[r,3] == "keine Angabe")){
    Gdata_WS_nefoipbes[r,3] <- "Deutschland"}
  if (Gdata_WS_nefoipbes[r,4] == "Beh?rde"){
    Gdata_WS_nefoipbes[r,4] <- "Behoerde"}
  if (Gdata_WS_nefoipbes[r,4] == "Verb?nde"){
    Gdata_WS_nefoipbes[r,4] <- "Verbaende"}
}
rm(rowno, r)
Gdata_WS_nefoipbes <- subset(Gdata_WS_nefoipbes, Gdata_WS_nefoipbes$Land == "Deutschland")
Gdata_WS_nefoipbes <- Gdata_WS_nefoipbes[order(Gdata_WS_nefoipbes$Inst, Gdata_WS_nefoipbes$Name),]
Gdata_WS_nefoipbes$overview <- apply(Gdata_WS_nefoipbes[,c(5:ncol(Gdata_WS_nefoipbes))],1,paste,collapse="-")
Gdata_WS_nefoipbes <- Gdata_WS_nefoipbes[-c(which(Gdata_WS_nefoipbes$overview == paste(replicate((ncol(Gdata_WS_nefoipbes)-5), "0"), collapse = "-"))),]
Gdata_WS_nefoipbes <- Gdata_WS_nefoipbes[,-ncol(Gdata_WS_nefoipbes)]

selbststaendig_alt <- c(which(Gdata_WS_nefoipbes$Inst == "Selbstst?ndig"))
selbststaendig <- c(1:length(selbststaendig_alt))
selbststaendig_nefoipbes <- c(paste("Selbstst?ndig", selbststaendig, sep=" "))
keineangabe_alt <- c(which(Gdata_WS_nefoipbes$Inst == "keine Angabe"))
keineangabe <- c(1:length(keineangabe_alt))
keineangabe_nefoipbes <- c(paste("keine Angabe", keineangabe, sep=" "))
for (r in selbststaendig_alt){
  Gdata_WS_nefoipbes[r,2] <- selbststaendig_nefoipbes[which(selbststaendig_alt == r)]}
for (k in keineangabe_alt){
  Gdata_WS_nefoipbes[k,2] <- keineangabe_nefoipbes[which(keineangabe_alt == k)]}
rm(r, k, selbststaendig, selbststaendig_alt, keineangabe, keineangabe_alt)

length(unique(Gdata_WS_nefoipbes$Name)) # Anzahl Teilnehmer_innen: 243
length(unique(Gdata_WS_nefoipbes$Inst)) # Anzahl Institutionen: 97
length(unique(Gdata_WS_nefoipbes[duplicated(Gdata_WS_nefoipbes$Name),]$Name)) # Anzahl Teilnehmer_innen mit verschiedenen Inst: 10

# Anzahl Personen pro Kategorie
length(unique(Gdata_WS_nefoipbes$Name[which(Gdata_WS_nefoipbes$Kategorie == "Wissenschaft")])) #176
length(unique(Gdata_WS_nefoipbes$Name[which(Gdata_WS_nefoipbes$Kategorie == "Behoerde")])) #34
length(unique(Gdata_WS_nefoipbes$Name[which(Gdata_WS_nefoipbes$Kategorie == "Wirtschaft")])) #12
length(unique(Gdata_WS_nefoipbes$Name[which(Gdata_WS_nefoipbes$Kategorie == "Verbaende")])) #19
length(unique(Gdata_WS_nefoipbes$Name[which(Gdata_WS_nefoipbes$Kategorie == "Medien")])) #1
length(unique(Gdata_WS_nefoipbes$Name[which(Gdata_WS_nefoipbes$Kategorie == "keine Angabe")])) #7
249-243 # Anzahl Personen, die mit Inst-Wechsel auch Kat-Wechsel hatten: 6

# Anzahl Institutionen pro Kategorie
length(unique(Gdata_WS_nefoipbes$Inst[which(Gdata_WS_nefoipbes$Kategorie == "Wissenschaft")])) #49
length(unique(Gdata_WS_nefoipbes$Inst[which(Gdata_WS_nefoipbes$Kategorie == "Behoerde")])) #16
length(unique(Gdata_WS_nefoipbes$Inst[which(Gdata_WS_nefoipbes$Kategorie == "Wirtschaft")])) #7
length(unique(Gdata_WS_nefoipbes$Inst[which(Gdata_WS_nefoipbes$Kategorie == "Verbaende")])) #17
length(unique(Gdata_WS_nefoipbes$Inst[which(Gdata_WS_nefoipbes$Kategorie == "Medien")])) #1
length(unique(Gdata_WS_nefoipbes$Inst[which(Gdata_WS_nefoipbes$Kategorie == "keine Angabe")])) #7

# Kategorien prozentual
round(100/97*49, digits = 0) #51
round(100/97*16, digits = 0) #16
round(100/97*7, digits = 0) #7
round(100/97*17, digits = 0) #18
round(100/97*1, digits = 0) #1
round(100/97*7, digits = 0) #7

colno <- c(5:ncol(Gdata_WS_nefoipbes))
WS_nefoipbes_TN  <- 0
for (c in colno){
  WS_nefoipbes_TN <- WS_nefoipbes_TN + sum(as.numeric(Gdata_WS_nefoipbes[,c]))
}
rm(colno, c)
WS_nefoipbes_TN # Summe Teilnehmende an NeFo-Workshops: 397
WS_nefoipbes_TN/16 # Durchschnitt der Anzahl Teilnehmender: 24
```
```{r Transformation f?r Visualisierung, eval=FALSE}
WS_nefoipbes_institutions <- c(paste(sort(unique(Gdata_WS_nefoipbes$Inst))))
Gdata_WS_nefoipbes_institutions <- Gdata_WS_nefoipbes[-c(1:nrow(Gdata_WS_nefoipbes)),]
for (i in WS_nefoipbes_institutions){
  inst <- subset(Gdata_WS_nefoipbes, Gdata_WS_nefoipbes$Inst == i)
  inst <- rbind(inst,
                c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                  sum(inst[,5]),sum(inst[,6]),sum(inst[,7]),
                  sum(inst[,8]),sum(inst[,9]),sum(inst[,10]),sum(inst[,11]),
                  sum(inst[,12]),sum(inst[,13]),sum(inst[,14]),sum(inst[,15]),
                  sum(inst[,16]),sum(inst[,17]),sum(inst[,18]),sum(inst[,19]),
                  sum(inst[,20])),
                stringsAsFactors = FALSE)
  Gdata_WS_nefoipbes_institutions <- rbind(Gdata_WS_nefoipbes_institutions, inst[nrow(inst),])
}
rownames(Gdata_WS_nefoipbes_institutions) <- Gdata_WS_nefoipbes_institutions[,2] #Inst as rownames
Gdata_WS_nefoipbes_K <- as.character(Gdata_WS_nefoipbes_institutions$Kategorie)
Gdata_WS_nefoipbes <- Gdata_WS_nefoipbes_institutions[,-c(1:4)]
Gdata_WS_nefoipbes_institutions <- WS_nefoipbes_institutions
rm(inst, i, WS_nefoipbes_institutions)
```
```{r Visualisierung, eval=FALSE}
# edgelist
## nodes
w1 <- colnames(Gdata_WS_nefoipbes[1:ncol(Gdata_WS_nefoipbes)])
w2 <- rownames(Gdata_WS_nefoipbes)
w3 <- c(paste("ws", c(1:ncol(Gdata_WS_nefoipbes)), sep = ""))
w4 <- c(paste("inst", c(1:nrow(Gdata_WS_nefoipbes)), sep = ""))
w5 <- c(w3, w4)
w6 <- c(w1, w2)
nodes <- as.data.frame(cbind(w5, w6))
names(nodes) <- c("id", "name")
nodes$type_no <- NA
nodes[c(1:ncol(Gdata_WS_nefoipbes)),3] <- 1
nodes[c((ncol(Gdata_WS_nefoipbes)+1):nrow(nodes)),3] <- 2
nodes$type <- NA
nodes[c(1:ncol(Gdata_WS_nefoipbes)),4] <- "workshop"
nodes[c((ncol(Gdata_WS_nefoipbes)+1):nrow(nodes)),4] <- "institution"
nodes$kategorie <- NA
nodes[c(1:ncol(Gdata_WS_nefoipbes)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] %in% nodes[c(1:ncol(Gdata_WS_nefoipbes)),2])]
nodes[c((ncol(Gdata_WS_nefoipbes)+1):nrow(nodes)),5] <- Gdata_WS_nefoipbes_K # Kategorien des deutschen Subsets
#nodes$weight <- NA
nodes$id <- as.character(nodes$id)
nodes$name <- as.character(nodes$name)

nodes$name[which(nodes$name %in% selbststaendig_nefoipbes)] <- "Selbstst?ndig"
nodes$name[which(nodes$name %in% keineangabe_nefoipbes)] <- "k.A."

## links
columns_Gdata <- c(1:ncol(Gdata_WS_nefoipbes))
rows_Gdata <- c(1:nrow(Gdata_WS_nefoipbes))
links <- data.frame(from=character(), to=character(), type=character(), no_participants=numeric(),
                        stringsAsFactors = FALSE)
for (c in columns_Gdata){
  for (r in rows_Gdata){
    if (Gdata_WS_nefoipbes[r,c]!=0){
      links <- rbind(links,
                     c(w3[c], w4[r], "participated", Gdata_WS_nefoipbes[r,c]),
                     stringsAsFactors = FALSE)
    } else {}
  }
}
colnames(links) <- c("from", "to", "type", "no_participants")
links$no_participants <- as.numeric(links$no_participants)

nodes_nefoipbes <- nodes
links_nefoipbes <- links
rm(w1, w2, w3, w4, w5, w6, columns_Gdata, rows_Gdata, c, r, nodes, links)


# Visualisierung
library(igraph)
library(RColorBrewer)

## Erstellen des Graph-Objektes
WS_nefoipbes <- graph_from_data_frame(d = links_nefoipbes, vertices = nodes_nefoipbes, directed = F)
WS_nefoipbes <- delete.isolates(WS_nefoipbes) ### deleting isolates

## Berechnung statistischer Werte
V(WS_nefoipbes)$degree <- degree(WS_nefoipbes)
V(WS_nefoipbes)$betweenness <- betweenness(WS_nefoipbes, directed = F)

## Berechnung einer Farbpalette
coul6 <- brewer.pal(6, "YlOrBr")
palette_nefoipbes <- as.numeric(degree(WS_nefoipbes))  # Farbpalette entsprechend vertex.size
palette_nefoipbes[which(palette_nefoipbes == 1)] <- 1
palette_nefoipbes[which(palette_nefoipbes %in% c(2:5))] <- 2
palette_nefoipbes[palette_nefoipbes %in% c(6:10)] <- 3
palette_nefoipbes[palette_nefoipbes %in% c(11:15)] <- 4
palette_nefoipbes[palette_nefoipbes %in% c(16:20)] <- 5
palette_nefoipbes[palette_nefoipbes > 20] <- 6
farben_nefoipbes <- coul6[palette_nefoipbes]
farben_nefoipbes[1:16] <- "dark grey"

## Plotten 1
V(WS_nefoipbes)$vertex.size <- 3 * V(WS_nefoipbes)$degree / max(V(WS_nefoipbes)$degree) + 5
V(WS_nefoipbes)$label.cex <- 1.5 * V(WS_nefoipbes)$betweenness / max(V(WS_nefoipbes)$betweenness)+ 0.5
V(WS_nefoipbes)$color[V(WS_nefoipbes)$type == "workshop"] <- rgb(69,121,163,max=255)
V(WS_nefoipbes)$color[V(WS_nefoipbes)$type == "institution"] <- "light grey"
V(WS_nefoipbes)$color[V(WS_nefoipbes)$type == "institution"] <- "light grey" # Institution in FN
E(WS_nefoipbes)$color <- "light grey" #rgb(173,198,70,max=255)

lyout_WS_nefoipbes <- layout.fruchterman.reingold(WS_nefoipbes)

plot(WS_nefoipbes, vertex.size = V(WS_nefoipbes)$vertex.size, vertex.color = farben_nefoipbes,
     vertex.label = V(WS_nefoipbes)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefoipbes)
plot(WS_nefoipbes, vertex.size = 3, vertex.color = farben_nefoipbes,
     vertex.label = NA, vertex.label.family = "Calibri",
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefoipbes)

## Plotten 2
V(WS_nefoipbes)$vertex.size <- 3 * V(WS_nefoipbes)$degree / max(V(WS_nefoipbes)$degree) + 5
V(WS_nefoipbes)$label.cex <- 1.5 * V(WS_nefoipbes)$betweenness / max(V(WS_nefoipbes)$betweenness)+ 0.5
V(WS_nefoipbes)$color[V(WS_nefoipbes)$type == "workshop"] <- "dark grey"
V(WS_nefoipbes)$color[V(WS_nefoipbes)$kategorie == "Wissenschaft"] <- rgb(92,139,255,max=255)
V(WS_nefoipbes)$color[V(WS_nefoipbes)$kategorie == "Behoerde"] <- rgb(219,174,0,max=255)
V(WS_nefoipbes)$color[V(WS_nefoipbes)$kategorie == "Wirtschaft"] <- rgb(11,33,94,max=255)
V(WS_nefoipbes)$color[V(WS_nefoipbes)$kategorie == "Verbaende"] <- rgb(0,155,68,max=255)
V(WS_nefoipbes)$color[V(WS_nefoipbes)$kategorie == "Medien"] <- rgb(180,33,0,max=255)
V(WS_nefoipbes)$color[V(WS_nefoipbes)$kategorie == "keine Angabe"] <- rgb(255,161,213,max=255)
E(WS_nefoipbes)$color <- "light grey"

plot(WS_nefoipbes, vertex.size = V(WS_nefoipbes)$vertex.size, vertex.color = V(WS_nefoipbes)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS_nefoipbes)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefoipbes)

par(mfrow=c(1,2))
plot(WS_nefoipbes, vertex.size = V(WS_nefoipbes)$vertex.size, vertex.color = farben_nefoipbes,
     vertex.label = V(WS_nefoipbes)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefoipbes)
plot(WS_nefoipbes, vertex.size = V(WS_nefoipbes)$vertex.size, vertex.color = V(WS_nefoipbes)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS_nefoipbes)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefoipbes)
```
```{r SNA, eval=FALSE}
ntw_WS_nefoipbes <- network::network(Gdata_WS_nefoipbes)
summary(ntw_WS_nefoipbes)
igraph::graph.density(igraph::graph.incidence(Gdata_WS_nefoipbes))

round(sna::betweenness(ntw_WS_nefoipbes))
betw_values_WS_nefoipbes <- data.frame(betweenness = round(sna::betweenness(ntw_WS_nefoipbes)), actor_abbr = c(row.names(Gdata_WS_nefoipbes), names(Gdata_WS_nefoipbes)), kat = c(Gdata_WS_nefoipbes_K, nodes_nefoipbes[c(1:16),5]))
betw_values_WS_nefoipbes <- sort(betw_values_WS_nefoipbes, decreasing = T)
xlsx::write.xlsx(betw_values_WS_nefoipbes, file = "Workshops_nefoipbes_betweenness.xls")

```

### NeFo-Workshops pro Jahr
```{r Deskriptive Analyse, eval=FALSE}
Gdata_WS_jahr$Name <- as.character(Gdata_WS_jahr$Name)
Gdata_WS_jahr$Inst <- as.character(Gdata_WS_jahr$Inst)
Gdata_WS_jahr$Land <- as.character(Gdata_WS_jahr$Land)
Gdata_WS_jahr$Kategorie <- as.character(Gdata_WS_jahr$Kategorie)
columnno <- c(5:ncol(Gdata_WS_jahr))
for (c in columnno){
  Gdata_WS_jahr[,c] <- as.numeric.factor(Gdata_WS_jahr[,c])
  }
rm(columnno, c)

rowno <- c(1:nrow(Gdata_WS_jahr))
for (r in rowno){
  if ((Gdata_WS_jahr[r,2] == "keine Angabe") & (Gdata_WS_jahr[r,3] == "keine Angabe")){
    Gdata_WS_jahr[r,3] <- "Deutschland"}
  if (Gdata_WS_jahr[r,4] == "Beh?rde"){
    Gdata_WS_jahr[r,4] <- "Behoerde"}
  if (Gdata_WS_jahr[r,4] == "Verb?nde"){
    Gdata_WS_jahr[r,4] <- "Verbaende"}
}
rm(rowno, r)
Gdata_WS_jahr <- subset(Gdata_WS_jahr, Gdata_WS_jahr$Land == "Deutschland")
Gdata_WS_jahr <- Gdata_WS_jahr[order(Gdata_WS_jahr$Inst, Gdata_WS_jahr$Name),]
Gdata_WS_jahr$overview <- apply(Gdata_WS_jahr[,c(5:ncol(Gdata_WS_jahr))],1,paste,collapse="-")
Gdata_WS_jahr <- Gdata_WS_jahr[-c(which(Gdata_WS_jahr$overview == paste(replicate((ncol(Gdata_WS_jahr)-5), "0"), collapse = "-"))),]
Gdata_WS_jahr <- Gdata_WS_jahr[,-ncol(Gdata_WS_jahr)]

selbststaendig_alt <- c(which(Gdata_WS_jahr$Inst == "Selbstst?ndig"))
selbststaendig <- c(1:length(selbststaendig_alt))
selbststaendig_jahr <- c(paste("Selbstst?ndig", selbststaendig, sep=" "))
keineangabe_alt <- c(which(Gdata_WS_jahr$Inst == "keine Angabe"))
keineangabe <- c(1:length(keineangabe_alt))
keineangabe_jahr <- c(paste("keine Angabe", keineangabe, sep=" "))
for (r in selbststaendig_alt){
  Gdata_WS_jahr[r,2] <- selbststaendig_jahr[which(selbststaendig_alt == r)]}
for (k in keineangabe_alt){
  Gdata_WS_jahr[k,2] <- keineangabe_jahr[which(keineangabe_alt == k)]}
rm(r, k, selbststaendig, selbststaendig_alt, keineangabe, keineangabe_alt)

length(unique(Gdata_WS_jahr$Name)) # Anzahl Teilnehmer_innen = x
length(unique(Gdata_WS_jahr$Inst)) # Anzahl Institutionen
length(unique(Gdata_WS_jahr[duplicated(Gdata_WS_jahr$Name),]$Name)) # Anzahl Teilnehmer_innen mit verschiedenen Inst

# Anzahl Personen pro Kategorie
length(unique(Gdata_WS_jahr$Name[which(Gdata_WS_jahr$Kategorie == "Wissenschaft")]))
length(unique(Gdata_WS_jahr$Name[which(Gdata_WS_jahr$Kategorie == "Behoerde")]))
length(unique(Gdata_WS_jahr$Name[which(Gdata_WS_jahr$Kategorie == "Wirtschaft")]))
length(unique(Gdata_WS_jahr$Name[which(Gdata_WS_jahr$Kategorie == "Verbaende")]))
length(unique(Gdata_WS_jahr$Name[which(Gdata_WS_jahr$Kategorie == "Medien")]))
length(unique(Gdata_WS_jahr$Name[which(Gdata_WS_jahr$Kategorie == "keine Angabe")]))
# Summe = y
x-y # Anzahl Personen, die mit Inst-Wechsel auch Kat-Wechsel hatten

# Anzahl Institutionen pro Kategorie
length(unique(Gdata_WS_jahr$Inst[which(Gdata_WS_jahr$Kategorie == "Wissenschaft")]))
length(unique(Gdata_WS_jahr$Inst[which(Gdata_WS_jahr$Kategorie == "Behoerde")]))
length(unique(Gdata_WS_jahr$Inst[which(Gdata_WS_jahr$Kategorie == "Wirtschaft")]))
length(unique(Gdata_WS_jahr$Inst[which(Gdata_WS_jahr$Kategorie == "Verbaende")]))
length(unique(Gdata_WS_jahr$Inst[which(Gdata_WS_jahr$Kategorie == "Medien")]))
length(unique(Gdata_WS_jahr$Inst[which(Gdata_WS_jahr$Kategorie == "keine Angabe")]))

# Kategorien prozentual
round(100/288*108, digits = 0) #edit
round(100/288*39, digits = 0) #edit
round(100/288*55, digits = 0) #edit
round(100/288*44, digits = 0) #edit
round(100/288*7, digits = 0) #edit
round(100/288*35, digits = 0) #edit

colno <- c(5:ncol(Gdata_WS_jahr))
WS_jahr_TN  <- 0
for (c in colno){
  WS_jahr_TN <- WS_jahr_TN + sum(as.numeric(Gdata_WS_jahr[,c]))
}
rm(colno, c)
WS_jahr_TN # Summe Teilnehmende an NeFo-Workshops
WS_jahr_TN/n # Durchschnitt der Anzahl Teilnehmender / Anzahl Workshops = n
```
```{r Transformation f?r Visualisierung, eval=FALSE}
WS_jahr_institutions <- c(paste(sort(unique(Gdata_WS_jahr$Inst))))
Gdata_WS_jahr_institutions <- Gdata_WS_jahr[-c(1:nrow(Gdata_WS_jahr)),]
for (i in WS_jahr_institutions){
  inst <- subset(Gdata_WS_jahr, Gdata_WS_jahr$Inst == i)
  inst <- rbind(inst,
                c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                  sum(inst[,5]),sum(inst[,6]),sum(inst[,7]),sum(inst[,8])),#,sum(inst[,9]),sum(inst[,10]),sum(inst[,11]),sum(inst[,12]),sum(inst[,13]),sum(inst[,14]),sum(inst[,15]),sum(inst[,16]),sum(inst[,17]),sum(inst[,18]),sum(inst[,19]),sum(inst[,20]),sum(inst[,21]),sum(inst[,22]),sum(inst[,23]),sum(inst[,24]),sum(inst[,25]),sum(inst[,26]),sum(inst[,27]),sum(inst[,28]),sum(inst[,29]),sum(inst[,30]),sum(inst[,31]),sum(inst[,32]),sum(inst[,33]),sum(inst[,34]),sum(inst[,35]),sum(inst[,36]),sum(inst[,37]),sum(inst[,38]),sum(inst[,39]),sum(inst[,40]), sum(inst[,41])),
                stringsAsFactors = FALSE)
  Gdata_WS_jahr_institutions <- rbind(Gdata_WS_jahr_institutions, inst[nrow(inst),])
}
rownames(Gdata_WS_jahr_institutions) <- Gdata_WS_jahr_institutions[,2] #Inst as rownames
Gdata_WS_jahr_K <- as.character(Gdata_WS_jahr_institutions$Kategorie)
Gdata_WS_jahr <- Gdata_WS_jahr_institutions[,-c(1:4)]
Gdata_WS_jahr_institutions <- WS_jahr_institutions
rm(inst, i, WS_jahr_institutions) 
```
```{r Visualisierung, eval=FALSE}
# edgelist
## nodes
w1 <- colnames(Gdata_WS_jahr[1:ncol(Gdata_WS_jahr)])
w2 <- rownames(Gdata_WS_jahr)
w3 <- c(paste("ws", c(1:ncol(Gdata_WS_jahr)), sep = ""))
w4 <- c(paste("inst", c(1:nrow(Gdata_WS_jahr)), sep = ""))
w5 <- c(w3, w4)
w6 <- c(w1, w2)
nodes <- as.data.frame(cbind(w5, w6))
names(nodes) <- c("id", "name")
nodes$type_no <- NA
nodes[c(1:ncol(Gdata_WS_jahr)),3] <- 1
nodes[c((ncol(Gdata_WS_jahr)+1):nrow(nodes)),3] <- 2
nodes$type <- NA
nodes[c(1:ncol(Gdata_WS_jahr)),4] <- "workshop"
nodes[c((ncol(Gdata_WS_jahr)+1):nrow(nodes)),4] <- "institution"
nodes$kategorie <- NA
nodes[c(1:ncol(Gdata_WS_jahr)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] %in% nodes[c(1:ncol(Gdata_WS_jahr)),2])]
nodes[c((ncol(Gdata_WS_jahr)+1):nrow(nodes)),5] <- Gdata_WS_jahr_K
#nodes$weight <- NA
nodes$id <- as.character(nodes$id)
nodes$name <- as.character(nodes$name)

nodes$name[which(nodes$name %in% selbststaendig_jahr)] <- "Selbstst?ndig"
nodes$name[which(nodes$name %in% keineangabe_jahr)] <- "k.A."

## links
columns_Gdata <- c(1:ncol(Gdata_WS_jahr))
rows_Gdata <- c(1:nrow(Gdata_WS_jahr))
links <- data.frame(from=character(), to=character(), type=character(), no_participants=numeric(),
                        stringsAsFactors = FALSE)
for (c in columns_Gdata){
  for (r in rows_Gdata){
    if (Gdata_WS_jahr[r,c]!=0){
      links <- rbind(links,
                     c(w3[c], w4[r], "participated", Gdata_WS_jahr[r,c]),
                     stringsAsFactors = FALSE)
    } else {}
  }
}
colnames(links) <- c("from", "to", "type", "no_participants")
links$no_participants <- as.numeric(links$no_participants)

nodes_jahr <- nodes
links_jahr <- links
rm(w1, w2, w3, w4, w5, w6, columns_Gdata, rows_Gdata, c, r, nodes, links)


# Visualisierung
library(igraph)
library(RColorBrewer)

## Erstellen des Graph-Objektes
WS_jahr <- graph_from_data_frame(d = links_jahr, vertices = nodes_jahr, directed = F)
WS_jahr <- delete.isolates(WS_jahr) ### deleting isolates

## Berechnung statistischer Werte
V(WS_jahr)$degree <- degree(WS_jahr)
V(WS_jahr)$betweenness <- betweenness(WS_jahr, directed = F)

## Berechnung einer Farbpalette
coul6 <- brewer.pal(6, "YlOrBr")
palette_jahr <- as.numeric(degree(WS_jahr))  # Farbpalette entsprechend vertex.size
palette_jahr[which(palette_jahr == 1)] <- 1
palette_jahr[which(palette_jahr %in% c(2:5))] <- 2
palette_jahr[palette_jahr %in% c(6:10)] <- 3
palette_jahr[palette_jahr %in% c(11:15)] <- 4
palette_jahr[palette_jahr %in% c(16:20)] <- 5
palette_jahr[palette_jahr > 20] <- 6
farben_jahr <- coul6[palette_jahr]
farben_jahr[1:ncol(Gdata_WS_jahr)] <- "dark grey"

## Plotten 1
V(WS_jahr)$vertex.size <- 3 * V(WS_jahr)$degree / max(V(WS_jahr)$degree) + 5
V(WS_jahr)$label.cex <- 1.5 * V(WS_jahr)$betweenness / max(V(WS_jahr)$betweenness)+ 0.5
V(WS_jahr)$color[V(WS_jahr)$type == "workshop"] <- rgb(69,121,163,max=255)
V(WS_jahr)$color[V(WS_jahr)$type == "institution"] <- "light grey"
V(WS_jahr)$color[V(WS_jahr)$type == "institution"] <- "light grey" # Institution in FN
E(WS_jahr)$color <- "light grey" #rgb(173,198,70,max=255)

V(WS_jahr)$namecover <- V(WS_jahr)$name
V(WS_jahr)$namecover[1:ncol(Gdata_WS_jahr)] <- NA
V(WS_jahr)$framecolorcover <- NA
V(WS_jahr)$framecolorcover[1:ncol(Gdata_WS_jahr)] <- "black"

lyout_WS_jahr <- layout.fruchterman.reingold(WS_jahr)

plot(WS_jahr, vertex.size = V(WS_jahr)$vertex.size, vertex.color = farben_jahr,
     vertex.label = V(WS_jahr)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_jahr)
plot(WS_jahr, vertex.size = 3, vertex.color = farben_jahr,
     vertex.label = NA, vertex.label.family = "Calibri",
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_jahr)
plot(WS_jahr, vertex.size = V(WS_jahr)$vertex.size, vertex.color = farben_jahr,
     vertex.label = V(WS_jahr)$namecover, vertex.label.family = "Calibri",
     vertex.frame.color = V(WS_jahr)$framecolorcover, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_jahr)

## Plotten 2
V(WS_jahr)$vertex.size <- 3 * V(WS_jahr)$degree / max(V(WS_jahr)$degree) + 5
V(WS_jahr)$label.cex <- 1.5 * V(WS_jahr)$betweenness / max(V(WS_jahr)$betweenness)+ 0.5
V(WS_jahr)$color[V(WS_jahr)$type == "workshop"] <- "dark grey"
V(WS_jahr)$color[V(WS_jahr)$kategorie == "Wissenschaft"] <- rgb(92,139,255,max=255)
V(WS_jahr)$color[V(WS_jahr)$kategorie == "Behoerde"] <- rgb(219,174,0,max=255)
V(WS_jahr)$color[V(WS_jahr)$kategorie == "Wirtschaft"] <- rgb(11,33,94,max=255)
V(WS_jahr)$color[V(WS_jahr)$kategorie == "Verbaende"] <- rgb(0,155,68,max=255)
V(WS_jahr)$color[V(WS_jahr)$kategorie == "Medien"] <- rgb(180,33,0,max=255)
V(WS_jahr)$color[V(WS_jahr)$kategorie == "keine Angabe"] <- rgb(255,161,213,max=255)
E(WS_jahr)$color <- "light grey"

plot(WS_jahr, vertex.size = V(WS_jahr)$vertex.size, vertex.color = V(WS_jahr)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_jahr)

par(mfrow=c(1,2))
plot(WS_jahr, vertex.size = V(WS_jahr)$vertex.size, vertex.color = farben_jahr,
     vertex.label = V(WS_jahr)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_jahr)
plot(WS_jahr, vertex.size = V(WS_jahr)$vertex.size, vertex.color = V(WS_jahr)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_jahr)

```
```{r SNA, eval=FALSE}
ntw_WS_jahr <- network::network(Gdata_WS_jahr)
summary(ntw_WS_jahr)
igraph::graph.density(igraph::graph.incidence(Gdata_WS_jahr))

round(sna::betweenness(ntw_WS_jahr))
betw_values_WS_jahr <- data.frame(betweenness = round(sna::betweenness(ntw_WS_jahr)), actor_abbr = c(row.names(Gdata_WS_jahr), names(Gdata_WS_jahr)), kat = c(Gdata_WS_jahr_K, nodes_jahr[c(1:37),5]))
betw_values_WS_jahr <- sort(betw_values_WS_jahr, decreasing = T)
xlsx::write.xlsx(betw_values_WS_jahr, file = "Workshops_nefo_betweenness.xls")

```



