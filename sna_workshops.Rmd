---
title: "Soziale Netzwerkanalyse: NeFo-Workshops"
author: "Jonas Geschke"
date: "2017, 2018"
header-includes:
   - \usepackage{longtable}
output:
  pdf_document:
    toc: yes
  documentclass: article
  html_document:
    toc: yes
  classoption: a4paper
  graphics: yes
---

# Einleitung
Dieses ist das Skript der Netzwerkanalyse zu NeFo auf Grundlage der Teilnehmer-Listen der von NeFo organisierten und initiierten Workshops. Das Skrpit ist  verfügbar unter https://github.com/JonasGeschke/nefo
Die Netzwerkanalyse selbst ist verfügbar unter XXX


# Einstellungen

```{r set wd, eval=FALSE}
# If your working directory is not already specified because you are running this
# script within a project, you will need to use the setwd() function below to set
# the path of your working directory. In order to do this just copy the path
# between the quote signs.
# Please note: The different levels of the path need to be separated by slashes
# ("/"), not by backslashes ("\") which are the windows default.
# 
# setwd("")

#setwd("/Volumes/NO NAME/MfN/Netzwerkanalyse_NeFo/R") # Stick
setwd("Z:/Benutzer/Jonas.Geschke/Netzwerkanalyse_NeFo/R") # Buero
```

```{r install packages, eval=FALSE}
# Installing required packages if not installed yet
if("statnet" %in% rownames(installed.packages())   == FALSE){
  install.packages("statnet")}
if("network" %in% rownames(installed.packages())   == FALSE){
  install.packages("network")}
if("sna" %in% rownames(installed.packages())   == FALSE){
  install.packages("sna")}
if("igraph" %in% rownames(installed.packages())   == FALSE){
  install.packages("igraph")}
if("xts" %in% rownames(installed.packages())   == FALSE){
  install.packages("xts")}
if("xlsx" %in% rownames(installed.packages())   == FALSE){
  install.packages("xlsx")}
if("dplyr" %in% rownames(installed.packages())   == FALSE){
  install.packages("dplyr")}
if("rgl" %in% rownames(installed.packages())   == FALSE){
  install.packages("rgl")}
if("extrafont" %in% rownames(installed.packages())   == FALSE){
  install.packages("extrafont")}
if("circlize" %in% rownames(installed.packages())   == FALSE){
  install.packages("circlize")}
if("RColorBrewer" %in% rownames(installed.packages())   == FALSE){
  install.packages("RColorBrewer")}
```

```{r set additional functions, eval=FALSE}
as.numeric.factor <- function(x) {as.numeric(levels(x))[x]}

'%!in%' <- function(x,y)!('%in%'(x,y))

delete.isolates <- function(graph, mode = "all"){
  isolates <- which(degree(graph, mode = mode) == 0)
  delete.vertices(graph, isolates)
}

subset_workshops <- function(Gdata, subset = "2010-2018"){
  if (subset == "2010-2018"){
    Gdata <- Gdata[,-c(which(names(Gdata) %in% c("WS24", "WS28", "WS31", "WS39")))]
    return(Gdata)}
  else if (subset == "ipbesforen"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS7", "WS20", "WS24", "WS28", "WS31", "WS39")))]
    return(Gdata)}
  else if (subset == "nefo"){
    Gdata <- Gdata_WS[,-c(which(names(Gdata_WS) %in% c("WS24", "WS28", "WS31", "WS39")))]
    return(Gdata)}
  else if (subset == "nefobiodiv"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS8", "WS9", "WS11", "WS12", "WS13", "WS14", "WS19", "WS25", "WS26", "WS30", "WS32", "WS35", "WS36", "WS37", "WS40")))]
    return(Gdata)}
  else if (subset == "nefoipbes"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS7", "WS10", "WS15", "WS16", "WS17", "WS18", "WS20", "WS21", "WS22", "WS23", "WS27", "WS29", "WS33", "WS34", "WS38", "WS41")))]
    return(Gdata)}
  else if (subset == "2010"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS1", "WS4")))]
    return(Gdata)}
  else if (subset == "2011"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))]
    return(Gdata)}
  else if (subset == "2012"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS11", "WS12", "WS13", "WS14")))]
    return(Gdata)}
  else if (subset == "2013"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS15", "WS16", "WS17", "WS18", "WS19", "WS20")))]
    return(Gdata)}
  else if (subset == "2014"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS21", "WS22", "WS23", "WS25")))]
    return(Gdata)}
  else if (subset == "2015"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS26", "WS27")))]
    return(Gdata)}
  else if (subset == "2016"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS29", "WS30")))]
    return(Gdata)}
  else if (subset == "2017"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS32", "WS33", "WS34", "WS35", "WS36")))]
    return(Gdata)}
  else if (subset == "2018"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS37", "WS38", "WS40", "WS41")))]
    return(Gdata)}
  else if (subset == "2010-2011"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))]
    return(Gdata)}
  else if (subset == "2010-2012"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10", "WS11", "WS12", "WS13", "WS14")))]
    return(Gdata)}
  else if (subset == "2010-2013"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10", "WS11", "WS12", "WS13", "WS14", "WS15", "WS16", "WS17", "WS18", "WS19", "WS20")))]
    return(Gdata)}
  else if (subset == "2010-2014"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10", "WS11", "WS12", "WS13", "WS14", "WS15", "WS16", "WS17", "WS18", "WS19", "WS20", "WS21", "WS22", "WS23", "WS25")))]
    return(Gdata)}
  else if (subset == "2010-2015"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10", "WS11", "WS12", "WS13", "WS14", "WS15", "WS16", "WS17", "WS18", "WS19", "WS20", "WS21", "WS22", "WS23", "WS25", "WS26", "WS27")))]
    return(Gdata)}
  else if (subset == "2010-2016"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10", "WS11", "WS12", "WS13", "WS14", "WS15", "WS16", "WS17", "WS18", "WS19", "WS20", "WS21", "WS22", "WS23", "WS25", "WS26", "WS27", "WS29", "WS30")))]
    return(Gdata)}
  else if (subset == "2010-2017"){
    Gdata <- Gdata[,c(1:4,which(names(Gdata) %in% c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10", "WS11", "WS12", "WS13", "WS14", "WS15", "WS16", "WS17", "WS18", "WS19", "WS20", "WS21", "WS22", "WS23", "WS25", "WS26", "WS27", "WS29", "WS30", "WS32", "WS33", "WS34", "WS35", "WS36")))]
    return(Gdata)}
  else {print("Please set subset: ipbesforen, nefo, nefobiodiv, nefoipbes, 2010, 2011, 2012, 2103, 2014, 2015, 2016, 2017, 2018, 2010-2011, 2010-2012, 2010-2013, 2010-2014, 2010-2015, 2010-2016, 2010-2017, 2010-2018")}
}

create_nodes_workshops_1mode <- function(Gdata){
  #preparation
  Gdata <- subset(Gdata, Gdata$Land == "Deutschland")
  Gdata <- Gdata[order(Gdata$Inst, Gdata$Name),]
  Gdata <- subset(Gdata, (rowSums(Gdata[5:ncol(Gdata)]) != 0))
#  Gdata$overview <- apply(Gdata[,c(5:ncol(Gdata))], 1, paste, collapse = "-")
#  todelete <- paste(replicate((ncol(Gdata)-5), "0"), collapse = "-")
#  Gdata <- Gdata[-c(which(Gdata[,ncol(Gdata)] == todelete)),]
#  Gdata <- Gdata[,-ncol(Gdata)]
  
  if(any(Gdata$Inst == "Selbstständig")==TRUE){
    selbststaendig_alt <- c(which(Gdata$Inst == "Selbstständig"))
    selbststaendig <- c(1:length(selbststaendig_alt))
    selbststaendig_Gdata <- c(paste("Selbstständig", selbststaendig, sep=" "))
    for (r in selbststaendig_alt){
    Gdata[r,2] <- selbststaendig_Gdata[which(selbststaendig_alt == r)]}
    rm(r)}
  if(any(Gdata$Inst == "keine Angabe")==TRUE){
    keineangabe_alt <- c(which(Gdata$Inst == "keine Angabe"))
    keineangabe <- c(1:length(keineangabe_alt))
    keineangabe_Gdata <- c(paste("keine Angabe", keineangabe, sep=" "))
    for (k in keineangabe_alt){
    Gdata[k,2] <- keineangabe_Gdata[which(keineangabe_alt == k)]}
    rm(k)}
  
  institutions <- c(paste(sort(unique(Gdata$Inst))))
  Gdata_institutions <- Gdata[-c(1:nrow(Gdata)),]
  columnstosum <- c(5:ncol(Gdata))
  
  for (i in institutions){
    inst <- subset(Gdata, Gdata$Inst == i)
    inst <- rbind(inst,
                  c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                    colSums(inst[,-c(1:4)])),
                  stringsAsFactors = FALSE)
    Gdata_institutions <- rbind(Gdata_institutions, inst[nrow(inst),])
  }
  rownames(Gdata_institutions) <- Gdata_institutions[,2] #Inst as rownames
  Gdata_K <- as.character(Gdata_institutions$Kategorie)
  Gdata <- Gdata_institutions[,-c(1:4)]
  Gdata_institutions <- institutions
  rm(inst, i, institutions)
  
  #nodes
  w1 <- colnames(Gdata[1:ncol(Gdata)])
  w2 <- rownames(Gdata)
  w3 <- c(paste("ws", c(1:ncol(Gdata)), sep = ""))
  w4 <- c(paste("inst", c(1:nrow(Gdata)), sep = ""))
  w5 <- c(w3, w4)
  w6 <- c(w1, w2)
  nodes <- as.data.frame(cbind(w5, w6))
  names(nodes) <- c("id", "name")
  nodes$type_no <- NA
  nodes[c(1:ncol(Gdata)),3] <- 1
  nodes[c((ncol(Gdata)+1):nrow(nodes)),3] <- 2
  nodes$type <- NA
  nodes[c(1:ncol(Gdata)),4] <- "workshop"
  nodes[c((ncol(Gdata)+1):nrow(nodes)),4] <- "institution"
  nodes$kategorie <- NA
  nodes[c(1:ncol(Gdata)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] %in% nodes[c(1:ncol(Gdata)),2])]
  nodes[c((ncol(Gdata)+1):nrow(nodes)),5] <- Gdata_K
  nodes$id <- as.character(nodes$id)
  nodes$name <- as.character(nodes$name)
  
#  nodes$name[which(nodes$name %in% selbststaendig_Gdata)] <- "Selbstständig"
#  nodes$name[which(nodes$name %in% keineangabe_Gdata)] <- "k.A."
  
  nodes <- subset(nodes, (nodes$type_no == 2))
  
  return(nodes)
}

create_links_workshops_1mode <- function(Gdata){
  #preparation
  Gdata <- subset(Gdata, Gdata$Land == "Deutschland")
  Gdata <- Gdata[order(Gdata$Inst, Gdata$Name),]
  Gdata <- subset(Gdata, (rowSums(Gdata[5:ncol(Gdata)]) != 0))
#  Gdata$overview <- apply(Gdata[,c(5:ncol(Gdata))],1,paste,collapse="-")
#  Gdata <- Gdata[-c(which(Gdata$overview == paste(replicate((ncol(Gdata)-5), "0"), collapse = "-"))),]
#  Gdata <- Gdata[,-ncol(Gdata)]
  
  if(any(Gdata$Inst == "Selbstständig")==TRUE){
    selbststaendig_alt <- c(which(Gdata$Inst == "Selbstständig"))
    selbststaendig <- c(1:length(selbststaendig_alt))
    selbststaendig_Gdata <- c(paste("Selbstständig", selbststaendig, sep=" "))
    for (r in selbststaendig_alt){
    Gdata[r,2] <- selbststaendig_Gdata[which(selbststaendig_alt == r)]}
    rm(r)}
  if(any(Gdata$Inst == "keine Angabe")==TRUE){
    keineangabe_alt <- c(which(Gdata$Inst == "keine Angabe"))
    keineangabe <- c(1:length(keineangabe_alt))
    keineangabe_Gdata <- c(paste("keine Angabe", keineangabe, sep=" "))
    for (k in keineangabe_alt){
    Gdata[k,2] <- keineangabe_Gdata[which(keineangabe_alt == k)]}
    rm(k)}
  
  institutions <- c(paste(sort(unique(Gdata$Inst))))
  Gdata_institutions <- Gdata[-c(1:nrow(Gdata)),]
  columnstosum <- c(5:ncol(Gdata))
  
  for (i in institutions){
    inst <- subset(Gdata, Gdata$Inst == i)
    inst <- rbind(inst,
                  c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                    colSums(inst[,-c(1:4)])),
                  stringsAsFactors = FALSE)
    Gdata_institutions <- rbind(Gdata_institutions, inst[nrow(inst),])
  }
  rownames(Gdata_institutions) <- Gdata_institutions[,2] #Inst as rownames
  Gdata_K <- as.character(Gdata_institutions$Kategorie)
  Gdata <- Gdata_institutions[,-c(1:4)]
  Gdata_institutions <- institutions
  rm(inst, i, institutions)
  
  ## links
  w1 <- colnames(Gdata[1:ncol(Gdata)])
  w2 <- rownames(Gdata)
  w3 <- c(paste("ws", c(1:ncol(Gdata)), sep = ""))
  w4 <- c(paste("inst", c(1:nrow(Gdata)), sep = ""))
  w5 <- c(w3, w4)
  w6 <- c(w1, w2)
  
  columnno <- c(1:ncol(Gdata))
  rowno <- c(1:nrow(Gdata))
  
  links_w <- data.frame(from=character(), to=character(), 
                        network_no=character(), network=character(),
                        stringsAsFactors = FALSE)
   for (c in columnno){
    for (r in rowno){
      if (as.numeric(Gdata[r,c]) != 0) {
        links_w <- rbind(links_w,
                         c(w3[c], w4[r], as.numeric(c), colnames(Gdata)[c]), 
                         stringsAsFactors = FALSE)
      } else {}
    }
  }
  
  colnames(links_w) <- c("links_w_1", "links_w_2", "links_w_3", "links_w_4")
  
  links <- data.frame(from=character(), to=character(), 
                      network_no=character(), network=character(),
                      stringsAsFactors = FALSE)
  
  for(n in columnno){
    subset <- subset(links_w, links_w$links_w_4 == w1[n])
    rowssubset <- c(1:nrow(subset))
    for (r in rowssubset){
      t <- 1
      repeat{
        links <- rbind(links,
                       c(subset[r,2], subset[r+t,2], n, paste(w1[n])),
                       stringsAsFactors = FALSE)
        t <- t+1
        if (t==max(rowssubset)){break}}
    }
  }
  
  colnames(links) <- c("from", "to", "network_no", "network")
  links$network_no <- as.numeric(links$network_no)
  links <- subset(links, !is.na(links$to))
  
  return(links)
}

create_nodes_workshops_2mode <- function(Gdata){
  #preparation
  Gdata <- subset(Gdata, Gdata$Land == "Deutschland")
  Gdata <- Gdata[order(Gdata$Inst, Gdata$Name),]
  Gdata <- subset(Gdata, (rowSums(Gdata[5:ncol(Gdata)]) != 0))
#  Gdata$overview <- apply(Gdata[,c(5:ncol(Gdata))], 1, paste, collapse = "-")
#  todelete <- paste(replicate((ncol(Gdata)-5), "0"), collapse = "-")
#  Gdata <- Gdata[-c(which(Gdata[,ncol(Gdata)] == todelete)),]
#  Gdata <- Gdata[,-ncol(Gdata)]
  
  if(any(Gdata$Inst == "Selbstständig")==TRUE){
    selbststaendig_alt <- c(which(Gdata$Inst == "Selbstständig"))
    selbststaendig <- c(1:length(selbststaendig_alt))
    selbststaendig_Gdata <- c(paste("Selbstständig", selbststaendig, sep=" "))
    for (r in selbststaendig_alt){
    Gdata[r,2] <- selbststaendig_Gdata[which(selbststaendig_alt == r)]}
    rm(r)}
  if(any(Gdata$Inst == "keine Angabe")==TRUE){
    keineangabe_alt <- c(which(Gdata$Inst == "keine Angabe"))
    keineangabe <- c(1:length(keineangabe_alt))
    keineangabe_Gdata <- c(paste("keine Angabe", keineangabe, sep=" "))
    for (k in keineangabe_alt){
    Gdata[k,2] <- keineangabe_Gdata[which(keineangabe_alt == k)]}
    rm(k)}
  
  institutions <- c(paste(sort(unique(Gdata$Inst))))
  Gdata_institutions <- Gdata[-c(1:nrow(Gdata)),]
  columnstosum <- c(5:ncol(Gdata))
  
  for (i in institutions){
    inst <- subset(Gdata, Gdata$Inst == i)
    inst <- rbind(inst,
                  c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                    colSums(inst[,-c(1:4)])),
                  stringsAsFactors = FALSE)
    Gdata_institutions <- rbind(Gdata_institutions, inst[nrow(inst),])
  }
  rownames(Gdata_institutions) <- Gdata_institutions[,2] #Inst as rownames
  Gdata_K <- as.character(Gdata_institutions$Kategorie)
  Gdata <- Gdata_institutions[,-c(1:4)]
  Gdata_institutions <- institutions
  rm(inst, i, institutions)
  
  #nodes
  w1 <- colnames(Gdata[1:ncol(Gdata)])
  w2 <- rownames(Gdata)
  w3 <- c(paste("ws", c(1:ncol(Gdata)), sep = ""))
  w4 <- c(paste("inst", c(1:nrow(Gdata)), sep = ""))
  w5 <- c(w3, w4)
  w6 <- c(w1, w2)
  nodes <- as.data.frame(cbind(w5, w6))
  names(nodes) <- c("id", "name")
  nodes$type_no <- NA
  nodes[c(1:ncol(Gdata)),3] <- 1
  nodes[c((ncol(Gdata)+1):nrow(nodes)),3] <- 2
  nodes$type <- NA
  nodes[c(1:ncol(Gdata)),4] <- "workshop"
  nodes[c((ncol(Gdata)+1):nrow(nodes)),4] <- "institution"
  nodes$kategorie <- NA
  nodes[c(1:ncol(Gdata)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] %in% nodes[c(1:ncol(Gdata)),2])]
  nodes[c((ncol(Gdata)+1):nrow(nodes)),5] <- Gdata_K
  nodes$id <- as.character(nodes$id)
  nodes$name <- as.character(nodes$name)
  
#  nodes$name[which(nodes$name %in% selbststaendig_Gdata)] <- "Selbstständig"
#  nodes$name[which(nodes$name %in% keineangabe_Gdata)] <- "k.A."
  
  return(nodes)
}

create_links_workshops_2mode <- function(Gdata){
  #preparation
  Gdata <- subset(Gdata, Gdata$Land == "Deutschland")
  Gdata <- Gdata[order(Gdata$Inst, Gdata$Name),]
  Gdata <- subset(Gdata, (rowSums(Gdata[5:ncol(Gdata)]) != 0))
#  Gdata$overview <- apply(Gdata[,c(5:ncol(Gdata))],1,paste,collapse="-")
#  Gdata <- Gdata[-c(which(Gdata$overview == paste(replicate((ncol(Gdata)-5), "0"), collapse = "-"))),]
#  Gdata <- Gdata[,-ncol(Gdata)]
  
  if(any(Gdata$Inst == "Selbstständig")==TRUE){
    selbststaendig_alt <- c(which(Gdata$Inst == "Selbstständig"))
    selbststaendig <- c(1:length(selbststaendig_alt))
    selbststaendig_Gdata <- c(paste("Selbstständig", selbststaendig, sep=" "))
    for (r in selbststaendig_alt){
    Gdata[r,2] <- selbststaendig_Gdata[which(selbststaendig_alt == r)]}
    rm(r)}
  if(any(Gdata$Inst == "keine Angabe")==TRUE){
    keineangabe_alt <- c(which(Gdata$Inst == "keine Angabe"))
    keineangabe <- c(1:length(keineangabe_alt))
    keineangabe_Gdata <- c(paste("keine Angabe", keineangabe, sep=" "))
    for (k in keineangabe_alt){
    Gdata[k,2] <- keineangabe_Gdata[which(keineangabe_alt == k)]}
    rm(k)}
  
  institutions <- c(paste(sort(unique(Gdata$Inst))))
  Gdata_institutions <- Gdata[-c(1:nrow(Gdata)),]
  columnstosum <- c(5:ncol(Gdata))
  
  for (i in institutions){
    inst <- subset(Gdata, Gdata$Inst == i)
    inst <- rbind(inst,
                  c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                    colSums(inst[,-c(1:4)])),
                  stringsAsFactors = FALSE)
    Gdata_institutions <- rbind(Gdata_institutions, inst[nrow(inst),])
  }
  rownames(Gdata_institutions) <- Gdata_institutions[,2] #Inst as rownames
  Gdata_K <- as.character(Gdata_institutions$Kategorie)
  Gdata <- Gdata_institutions[,-c(1:4)]
  Gdata_institutions <- institutions
  rm(inst, i, institutions)
  
  ## links
  w1 <- colnames(Gdata[1:ncol(Gdata)])
  w2 <- rownames(Gdata)
  w3 <- c(paste("ws", c(1:ncol(Gdata)), sep = ""))
  w4 <- c(paste("inst", c(1:nrow(Gdata)), sep = ""))
  w5 <- c(w3, w4)
  w6 <- c(w1, w2)
  
  columns_Gdata <- c(1:ncol(Gdata))
  rows_Gdata <- c(1:nrow(Gdata))
  
  links <- data.frame(from=character(), to=character(), type=character(), no_participants=numeric(), stringsAsFactors = FALSE)
  
  for (c in columns_Gdata){
    for (r in rows_Gdata){
      if (Gdata[r,c]!=0){
        links <- rbind(links,
                       c(w3[c], w4[r], "participated", Gdata[r,c]),
                       stringsAsFactors = FALSE)
      } else {}
    }
  }
  colnames(links) <- c("from", "to", "type", "no_participants")
  links$no_participants <- as.numeric(links$no_participants)
  
  return(links)
}
```


# Analyse

```{r Laden der Rohdaten - RUN, eval=FALSE}
library(xlsx)

## Load raw data
Raw_workshops <- read.xlsx(file = "Daten/workshopdaten_20180619.xlsx", sheetIndex = 1, encoding="UTF-8")
Raw_workshops_info <- read.xlsx(file = "Daten/workshopdaten_20180619.xlsx", sheetIndex = 2, encoding="UTF-8")

detach("package:xlsx", unload=TRUE)
```

```{r Vorbereitung der Daten, eval=FALSE}
## Edit WS info
WS_info <- Raw_workshops_info
WS_info <- WS_info[-c(42,43),-c(6,8:ncol(WS_info))]
WS_info$Workshop <- as.character(WS_info$Workshop)

## Prepare datasets "WS"
Gdata_WS <- Raw_workshops
Gdata_WS <- Gdata_WS[-c(1,1278:nrow(Gdata_WS)),-c(52:57)] # Zeilen und Spalten loeschen
names(Gdata_WS) <- c("Titel", "cutoff", "Name", "Inst", "Land",
                  "Inst_lang", "addinfo", "Kategorie", "Inst_alt", "Kontakt", 
                  "WS1", "WS2", "WS3", "WS4", "WS5", 
                  "WS6", "WS7", "WS8", "WS9", "WS10",
                  "WS11", "WS12", "WS13", "WS14", "WS15", 
                  "WS16", "WS17", "WS18", "WS19", "WS20",
                  "WS21", "WS22", "WS23", "WS24", "WS25", 
                  "WS26", "WS27", "WS28", "WS29", "WS30",
                  "WS31", "WS32", "WS33", "WS34", "WS35",
                  "WS36", "WS37", "WS38", "WS39", "WS40", "WS41")
Gdata_WS <- Gdata_WS[,-c(1,6,7,9,10)]
Gdata_WS <- Gdata_WS[-c(which(Gdata_WS$cutoff == "1")),] # Institutswechsel Zeilen loeschen
Gdata_WS <- Gdata_WS[,-1] # Cutoff loeschen

Gdata_WS$Name <- as.character(Gdata_WS$Name)
Gdata_WS$Inst <- as.character(Gdata_WS$Inst)
Gdata_WS$Land <- as.character(Gdata_WS$Land)
Gdata_WS$Kategorie <- as.character(Gdata_WS$Kategorie)
columnno5 <- c(5:ncol(Gdata_WS))
for (c in columnno5){
  Gdata_WS[,c] <- as.numeric.factor(Gdata_WS[,c])
  }
rowno <- c(1:nrow(Gdata_WS))
for (r in rowno){
  if ((Gdata_WS[r,2] == "keine Angabe") & (Gdata_WS[r,3] == "keine Angabe")){
  Gdata_WS[r,3] <- "Deutschland"}
  if (Gdata_WS[r,4] == "Behörde"){
    Gdata_WS[r,4] <- "Behoerde"}
  if (Gdata_WS[r,4] == "Verbände"){
    Gdata_WS[r,4] <- "Verbaende"}
}
rm(c, columnno5, r, rowno)
```

```{r Subset der Daten, eval=FALSE}
Gdata <- subset_workshops(Gdata_WS, subset = "nefobiodiv")
Gdata <- subset_workshops(Gdata, subset = "2013")

```

```{r Graph-objects, eval=FALSE}
library(igraph)

# 1-mode
nodes_ws1 <- create_nodes_workshops_1mode(Gdata)
links_ws1 <- create_links_workshops_1mode(Gdata)
ws1 <- graph_from_data_frame(d = links_ws1, vertices = nodes_ws1, directed = F)

# 2-mode
nodes_ws2 <- create_nodes_workshops_2mode(Gdata)
links_ws2 <- create_links_workshops_2mode(Gdata)
ws2 <- graph_from_data_frame(d = links_ws2, vertices = nodes_ws2, directed = F)

# Berechnung statistischer Standardwerte
V(ws1)$degree <- degree(ws1)
V(ws1)$betweenness <- betweenness(ws1, directed = F)
V(ws2)$degree <- degree(ws2)
V(ws2)$betweenness <- betweenness(ws2, directed = F)

detach("package:igraph", unload=TRUE)
```

```{r SNA EDIT, eval=FALSE}
library(igraph)

workshops_sna <- data.frame(name = append(colnames(Gdata[-c(1:4)]),V(ws1)$name))
workshops_sna$type <- NA
workshops_sna[1:length(colnames(Gdata[-c(1:4)])),2] <- "workshop"
workshops_sna[c((length(colnames(Gdata[-c(1:4)]))+1):nrow(workshops_sna)),2] <- "institution"
workshops_sna$kategorie <- NA
workshops_sna$degree1 <- NA
workshops_sna$betweenness1 <- NA
workshops_sna$degree2 <- NA
workshops_sna$betweenness2 <- NA

rows1 <- c((ncol(Gdata[-c(1:4)])+1):nrow(workshops_sna))
rows2 <- c(1:ncol(Gdata[-c(1:4)]))
workshops_sna[rows1,4] <- igraph::degree(ws1)
workshops_sna[rows1,5] <- round(igraph::betweenness(ws1),digits=2)
workshops_sna[,6] <- igraph::degree(ws2)[1:length(V(ws2)$name)]
#workshops_sna[rows2,6] <- igraph::degree(ws2)[(nrow(Gdata)+1):nrow(workshops_sna)]
workshops_sna[,7] <- round((igraph::betweenness(ws2)[1:length(V(ws2)$name)]),digits=2)
#workshops_sna[rows2,7] <- round((igraph::betweenness(ws2)[(nrow(Gdata)+1):nrow(workshops_sna)]),digits=2)

workshops_sna$degree1rel <- NA
workshops_sna$degree2rel <- NA
workshops_sna$betweenness1rel <- NA
workshops_sna$betweenness2rel <- NA
workshops_sna[rows1,9] <- round(workshops_sna[rows1,5] / max(workshops_sna[rows1,5]),digits=2)
workshops_sna[,10] <- round(workshops_sna[,7] / max(workshops_sna[,7]),digits=2)
workshops_sna[rows1,11] <- round(workshops_sna[rows1,6] / max(workshops_sna[rows1,6]),digits=2)
workshops_sna[,12] <- round(workshops_sna[,8] / max(workshops_sna[,8]),digits=2)

rm(rows1, rows2)
xlsx::write.xlsx(workshops_sna, file = "SNA_Statistik_Workshops_biodiv_2012.xls") ### EDIT

igraph::graph.density(ws1)

#ntw_WS_ipbesforen <- network::network(Gdata_WS_ipbesforen)
#summary(ntw_WS_ipbesforen)
#igraph::graph.density(igraph::graph.incidence(Gdata_WS_ipbesforen))

#round(sna::betweenness(ntw_WS_ipbesforen))
#betw_values_WS_ipbesforen <- data.frame(betweenness = round(sna::betweenness(ntw_WS_ipbesforen)), actor_abbr = c(row.names(Gdata_WS_ipbesforen), c("1", "2", "3", "4", "5", "6")), kat = c(Gdata_WS_ipbesforen_K, nodes_ipbesforen[c(1:6),5]))
#betw_values_WS_ipbesforen <- sort(betw_values_WS_ipbesforen, decreasing = T)
#xlsx::write.xlsx(betw_values_WS_ipbesforen, file = "Workshops_ipbesforen_betweenness.xls")

length(which(V(ws2)$kategorie == "Wissenschaft"))
length(which(V(ws2)$kategorie == "Behoerde"))
length(which(V(ws2)$kategorie == "Wirtschaft"))
length(which(V(ws2)$kategorie == "Verbaende"))
length(which(V(ws2)$kategorie == "Medien"))
length(which(V(ws2)$kategorie == "keine Angabe"))

detach("package:igraph", unload=TRUE)
```


# Visualisierung

```{r Anzahl Institutionen pro Kategorie, eval=FALSE}
library(igraph)

plotK <- data.frame(n = c(length(which(V(ws2)$kategorie == "Wissenschaft")),
                          length(which(V(ws2)$kategorie == "Behoerde")),
                          length(which(V(ws2)$kategorie == "Wirtschaft")),
                          length(which(V(ws2)$kategorie == "Verbaende")),
                          length(which(V(ws2)$kategorie == "Medien")),
                          length(which(V(ws2)$kategorie == "keine Angabe"))))
plot <- barplot(plotK$n, col = c(rgb(92,139,255,max=255), #[-6,]
                            rgb(219,174,0,max=255), 
                            rgb(11,33,94,max=255), 
                            rgb(0,155,68,max=255), 
                            rgb(180,33,0,max=255),
                            rgb(255,161,213,max=255)),
        ylim = c(0,120), yaxt='n',
        names.arg=c("Wissenschaft", "Behörde", "Wirtschaft", "Verbände", "Medien", "keine Angabe"),
        cex.names = 1.5)
text(x = plot, y = plotK$n, label = plotK$n, pos = 3, cex = 1.5, col = "black") #0.8

detach("package:igraph", unload=TRUE)
```

```{r zeitlich, eval=FALSE}
library(xlsx)

zeitlich <- read.xlsx(file = "Ergebnisse/biodiv_zeitlich/workshops_zeitlich.xlsx", sheetIndex = 1, encoding="UTF-8")

# Institutionen pro Kategorie
plot(zeitlich$Wissenschaft ~ zeitlich$Jahr, col = rgb(92,139,255,max=255),
     xlab = "Jahr",
     ylab = "Anzahl Institutionen",
     pch = 4,
     ylim = c(0,55))
points(zeitlich$Behoerde ~ jitter(zeitlich$Jahr, .1), col = rgb(219,174,0,max=255), pch = 4)
points(zeitlich$Wirtschaft ~ jitter(zeitlich$Jahr, .1), col = rgb(11,33,94,max=255), pch = 4)
points(zeitlich$Verbaende ~ jitter(zeitlich$Jahr, .1), col = rgb(0,155,68,max=255), pch = 4)
points(zeitlich$Medien ~ jitter(zeitlich$Jahr, .1), col = rgb(180,33,0,max=255), pch = 4)
abline(glm(zeitlich$Wissenschaft ~ zeitlich$Jahr), col = rgb(92,139,255,max=255))
abline(glm(zeitlich$Behoerde ~ zeitlich$Jahr), col = rgb(219,174,0,max=255))
abline(glm(zeitlich$Wirtschaft ~ zeitlich$Jahr), col = rgb(11,33,94,max=255))
abline(glm(zeitlich$Verbaende ~ zeitlich$Jahr), col = rgb(0,155,68,max=255))
abline(glm(zeitlich$Medien ~ zeitlich$Jahr), col = rgb(180,33,0,max=255))
abline(glm(zeitlich$Institutionen*.5 ~ zeitlich$Jahr), col = "dark grey", lty = 2)
legend("topright", legend = c("Wissenschaft", "Behörde", "Wirtschaft", "Verbände", "Medien", 
                              "GLM der Anzahl Institutionen / 2"), 
       fill = c(rgb(92,139,255,max=255), rgb(219,174,0,max=255), 
               rgb(11,33,94,max=255), rgb(0,155,68,max=255), rgb(180,33,0,max=255), "dark grey"),
       bty = "n", cex = 1)

summary(glm(zeitlich$Wissenschaft ~ zeitlich$Jahr)) # p=0.03
summary(glm(zeitlich$Behoerde ~ zeitlich$Jahr)) # p=0.7
summary(glm(zeitlich$Wirtschaft ~ zeitlich$Jahr)) # p=0.1
summary(glm(zeitlich$Verbaende ~ zeitlich$Jahr)) # p=0.3
summary(glm(zeitlich$Medien ~ zeitlich$Jahr)) # p=0.3
summary(glm(zeitlich$Institutionen ~ zeitlich$Jahr)) # p=0.7


# Institutionen pro Kategorie relativ zur Anzahl Workshops
plot((zeitlich$Wissenschaft/zeitlich$Workshops) ~ zeitlich$Jahr, col = rgb(92,139,255,max=255),
     xlab = "Jahr",
     ylab = "Anzahl Institutionen",
     pch = 4,
     ylim = c(0,20))
points((zeitlich$Behoerde/zeitlich$Workshops) ~ jitter(zeitlich$Jahr, .1), col = rgb(219,174,0,max=255), pch = 4)
points((zeitlich$Wirtschaft/zeitlich$Workshops) ~ jitter(zeitlich$Jahr, .1), col = rgb(11,33,94,max=255), pch = 4)
points((zeitlich$Verbaende/zeitlich$Workshops) ~ jitter(zeitlich$Jahr, .1), col = rgb(0,155,68,max=255), pch = 4)
points((zeitlich$Medien/zeitlich$Workshops) ~ jitter(zeitlich$Jahr, .1), col = rgb(180,33,0,max=255), pch = 4)
abline(glm((zeitlich$Wissenschaft/zeitlich$Workshops) ~ zeitlich$Jahr), col = rgb(92,139,255,max=255))
abline(glm((zeitlich$Behoerde/zeitlich$Workshops) ~ zeitlich$Jahr), col = rgb(219,174,0,max=255))
abline(glm((zeitlich$Wirtschaft/zeitlich$Workshops) ~ zeitlich$Jahr), col = rgb(11,33,94,max=255))
abline(glm((zeitlich$Verbaende/zeitlich$Workshops) ~ zeitlich$Jahr), col = rgb(0,155,68,max=255))
abline(glm((zeitlich$Medie/zeitlich$Workshops)n ~ zeitlich$Jahr), col = rgb(180,33,0,max=255))
abline(glm((zeitlich$Institutionen*.5/zeitlich$Workshops) ~ zeitlich$Jahr), col = "dark grey", lty = 2)
legend("topright", legend = c("Wissenschaft", "Behörde", "Wirtschaft", "Verbände", "Medien", 
                              "GLM der Anzahl Institutionen / 2"), 
       fill = c(rgb(92,139,255,max=255), rgb(219,174,0,max=255), 
               rgb(11,33,94,max=255), rgb(0,155,68,max=255), rgb(180,33,0,max=255), "dark grey"),
       bty = "n", cex = 1)

summary(glm((zeitlich$Wissenschaft/zeitlich$Workshops) ~ zeitlich$Jahr)) # p=0.2
summary(glm((zeitlich$Behoerde/zeitlich$Workshops) ~ zeitlich$Jahr)) # p=0.7
summary(glm((zeitlich$Wirtschaft/zeitlich$Workshops) ~ zeitlich$Jahr)) # p=0.1
summary(glm((zeitlich$Verbaende/zeitlich$Workshops) ~ zeitlich$Jahr)) # p=0.1
summary(glm((zeitlich$Medien/zeitlich$Workshops) ~ zeitlich$Jahr)) # p=0.5
summary(glm((zeitlich$Institutionen/zeitlich$Workshops) ~ zeitlich$Jahr)) # p=0.5


# Institutionen pro Kategorie: Wissenschaft vs. Wirtschaft/Verbände
plot(zeitlich$Wissenschaft ~ zeitlich$Jahr, col = rgb(92,139,255,max=255),
     xlab = "Jahr",
     ylab = "Anzahl Institutionen",
     pch = 4,
     ylim = c(0,55))
points((zeitlich$Wirtschaft + zeitlich$Verbaende) ~ jitter(zeitlich$Jahr, .1), col = "black", pch = 4)
abline(glm(zeitlich$Wissenschaft ~ zeitlich$Jahr), col = rgb(92,139,255,max=255))
abline(glm((zeitlich$Wirtschaft + zeitlich$Verbaende) ~ zeitlich$Jahr), col = "black")
#abline(glm(zeitlich$Institutionen*.5 ~ zeitlich$Jahr), col = "dark grey", lty = 2)
legend("topright", legend = c("Wissenschaft", "Wirtschaft + Verbände"), 
       fill = c(rgb(92,139,255,max=255), "black"),
       bty = "n", cex = 1)

summary(glm(zeitlich$Wissenschaft ~ zeitlich$Jahr)) # p=0.03
summary(glm((zeitlich$Wirtschaft + zeitlich$Verbaende) ~ zeitlich$Jahr)) # p=0.1
cor.test(zeitlich$Wissenschaft,(zeitlich$Wirtschaft + zeitlich$Verbaende),method="spearman") # p=0.4


# Dichte pro Jahr
plot(zeitlich$Dichte ~ zeitlich$Jahr, col = "black",
     xlab = "Jahr",
     ylab = "Netzwerk-Dichte",
     pch = 4)
abline(glm(zeitlich$Dichte ~ zeitlich$Jahr), col = "blue")
abline(glm(zeitlich$Institutionen*.01 ~ zeitlich$Jahr), col = "dark grey", lty = 2)
legend("bottomright", legend = c("Netzwerk-Dichte pro Jahr", "GLM der Netzwerk-Dichte", "GLM der Anzahl Institutionen / 100"),
       col = c("black", "blue", "dark grey"),
       pch = c(4, NA, NA),
       lty = c(NA, 1, 2),
       bty = "n", cex = 1)
summary(glm(zeitlich$Dichte ~ zeitlich$Jahr)) # p=0.2

shapiro.test(zeitlich$Dichte) # p>0.5 = normalverteilt
shapiro.test(zeitlich$Institutionen) # nicht normalverteilt => Korrelation nach Spearman
cor.test(zeitlich$Dichte,zeitlich$Institutionen,method="spearman") # p=0.8

mean(zeitlich$Dichte)
boxplot(zeitlich$Dichte)
points(x = 1,y = median(zeitlich$Dichte), col = "blue", pch = 3)

# Dichte aufbauend
plot(zeitlich$Dichte_aufbauend ~ zeitlich$Jahr, col = "blue",
     xlab = "Jahr",
     ylab = "Netzwerk-Dichte",
     pch = 4)
abline(glm(zeitlich$Dichte_aufbauend ~ zeitlich$Jahr), col = "blue")
legend("topright", legend = c("Netzwerk-Dichte"), 
       fill = c("blue"),
       bty = "n", cex = 1)
summary(glm(zeitlich$Dichte_aufbauend ~ zeitlich$Jahr)) # p=0.2

detach("package:xlsx", unload=TRUE)
```

```{r Betweenness über Degree, eval=FALSE}
# 1-Mode
regr1 <- data.frame(degree = workshops_sna[-c(1:37),4], betweenness = workshops_sna[-c(1:37),5])

plot(regr1$betweenness ~ regr1$degree,
     xlab = "Degree-Zentralität",
     ylab = "Betweenness-Zentralität",
     pch = 4)
abline(glm(regr1$betweenness ~ regr1$degree), col = "blue")
summary(glm(regr1$betweenness ~ regr1$degree))

shapiro.test(regr1$degree) # nicht normalverteilt
shapiro.test(regr1$betweenness) # nicht normalverteilt => Korrelation nach Spearman
cor.test(regr1$degree,regr1$betweenness,method="spearman")

# 2-Mode
regr2 <- data.frame(degree = workshops_sna[-c(1:37),6], betweenness = workshops_sna[-c(1:37),7])

plot(regr2$betweenness ~ regr2$degree,
     xlab = "Degree-Zentralität",
     ylab = "Betweenness-Zentralität",
     pch = 4)
abline(glm(regr2$betweenness ~ regr2$degree), col = "blue")
summary(glm(regr2$betweenness ~ regr2$degree))

shapiro.test(regr2$degree) # nicht normalverteilt
shapiro.test(regr2$betweenness) # nicht normalverteilt => Korrelation nach Spearman
cor.test(regr2$degree,regr2$betweenness,method="spearman")
```

```{r igraph EDIT, eval=FALSE}
library(igraph)
library(RColorBrewer)

# Berechnung einer Farbpalette ### CHOOSE
coul7 <- brewer.pal(7, "YlOrBr")
palette_ws1 <- as.numeric(degree(ws1))  # Farbpalette entsprechend vertex.size
palette_ws1[which(palette_ws1 %in% c(1:50))] <- 1
palette_ws1[palette_ws1 %in% c(51:100)] <- 2
palette_ws1[palette_ws1 %in% c(101:200)] <- 3
palette_ws1[palette_ws1 %in% c(201:300)] <- 4
palette_ws1[palette_ws1 %in% c(301:400)] <- 5
palette_ws1[palette_ws1 %in% c(401:500)] <- 6
palette_ws1[palette_ws1 > 500] <- 7
farben_ws1 <- coul7[palette_ws1]

coul7 <- brewer.pal(7, "YlOrBr")
palette_ws1 <- as.numeric(degree(ws1))  # Farbpalette entsprechend vertex.size
palette_ws1[which(palette_ws1 == 1)] <- 1
palette_ws1[which(palette_ws1 %in% c(2:10))] <- 2
palette_ws1[palette_ws1 %in% c(11:20)] <- 3
palette_ws1[palette_ws1 %in% c(21:30)] <- 4
palette_ws1[palette_ws1 %in% c(31:40)] <- 5
palette_ws1[palette_ws1 %in% c(41:50)] <- 6
palette_ws1[palette_ws1 > 50] <- 7
farben_ws1 <- coul7[palette_ws1]

# Plotten
lyout_ws <- layout.fruchterman.reingold(ws2)

## Farben und Größe
E(ws2)$color_st <- "grey"
E(ws2)$color_k <- "grey"
V(ws2)$color_st[V(ws2)$type == "workshop"] <- "dark grey" # Workshops
V(ws2)$color_st[V(ws2)$type == "institution"] <- farben_ws1 # Institutionen
V(ws2)$color_k[V(ws2)$type == "workshop"] <- "dark grey" # Workshops
V(ws2)$color_k[V(ws2)$kategorie == "Wissenschaft"] <- rgb(92,139,255,max=255)
V(ws2)$color_k[V(ws2)$kategorie == "Behoerde"] <- rgb(219,174,0,max=255)
V(ws2)$color_k[V(ws2)$kategorie == "Wirtschaft"] <- rgb(11,33,94,max=255)
V(ws2)$color_k[V(ws2)$kategorie == "Verbaende"] <- rgb(0,155,68,max=255)
V(ws2)$color_k[V(ws2)$kategorie == "Medien"] <- rgb(180,33,0,max=255)
V(ws2)$color_k[V(ws2)$kategorie == "keine Angabe"] <- rgb(255,161,213,max=255)
V(ws2)$label.cex[V(ws2)$type == "workshop"] <- 0.5 # Workshops
V(ws2)$label.cex[V(ws2)$type == "institution"] <- 1.5 * V(ws1)$betweenness / max(V(ws1)$betweenness)+ 0.5 # Institutionen
V(ws2)$vertex.size <- 3 * V(ws2)$degree / max(V(ws2)$degree) + 5
V(ws2)$instnames <- V(ws2)$name
V(ws2)$instnames[V(ws2)$type == "workshop"] <- NA
V(ws2)$wsnames <- V(ws2)$name
V(ws2)$wsnames[V(ws2)$type == "institution"] <- NA
V(ws2)$framecolorcover <- NA
V(ws2)$framecolorcover[V(ws2)$type == "institution"] <- "black"

## Workshops
par(mfrow=c(1,1))
plot(ws2, vertex.size = 3, vertex.color = V(ws2)$color_st,
     vertex.label = V(ws2)$instnames, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0, edge.color = E(ws2)$color_st,
     layout = lyout_ws)
plot(ws2, vertex.size = 3, vertex.color = V(ws2)$color_st,
     vertex.label = V(ws2)$names, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0, edge.color = E(ws2)$color_st,
     layout = lyout_ws)

## Workshops: Kategorien
par(mfrow=c(1,1))
plot(ws2, vertex.size = 3, vertex.color = V(ws2)$color_k,
     vertex.label = NA, vertex.frame.color = V(ws2)$framecolorcover, 
     edge.arrow.size = 0, edge.color = E(ws2)$color_k,
     layout = lyout_ws)

## Workshops: Kategorien mit WS Name
par(mfrow=c(1,1))
plot(ws2, vertex.size = 3, vertex.color = V(ws2)$color_k,
     vertex.label = V(ws2)$wsnames, vertex.label.family = "Calibri", vertex.label.color = "black",
     vertex.frame.color = V(ws2)$framecolorcover, 
     edge.arrow.size = 0, edge.color = E(ws2)$color_k,
     layout = lyout_ws)

## Kombination 1
par(mfrow=c(1,2))
plot(ws2, vertex.size = 3, vertex.color = V(ws2)$color_st,
     vertex.label = V(ws2)$instnames, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0, edge.color = E(ws2)$color_st,
     layout = lyout_ws)
plot(ws2, vertex.size = 3, vertex.color = V(ws2)$color_k,
     vertex.label = NA, vertex.frame.color = V(ws2)$framecolorcover, 
     edge.arrow.size = 0, edge.color = E(ws2)$color_k,
     layout = lyout_ws)

## Kombination 2
par(mfrow=c(1,2))
plot(ws2, vertex.size = 3, vertex.color = V(ws2)$color_st,
     vertex.label = V(ws2)$instnames, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0, edge.color = E(ws2)$color_st,
     layout = lyout_ws)
plot(ws2, vertex.size = 3, vertex.color = V(ws2)$color_k,
     vertex.label = V(ws2)$wsnames, vertex.label.family = "Calibri", vertex.label.color = "black",
     vertex.frame.color = V(ws2)$framecolorcover, 
     edge.arrow.size = 0, edge.color = E(ws2)$color_k,
     layout = lyout_ws)

# Cover
V(ws2)$partnames <- V(ws2)$name
V(ws2)$partnames[V(ws2)$type == "workshop"] <- NA
V(ws2)$framecolorcover <- NA
V(ws2)$framecolorcover[V(ws2)$type == "workshop"] <- "black"
par(mfrow=c(1,1))
plot(ws2, vertex.size = V(ws2)$vertex.size, vertex.color = V(ws2)$color_st,
     vertex.label = V(ws2)$partnames, vertex.label.family = "Calibri",
     vertex.frame.color = V(ws2)$framecolorcover, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_ws)

detach("package:igraph", unload=TRUE)
detach("package:RColorBrewer", unload=TRUE)
```




#Rest
### IPBES Nationale Foren
```{r Deskriptive Analyse, eval=FALSE}
Gdata_WS_ipbesforen$Name <- as.character(Gdata_WS_ipbesforen$Name)
Gdata_WS_ipbesforen$Inst <- as.character(Gdata_WS_ipbesforen$Inst)
Gdata_WS_ipbesforen$Land <- as.character(Gdata_WS_ipbesforen$Land)
Gdata_WS_ipbesforen$Kategorie <- as.character(Gdata_WS_ipbesforen$Kategorie)
columnno <- c(5:ncol(Gdata_WS_ipbesforen))
for (c in columnno){
  Gdata_WS_ipbesforen[,c] <- as.numeric.factor(Gdata_WS_ipbesforen[,c])
  }
rm(columnno, c)

rowno <- c(1:nrow(Gdata_WS_ipbesforen))
for (r in rowno){
  if ((Gdata_WS_ipbesforen[r,2] == "keine Angabe") & (Gdata_WS_ipbesforen[r,3] == "keine Angabe")){
    Gdata_WS_ipbesforen[r,3] <- "Deutschland"}
  if (Gdata_WS_ipbesforen[r,4] == "Beh?rde"){
    Gdata_WS_ipbesforen[r,4] <- "Behoerde"}
  if (Gdata_WS_ipbesforen[r,4] == "Verb?nde"){
    Gdata_WS_ipbesforen[r,4] <- "Verbaende"}
}
rm(rowno, r)
Gdata_WS_ipbesforen <- subset(Gdata_WS_ipbesforen, Gdata_WS_ipbesforen$Land == "Deutschland")
Gdata_WS_ipbesforen <- Gdata_WS_ipbesforen[order(Gdata_WS_ipbesforen$Inst, Gdata_WS_ipbesforen$Name),]
Gdata_WS_ipbesforen$overview <- apply(Gdata_WS_ipbesforen[,c(5:ncol(Gdata_WS_ipbesforen))],1,paste,collapse="-")
Gdata_WS_ipbesforen <- Gdata_WS_ipbesforen[-c(which(Gdata_WS_ipbesforen$overview == paste(replicate((ncol(Gdata_WS_ipbesforen)-5), "0"), collapse = "-"))),]
Gdata_WS_ipbesforen <- Gdata_WS_ipbesforen[,-ncol(Gdata_WS_ipbesforen)]

selbststaendig_alt <- c(which(Gdata_WS_ipbesforen$Inst == "Selbstst?ndig"))
selbststaendig <- c(1:length(selbststaendig_alt))
selbststaendig_ipbesforen <- c(paste("Selbstst?ndig", selbststaendig, sep=" "))
keineangabe_alt <- c(which(Gdata_WS_ipbesforen$Inst == "keine Angabe"))
keineangabe <- c(1:length(keineangabe_alt))
keineangabe_ipbesforen <- c(paste("keine Angabe", keineangabe, sep=" "))
for (r in selbststaendig_alt){
  Gdata_WS_ipbesforen[r,2] <- selbststaendig_ipbesforen[which(selbststaendig_alt == r)]}
for (k in keineangabe_alt){
  Gdata_WS_ipbesforen[k,2] <- keineangabe_ipbesforen[which(keineangabe_alt == k)]}
rm(r, k, selbststaendig, selbststaendig_alt, keineangabe, keineangabe_alt)

length(unique(Gdata_WS_ipbesforen$Name)) # Anzahl Teilnehmer_innen: 257
length(unique(Gdata_WS_ipbesforen$Inst)) # Anzahl Institutionen: 105
length(unique(Gdata_WS_ipbesforen[duplicated(Gdata_WS_ipbesforen$Name),]$Name)) # Anzahl Teilnehmer_innen mit verschiedenen Inst: 14

# Anzahl Personen pro Kategorie
length(unique(Gdata_WS_ipbesforen$Name[which(Gdata_WS_ipbesforen$Kategorie == "Wissenschaft")])) #137
length(unique(Gdata_WS_ipbesforen$Name[which(Gdata_WS_ipbesforen$Kategorie == "Behoerde")])) #67
length(unique(Gdata_WS_ipbesforen$Name[which(Gdata_WS_ipbesforen$Kategorie == "Wirtschaft")])) #24
length(unique(Gdata_WS_ipbesforen$Name[which(Gdata_WS_ipbesforen$Kategorie == "Verbaende")])) #27
length(unique(Gdata_WS_ipbesforen$Name[which(Gdata_WS_ipbesforen$Kategorie == "Medien")])) #0
length(unique(Gdata_WS_ipbesforen$Name[which(Gdata_WS_ipbesforen$Kategorie == "keine Angabe")])) #6
261-257 # Anzahl Personen, die mit Inst-Wechsel auch Kat-Wechsel hatten: 10

# Anzahl Institutionen pro Kategorie
length(unique(Gdata_WS_ipbesforen$Inst[which(Gdata_WS_ipbesforen$Kategorie == "Wissenschaft")])) #57
length(unique(Gdata_WS_ipbesforen$Inst[which(Gdata_WS_ipbesforen$Kategorie == "Behoerde")])) #13
length(unique(Gdata_WS_ipbesforen$Inst[which(Gdata_WS_ipbesforen$Kategorie == "Wirtschaft")])) #11
length(unique(Gdata_WS_ipbesforen$Inst[which(Gdata_WS_ipbesforen$Kategorie == "Verbaende")])) #20
length(unique(Gdata_WS_ipbesforen$Inst[which(Gdata_WS_ipbesforen$Kategorie == "Medien")])) #0
length(unique(Gdata_WS_ipbesforen$Inst[which(Gdata_WS_ipbesforen$Kategorie == "keine Angabe")])) #6

# Kategorien prozentual
round(100/105*57, digits = 0) #54
round(100/105*13, digits = 0) #12
round(100/105*11, digits = 0) #10
round(100/105*20, digits = 0) #19
round(100/105*0, digits = 0) #0
round(100/105*6, digits = 0) #6

colno <- c(5:ncol(Gdata_WS_ipbesforen))
WS_ipbesforen_TN  <- 0
for (c in colno){
  WS_ipbesforen_TN <- WS_ipbesforen_TN + sum(as.numeric(Gdata_WS_ipbesforen[,c]))
}
rm(colno, c)
WS_ipbesforen_TN # Summe Teilnehmende an NeFo-Workshops: 438
WS_ipbesforen_TN/6 # Durchschnitt der Anzahl Teilnehmender: 73
```
```{r Transformation f?r Visualisierung, eval=FALSE}
WS_ipbesforen_institutions <- c(paste(sort(unique(Gdata_WS_ipbesforen$Inst))))
Gdata_WS_ipbesforen_institutions <- Gdata_WS_ipbesforen[-c(1:nrow(Gdata_WS_ipbesforen)),]
for (i in WS_ipbesforen_institutions){
  inst <- subset(Gdata_WS_ipbesforen, Gdata_WS_ipbesforen$Inst == i)
  inst <- rbind(inst,
                c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                  sum(inst[,5]),sum(inst[,6]),sum(inst[,7]),
                  sum(inst[,8]),sum(inst[,9]),sum(inst[,10])),
                stringsAsFactors = FALSE)
  Gdata_WS_ipbesforen_institutions <- rbind(Gdata_WS_ipbesforen_institutions, inst[nrow(inst),])
}
rownames(Gdata_WS_ipbesforen_institutions) <- Gdata_WS_ipbesforen_institutions[,2] #Inst as rownames
Gdata_WS_ipbesforen_K <- as.character(Gdata_WS_ipbesforen_institutions$Kategorie)
Gdata_WS_ipbesforen <- Gdata_WS_ipbesforen_institutions[,-c(1:4)]
Gdata_WS_ipbesforen_institutions <- WS_ipbesforen_institutions
rm(inst, i, WS_ipbesforen_institutions)
```
```{r Visualisierung, eval=FALSE}
# edgelist
## nodes
w1 <- colnames(Gdata_WS_ipbesforen[1:ncol(Gdata_WS_ipbesforen)])
w2 <- rownames(Gdata_WS_ipbesforen)
w3 <- c(paste("ws", c(1:ncol(Gdata_WS_ipbesforen)), sep = ""))
w4 <- c(paste("inst", c(1:nrow(Gdata_WS_ipbesforen)), sep = ""))
w5 <- c(w3, w4)
w6 <- c(w1, w2)
nodes <- as.data.frame(cbind(w5, w6))
names(nodes) <- c("id", "name")
nodes$type_no <- NA
nodes[c(1:ncol(Gdata_WS_ipbesforen)),3] <- 1
nodes[c((ncol(Gdata_WS_ipbesforen)+1):nrow(nodes)),3] <- 2
nodes$type <- NA
nodes[c(1:ncol(Gdata_WS_ipbesforen)),4] <- "workshop"
nodes[c((ncol(Gdata_WS_ipbesforen)+1):nrow(nodes)),4] <- "institution"
nodes$kategorie <- NA
nodes[c(1:ncol(Gdata_WS_ipbesforen)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] %in% nodes[c(1:ncol(Gdata_WS_ipbesforen)),2])]
nodes[c((ncol(Gdata_WS_ipbesforen)+1):nrow(nodes)),5] <- Gdata_WS_ipbesforen_K
#nodes$weight <- NA
nodes$id <- as.character(nodes$id)
nodes$name <- as.character(nodes$name)

nodes[c(1:ncol(Gdata_WS_ipbesforen)),2] <- c("1", "2", "3", "4", "5", "6")
nodes$name[which(nodes$name %in% selbststaendig_ipbesforen)] <- "Selbstst?ndig"
nodes$name[which(nodes$name %in% keineangabe_ipbesforen)] <- "k.A."


## links
columns_Gdata <- c(1:ncol(Gdata_WS_ipbesforen))
rows_Gdata <- c(1:nrow(Gdata_WS_ipbesforen))
links <- data.frame(from=character(), to=character(), type=character(), no_participants=numeric(),
                        stringsAsFactors = FALSE)
for (c in columns_Gdata){
  for (r in rows_Gdata){
    if (Gdata_WS_ipbesforen[r,c]!=0){
      links <- rbind(links,
                     c(w3[c], w4[r], "participated", Gdata_WS_ipbesforen[r,c]),
                     stringsAsFactors = FALSE)
    } else {}
  }
}
colnames(links) <- c("from", "to", "type", "no_participants")
links$no_participants <- as.numeric(links$no_participants)

nodes_ipbesforen <- nodes
links_ipbesforen <- links
rm(w1, w2, w3, w4, w5, w6, columns_Gdata, rows_Gdata, c, r, nodes, links)


# Visualisierung
library(igraph)
library(RColorBrewer)

## Erstellen des Graph-Objektes
WS_ipbesforen <- graph_from_data_frame(d = links_ipbesforen, vertices = nodes_ipbesforen, directed = F)
WS_ipbesforen <- delete.isolates(WS_ipbesforen) ### deleting isolates

## Berechnung statistischer Werte
V(WS_ipbesforen)$degree <- degree(WS_ipbesforen)
V(WS_ipbesforen)$betweenness <- betweenness(WS_ipbesforen, directed = F)

## Berechnung einer Farbpalette
coul6 <- brewer.pal(6, "YlOrBr")
palette_ipbesforen <- as.numeric(degree(WS_ipbesforen))  # Farbpalette entsprechend vertex.size
farben_ipbesforen <- coul6[palette_ipbesforen]
farben_ipbesforen[1:6] <- "dark grey"

## Plotten 1
V(WS_ipbesforen)$vertex.size <- 3 * V(WS_ipbesforen)$degree / max(V(WS_ipbesforen)$degree) + 5
V(WS_ipbesforen)$label.cex <- 1.5 * V(WS_ipbesforen)$betweenness / max(V(WS_ipbesforen)$betweenness)+ 0.5
V(WS_ipbesforen)$color[V(WS_ipbesforen)$type == "workshop"] <- rgb(69,121,163,max=255)
V(WS_ipbesforen)$color[V(WS_ipbesforen)$type == "institution"] <- "light grey"
V(WS_ipbesforen)$color[V(WS_ipbesforen)$type == "institution"] <- "light grey" # Institution in FN
E(WS_ipbesforen)$color <- "light grey" #rgb(173,198,70,max=255)

lyout_WS_ipbesforen <- layout.fruchterman.reingold(WS_ipbesforen)

plot(WS_ipbesforen, vertex.size = V(WS_ipbesforen)$vertex.size, vertex.color = farben_ipbesforen,
     vertex.label = V(WS_ipbesforen)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_ipbesforen)
plot(WS_ipbesforen, vertex.size = 3, vertex.color = farben_ipbesforen,
     vertex.label = NA, vertex.label.family = "Calibri",
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_ipbesforen)

## Plotten 2
V(WS_ipbesforen)$vertex.size <- 3 * V(WS_ipbesforen)$degree / max(V(WS_ipbesforen)$degree) + 5
V(WS_ipbesforen)$label.cex <- 1.5 * V(WS_ipbesforen)$betweenness / max(V(WS_ipbesforen)$betweenness)+ 0.5
V(WS_ipbesforen)$color[V(WS_ipbesforen)$type == "workshop"] <- "dark grey"
V(WS_ipbesforen)$color[V(WS_ipbesforen)$kategorie == "Wissenschaft"] <- rgb(92,139,255,max=255)
V(WS_ipbesforen)$color[V(WS_ipbesforen)$kategorie == "Behoerde"] <- rgb(219,174,0,max=255)
V(WS_ipbesforen)$color[V(WS_ipbesforen)$kategorie == "Wirtschaft"] <- rgb(11,33,94,max=255)
V(WS_ipbesforen)$color[V(WS_ipbesforen)$kategorie == "Verbaende"] <- rgb(0,155,68,max=255)
V(WS_ipbesforen)$color[V(WS_ipbesforen)$kategorie == "Medien"] <- rgb(180,33,0,max=255)
V(WS_ipbesforen)$color[V(WS_ipbesforen)$kategorie == "keine Angabe"] <- rgb(255,161,213,max=255)
E(WS_ipbesforen)$color <- "light grey"

plot(WS_ipbesforen, vertex.size = V(WS_ipbesforen)$vertex.size, vertex.color = V(WS_ipbesforen)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS_ipbesforen)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_ipbesforen)

par(mfrow=c(1,2))
plot(WS_ipbesforen, vertex.size = V(WS_ipbesforen)$vertex.size, vertex.color = farben_ipbesforen,
     vertex.label = V(WS_ipbesforen)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_ipbesforen)
plot(WS_ipbesforen, vertex.size = V(WS_ipbesforen)$vertex.size, vertex.color = V(WS_ipbesforen)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS_ipbesforen)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_ipbesforen)     
```
```{r SNA Nationale IPBES-Foren, eval=FALSE}
ntw_WS_ipbesforen <- network::network(Gdata_WS_ipbesforen)
summary(ntw_WS_ipbesforen)
igraph::graph.density(igraph::graph.incidence(Gdata_WS_ipbesforen))

round(sna::betweenness(ntw_WS_ipbesforen))
betw_values_WS_ipbesforen <- data.frame(betweenness = round(sna::betweenness(ntw_WS_ipbesforen)), actor_abbr = c(row.names(Gdata_WS_ipbesforen), c("1", "2", "3", "4", "5", "6")), kat = c(Gdata_WS_ipbesforen_K, nodes_ipbesforen[c(1:6),5]))
betw_values_WS_ipbesforen <- sort(betw_values_WS_ipbesforen, decreasing = T)
xlsx::write.xlsx(betw_values_WS_ipbesforen, file = "Workshops_ipbesforen_betweenness.xls")

```

### NeFo-Workshops
```{r Deskriptive Analyse, eval=FALSE}
Gdata_WS_nefo$Name <- as.character(Gdata_WS_nefo$Name)
Gdata_WS_nefo$Inst <- as.character(Gdata_WS_nefo$Inst)
Gdata_WS_nefo$Land <- as.character(Gdata_WS_nefo$Land)
Gdata_WS_nefo$Kategorie <- as.character(Gdata_WS_nefo$Kategorie)
columnno <- c(5:ncol(Gdata_WS_nefo))
for (c in columnno){
  Gdata_WS_nefo[,c] <- as.numeric.factor(Gdata_WS_nefo[,c])
  }
rm(columnno, c)

rowno <- c(1:nrow(Gdata_WS_nefo))
for (r in rowno){
  if ((Gdata_WS_nefo[r,2] == "keine Angabe") & (Gdata_WS_nefo[r,3] == "keine Angabe")){
    Gdata_WS_nefo[r,3] <- "Deutschland"}
  if (Gdata_WS_nefo[r,4] == "Beh?rde"){
    Gdata_WS_nefo[r,4] <- "Behoerde"}
  if (Gdata_WS_nefo[r,4] == "Verb?nde"){
    Gdata_WS_nefo[r,4] <- "Verbaende"}
}
rm(rowno, r)
Gdata_WS_nefo <- subset(Gdata_WS_nefo, Gdata_WS_nefo$Land == "Deutschland")
Gdata_WS_nefo <- Gdata_WS_nefo[order(Gdata_WS_nefo$Inst, Gdata_WS_nefo$Name),]
Gdata_WS_nefo$overview <- apply(Gdata_WS_nefo[,c(5:ncol(Gdata_WS_nefo))],1,paste,collapse="-")
Gdata_WS_nefo <- Gdata_WS_nefo[-c(which(Gdata_WS_nefo$overview == paste(replicate((ncol(Gdata_WS_nefo)-5), "0"), collapse = "-"))),]
Gdata_WS_nefo <- Gdata_WS_nefo[,-ncol(Gdata_WS_nefo)]

selbststaendig_alt <- c(which(Gdata_WS_nefo$Inst == "Selbstst?ndig"))
selbststaendig <- c(1:length(selbststaendig_alt))
selbststaendig_nefo <- c(paste("Selbstst?ndig", selbststaendig, sep=" "))
keineangabe_alt <- c(which(Gdata_WS_nefo$Inst == "keine Angabe"))
keineangabe <- c(1:length(keineangabe_alt))
keineangabe_nefo <- c(paste("keine Angabe", keineangabe, sep=" "))
for (r in selbststaendig_alt){
  Gdata_WS_nefo[r,2] <- selbststaendig_nefo[which(selbststaendig_alt == r)]}
for (k in keineangabe_alt){
  Gdata_WS_nefo[k,2] <- keineangabe_nefo[which(keineangabe_alt == k)]}
rm(r, k, selbststaendig, selbststaendig_alt, keineangabe, keineangabe_alt)

length(unique(Gdata_WS_nefo$Name)) # Anzahl Teilnehmer_innen: 760
length(unique(Gdata_WS_nefo$Inst)) # Anzahl Institutionen: 288
length(unique(Gdata_WS_nefo[duplicated(Gdata_WS_nefo$Name),]$Name)) # Anzahl Teilnehmer_innen mit verschiedenen Inst: 22

# Anzahl Personen pro Kategorie
length(unique(Gdata_WS_nefo$Name[which(Gdata_WS_nefo$Kategorie == "Wissenschaft")])) #484
length(unique(Gdata_WS_nefo$Name[which(Gdata_WS_nefo$Kategorie == "Behoerde")])) #103
length(unique(Gdata_WS_nefo$Name[which(Gdata_WS_nefo$Kategorie == "Wirtschaft")])) #77
length(unique(Gdata_WS_nefo$Name[which(Gdata_WS_nefo$Kategorie == "Verbaende")])) #63
length(unique(Gdata_WS_nefo$Name[which(Gdata_WS_nefo$Kategorie == "Medien")])) #8
length(unique(Gdata_WS_nefo$Name[which(Gdata_WS_nefo$Kategorie == "keine Angabe")])) #35
770-760 # Anzahl Personen, die mit Inst-Wechsel auch Kat-Wechsel hatten: 10

# Anzahl Institutionen pro Kategorie
length(unique(Gdata_WS_nefo$Inst[which(Gdata_WS_nefo$Kategorie == "Wissenschaft")])) #108
length(unique(Gdata_WS_nefo$Inst[which(Gdata_WS_nefo$Kategorie == "Behoerde")])) #39
length(unique(Gdata_WS_nefo$Inst[which(Gdata_WS_nefo$Kategorie == "Wirtschaft")])) #55
length(unique(Gdata_WS_nefo$Inst[which(Gdata_WS_nefo$Kategorie == "Verbaende")])) #44
length(unique(Gdata_WS_nefo$Inst[which(Gdata_WS_nefo$Kategorie == "Medien")])) #7
length(unique(Gdata_WS_nefo$Inst[which(Gdata_WS_nefo$Kategorie == "keine Angabe")])) #35

# Kategorien prozentual
round(100/288*108, digits = 0) #38
round(100/288*39, digits = 0) #14
round(100/288*55, digits = 0) #19
round(100/288*44, digits = 0) #15
round(100/288*7, digits = 0) #2
round(100/288*35, digits = 0) #12

colno <- c(5:ncol(Gdata_WS_nefo))
WS_nefo_TN  <- 0
for (c in colno){
  WS_nefo_TN <- WS_nefo_TN + sum(as.numeric(Gdata_WS_nefo[,c]))
}
rm(colno, c)
WS_nefo_TN # Summe Teilnehmende an NeFo-Workshops: 1163
WS_nefo_TN/37 # Durchschnitt der Anzahl Teilnehmender: 31
```
```{r Transformation f?r Visualisierung, eval=FALSE}
WS_nefo_institutions <- c(paste(sort(unique(Gdata_WS_nefo$Inst))))
Gdata_WS_nefo_institutions <- Gdata_WS_nefo[-c(1:nrow(Gdata_WS_nefo)),]
for (i in WS_nefo_institutions){
  inst <- subset(Gdata_WS_nefo, Gdata_WS_nefo$Inst == i)
  inst <- rbind(inst,
                c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                  sum(inst[,5]),sum(inst[,6]),sum(inst[,7]),
                  sum(inst[,8]),sum(inst[,9]),sum(inst[,10]),sum(inst[,11]),
                  sum(inst[,12]),sum(inst[,13]),sum(inst[,14]),sum(inst[,15]),
                  sum(inst[,16]),sum(inst[,17]),sum(inst[,18]),sum(inst[,19]),
                  sum(inst[,20]),sum(inst[,21]),sum(inst[,22]),sum(inst[,23]),
                  sum(inst[,24]),sum(inst[,25]),sum(inst[,26]),sum(inst[,27]),
                  sum(inst[,28]),sum(inst[,29]),sum(inst[,30]),sum(inst[,31]),
                  sum(inst[,32]),sum(inst[,33]),sum(inst[,34]),sum(inst[,35]),
                  sum(inst[,36]),sum(inst[,37]),sum(inst[,38]),sum(inst[,39]),
                  sum(inst[,40]), sum(inst[,41])),
                stringsAsFactors = FALSE)
  Gdata_WS_nefo_institutions <- rbind(Gdata_WS_nefo_institutions, inst[nrow(inst),])
}
rownames(Gdata_WS_nefo_institutions) <- Gdata_WS_nefo_institutions[,2] #Inst as rownames
Gdata_WS_nefo_K <- as.character(Gdata_WS_nefo_institutions$Kategorie)
Gdata_WS_nefo <- Gdata_WS_nefo_institutions[,-c(1:4)]
Gdata_WS_nefo_institutions <- WS_nefo_institutions
rm(inst, i, WS_nefo_institutions)
```
```{r Visualisierung, eval=FALSE}
# edgelist
## nodes
w1 <- colnames(Gdata_WS_nefo[1:ncol(Gdata_WS_nefo)])
w2 <- rownames(Gdata_WS_nefo)
w3 <- c(paste("ws", c(1:ncol(Gdata_WS_nefo)), sep = ""))
w4 <- c(paste("inst", c(1:nrow(Gdata_WS_nefo)), sep = ""))
w5 <- c(w3, w4)
w6 <- c(w1, w2)
nodes <- as.data.frame(cbind(w5, w6))
names(nodes) <- c("id", "name")
nodes$type_no <- NA
nodes[c(1:ncol(Gdata_WS_nefo)),3] <- 1
nodes[c((ncol(Gdata_WS_nefo)+1):nrow(nodes)),3] <- 2
nodes$type <- NA
nodes[c(1:ncol(Gdata_WS_nefo)),4] <- "workshop"
nodes[c((ncol(Gdata_WS_nefo)+1):nrow(nodes)),4] <- "institution"
nodes$kategorie <- NA
nodes[c(1:ncol(Gdata_WS_nefo)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] %in% nodes[c(1:ncol(Gdata_WS_nefo)),2])]
nodes[c((ncol(Gdata_WS_nefo)+1):nrow(nodes)),5] <- Gdata_WS_nefo_K
#nodes$weight <- NA
nodes$id <- as.character(nodes$id)
nodes$name <- as.character(nodes$name)

nodes$name[which(nodes$name %in% selbststaendig_nefo)] <- "Selbstst?ndig"
nodes$name[which(nodes$name %in% keineangabe_nefo)] <- "k.A."

## links
columns_Gdata <- c(1:ncol(Gdata_WS_nefo))
rows_Gdata <- c(1:nrow(Gdata_WS_nefo))
links <- data.frame(from=character(), to=character(), type=character(), no_participants=numeric(),
                        stringsAsFactors = FALSE)
for (c in columns_Gdata){
  for (r in rows_Gdata){
    if (Gdata_WS_nefo[r,c]!=0){
      links <- rbind(links,
                     c(w3[c], w4[r], "participated", Gdata_WS_nefo[r,c]),
                     stringsAsFactors = FALSE)
    } else {}
  }
}
colnames(links) <- c("from", "to", "type", "no_participants")
links$no_participants <- as.numeric(links$no_participants)

nodes_nefo <- nodes
links_nefo <- links
rm(w1, w2, w3, w4, w5, w6, columns_Gdata, rows_Gdata, c, r, nodes, links)


# Visualisierung
library(igraph)
library(RColorBrewer)

## Erstellen des Graph-Objektes
WS_nefo <- graph_from_data_frame(d = links_nefo, vertices = nodes_nefo, directed = F)
WS_nefo <- delete.isolates(WS_nefo) ### deleting isolates

## Berechnung statistischer Werte
V(WS_nefo)$degree <- degree(WS_nefo)
V(WS_nefo)$betweenness <- betweenness(WS_nefo, directed = F)

## Berechnung einer Farbpalette
coul6 <- brewer.pal(6, "YlOrBr")
palette_nefo <- as.numeric(degree(WS_nefo))  # Farbpalette entsprechend vertex.size
palette_nefo[which(palette_nefo == 1)] <- 1
palette_nefo[which(palette_nefo %in% c(2:5))] <- 2
palette_nefo[palette_nefo %in% c(6:10)] <- 3
palette_nefo[palette_nefo %in% c(11:15)] <- 4
palette_nefo[palette_nefo %in% c(16:20)] <- 5
palette_nefo[palette_nefo > 20] <- 6
farben_nefo <- coul6[palette_nefo]
farben_nefo[1:37] <- "dark grey"

## Plotten 1
V(WS_nefo)$vertex.size <- 3 * V(WS_nefo)$degree / max(V(WS_nefo)$degree) + 5
V(WS_nefo)$label.cex <- 1.5 * V(WS_nefo)$betweenness / max(V(WS_nefo)$betweenness)+ 0.5
V(WS_nefo)$color[V(WS_nefo)$type == "workshop"] <- rgb(69,121,163,max=255)
V(WS_nefo)$color[V(WS_nefo)$type == "institution"] <- "light grey"
V(WS_nefo)$color[V(WS_nefo)$type == "institution"] <- "light grey" # Institution in FN
E(WS_nefo)$color <- "light grey" #rgb(173,198,70,max=255)

V(WS_nefo)$namecover <- V(WS_nefo)$name
V(WS_nefo)$namecover[1:37] <- NA
V(WS_nefo)$framecolorcover <- NA
V(WS_nefo)$framecolorcover[1:37] <- "black"

lyout_WS_nefo <- layout.fruchterman.reingold(WS_nefo)

plot(WS_nefo, vertex.size = V(WS_nefo)$vertex.size, vertex.color = farben_nefo,
     vertex.label = V(WS_nefo)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefo)
plot(WS_nefo, vertex.size = 3, vertex.color = farben_nefo,
     vertex.label = NA, vertex.label.family = "Calibri",
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefo)
plot(WS_nefo, vertex.size = V(WS_nefo)$vertex.size, vertex.color = farben_nefo,
     vertex.label = V(WS_nefo)$namecover, vertex.label.family = "Calibri",
     vertex.frame.color = V(WS_nefo)$framecolorcover, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefo)

## Plotten 2
V(WS_nefo)$vertex.size <- 3 * V(WS_nefo)$degree / max(V(WS_nefo)$degree) + 5
V(WS_nefo)$label.cex <- 1.5 * V(WS_nefo)$betweenness / max(V(WS_nefo)$betweenness)+ 0.5
V(WS_nefo)$color[V(WS_nefo)$type == "workshop"] <- "dark grey"
V(WS_nefo)$color[V(WS_nefo)$kategorie == "Wissenschaft"] <- rgb(92,139,255,max=255)
V(WS_nefo)$color[V(WS_nefo)$kategorie == "Behoerde"] <- rgb(219,174,0,max=255)
V(WS_nefo)$color[V(WS_nefo)$kategorie == "Wirtschaft"] <- rgb(11,33,94,max=255)
V(WS_nefo)$color[V(WS_nefo)$kategorie == "Verbaende"] <- rgb(0,155,68,max=255)
V(WS_nefo)$color[V(WS_nefo)$kategorie == "Medien"] <- rgb(180,33,0,max=255)
V(WS_nefo)$color[V(WS_nefo)$kategorie == "keine Angabe"] <- rgb(255,161,213,max=255)
E(WS_nefo)$color <- "light grey"

plot(WS_nefo, vertex.size = V(WS_nefo)$vertex.size, vertex.color = V(WS_nefo)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefo)

par(mfrow=c(1,2))
plot(WS_nefo, vertex.size = V(WS_nefo)$vertex.size, vertex.color = farben_nefo,
     vertex.label = V(WS_nefo)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefo)
plot(WS_nefo, vertex.size = V(WS_nefo)$vertex.size, vertex.color = V(WS_nefo)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefo)

####
#ceb <- cluster_edge_betweenness(WS_nefo)
#dendPlot(ceb, mode="hclust")
#plot(ceb, WS_nefo)
#length(ceb)
#sort(membership(ceb))
```
```{r SNA, eval=FALSE}
ntw_WS_nefo <- network::network(Gdata_WS_nefo)
summary(ntw_WS_nefo)
igraph::graph.density(igraph::graph.incidence(Gdata_WS_nefo))

round(sna::betweenness(ntw_WS_nefo))
betw_values_WS_nefo <- data.frame(betweenness = round(sna::betweenness(ntw_WS_nefo)), actor_abbr = c(row.names(Gdata_WS_nefo), names(Gdata_WS_nefo)), kat = c(Gdata_WS_nefo_K, nodes_nefo[c(1:37),5]))
betw_values_WS_nefo <- sort(betw_values_WS_nefo, decreasing = T)
xlsx::write.xlsx(betw_values_WS_nefo, file = "Workshops_nefo_betweenness.xls")

```

### NeFo-Workshops biodiv
```{r Deskriptive Analyse, eval=FALSE}
Gdata_WS_nefobiodiv$Name <- as.character(Gdata_WS_nefobiodiv$Name)
Gdata_WS_nefobiodiv$Inst <- as.character(Gdata_WS_nefobiodiv$Inst)
Gdata_WS_nefobiodiv$Land <- as.character(Gdata_WS_nefobiodiv$Land)
Gdata_WS_nefobiodiv$Kategorie <- as.character(Gdata_WS_nefobiodiv$Kategorie)
columnno <- c(5:ncol(Gdata_WS_nefobiodiv))
for (c in columnno){
  Gdata_WS_nefobiodiv[,c] <- as.numeric.factor(Gdata_WS_nefobiodiv[,c])
  }
rm(columnno, c)

rowno <- c(1:nrow(Gdata_WS_nefobiodiv))
for (r in rowno){
  if ((Gdata_WS_nefobiodiv[r,2] == "keine Angabe") & (Gdata_WS_nefobiodiv[r,3] == "keine Angabe")){
    Gdata_WS_nefobiodiv[r,3] <- "Deutschland"}
  if (Gdata_WS_nefobiodiv[r,4] == "Beh?rde"){
    Gdata_WS_nefobiodiv[r,4] <- "Behoerde"}
  if (Gdata_WS_nefobiodiv[r,4] == "Verb?nde"){
    Gdata_WS_nefobiodiv[r,4] <- "Verbaende"}
}
rm(rowno, r)
Gdata_WS_nefobiodiv <- subset(Gdata_WS_nefobiodiv, Gdata_WS_nefobiodiv$Land == "Deutschland")
Gdata_WS_nefobiodiv <- Gdata_WS_nefobiodiv[order(Gdata_WS_nefobiodiv$Inst, Gdata_WS_nefobiodiv$Name),]
Gdata_WS_nefobiodiv$overview <- apply(Gdata_WS_nefobiodiv[,c(5:ncol(Gdata_WS_nefobiodiv))],1,paste,collapse="-")
Gdata_WS_nefobiodiv <- Gdata_WS_nefobiodiv[-c(which(Gdata_WS_nefobiodiv$overview == paste(replicate((ncol(Gdata_WS_nefobiodiv)-5), "0"), collapse = "-"))),]
Gdata_WS_nefobiodiv <- Gdata_WS_nefobiodiv[,-ncol(Gdata_WS_nefobiodiv)]

selbststaendig_alt <- c(which(Gdata_WS_nefobiodiv$Inst == "Selbstst?ndig"))
selbststaendig <- c(1:length(selbststaendig_alt))
selbststaendig_nefobiodiv <- c(paste("Selbstst?ndig", selbststaendig, sep=" "))
keineangabe_alt <- c(which(Gdata_WS_nefobiodiv$Inst == "keine Angabe"))
keineangabe <- c(1:length(keineangabe_alt))
keineangabe_nefobiodiv <- c(paste("keine Angabe", keineangabe, sep=" "))
for (r in selbststaendig_alt){
  Gdata_WS_nefobiodiv[r,2] <- selbststaendig_nefobiodiv[which(selbststaendig_alt == r)]}
for (k in keineangabe_alt){
  Gdata_WS_nefobiodiv[k,2] <- keineangabe_nefobiodiv[which(keineangabe_alt == k)]}
rm(r, k, selbststaendig, selbststaendig_alt, keineangabe, keineangabe_alt)

length(unique(Gdata_WS_nefobiodiv$Name)) # Anzahl Teilnehmer_innen: 600
length(unique(Gdata_WS_nefobiodiv$Inst)) # Anzahl Institutionen: 256
length(unique(Gdata_WS_nefobiodiv[duplicated(Gdata_WS_nefobiodiv$Name),]$Name)) # Anzahl Teilnehmer_innen mit verschiedenen Inst: 15

# Anzahl Personen pro Kategorie
length(unique(Gdata_WS_nefobiodiv$Name[which(Gdata_WS_nefobiodiv$Kategorie == "Wissenschaft")])) #369
length(unique(Gdata_WS_nefobiodiv$Name[which(Gdata_WS_nefobiodiv$Kategorie == "Behoerde")])) #77
length(unique(Gdata_WS_nefobiodiv$Name[which(Gdata_WS_nefobiodiv$Kategorie == "Wirtschaft")])) #69
length(unique(Gdata_WS_nefobiodiv$Name[which(Gdata_WS_nefobiodiv$Kategorie == "Verbaende")])) #56
length(unique(Gdata_WS_nefobiodiv$Name[which(Gdata_WS_nefobiodiv$Kategorie == "Medien")])) #7
length(unique(Gdata_WS_nefobiodiv$Name[which(Gdata_WS_nefobiodiv$Kategorie == "keine Angabe")])) #28
606-600 # Anzahl Personen, die mit Inst-Wechsel auch Kat-Wechsel hatten: 6

# Anzahl Institutionen pro Kategorie
length(unique(Gdata_WS_nefobiodiv$Inst[which(Gdata_WS_nefobiodiv$Kategorie == "Wissenschaft")])) #97
length(unique(Gdata_WS_nefobiodiv$Inst[which(Gdata_WS_nefobiodiv$Kategorie == "Behoerde")])) #34
length(unique(Gdata_WS_nefobiodiv$Inst[which(Gdata_WS_nefobiodiv$Kategorie == "Wirtschaft")])) #52
length(unique(Gdata_WS_nefobiodiv$Inst[which(Gdata_WS_nefobiodiv$Kategorie == "Verbaende")])) #39
length(unique(Gdata_WS_nefobiodiv$Inst[which(Gdata_WS_nefobiodiv$Kategorie == "Medien")])) #6
length(unique(Gdata_WS_nefobiodiv$Inst[which(Gdata_WS_nefobiodiv$Kategorie == "keine Angabe")])) #28

# Kategorien prozentual
round(100/256*97, digits = 0) #38
round(100/256*34, digits = 0) #13
round(100/256*52, digits = 0) #20
round(100/256*39, digits = 0) #15
round(100/256*6, digits = 0) #2
round(100/256*28, digits = 0) #11

colno <- c(5:ncol(Gdata_WS_nefobiodiv))
WS_nefobiodiv_TN  <- 0
for (c in colno){
  WS_nefobiodiv_TN <- WS_nefobiodiv_TN + sum(as.numeric(Gdata_WS_nefobiodiv[,c]))
}
rm(colno, c)
WS_nefobiodiv_TN # Summe Teilnehmende an NeFo-Workshops: 766
WS_nefobiodiv_TN/21 # Durchschnitt der Anzahl Teilnehmender: 36
```
```{r Transformation f?r Visualisierung, eval=FALSE}
WS_nefobiodiv_institutions <- c(paste(sort(unique(Gdata_WS_nefobiodiv$Inst))))
Gdata_WS_nefobiodiv_institutions <- Gdata_WS_nefobiodiv[-c(1:nrow(Gdata_WS_nefobiodiv)),]
for (i in WS_nefobiodiv_institutions){
  inst <- subset(Gdata_WS_nefobiodiv, Gdata_WS_nefobiodiv$Inst == i)
  inst <- rbind(inst,
                c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                  sum(inst[,5]),sum(inst[,6]),sum(inst[,7]),
                  sum(inst[,8]),sum(inst[,9]),sum(inst[,10]),sum(inst[,11]),
                  sum(inst[,12]),sum(inst[,13]),sum(inst[,14]),sum(inst[,15]),
                  sum(inst[,16]),sum(inst[,17]),sum(inst[,18]),sum(inst[,19]),
                  sum(inst[,20]),sum(inst[,21]),sum(inst[,22]),sum(inst[,23]),
                  sum(inst[,24]),sum(inst[,25])),
                stringsAsFactors = FALSE)
  Gdata_WS_nefobiodiv_institutions <- rbind(Gdata_WS_nefobiodiv_institutions, inst[nrow(inst),])
}
rownames(Gdata_WS_nefobiodiv_institutions) <- Gdata_WS_nefobiodiv_institutions[,2] #Inst as rownames
Gdata_WS_nefobiodiv_K <- as.character(Gdata_WS_nefobiodiv_institutions$Kategorie)
Gdata_WS_nefobiodiv <- Gdata_WS_nefobiodiv_institutions[,-c(1:4)]
Gdata_WS_nefobiodiv_institutions <- WS_nefobiodiv_institutions
rm(inst, i, WS_nefobiodiv_institutions)
```
```{r Visualisierung, eval=FALSE}
# edgelist
## nodes
w1 <- colnames(Gdata_WS_nefobiodiv[1:ncol(Gdata_WS_nefobiodiv)])
w2 <- rownames(Gdata_WS_nefobiodiv)
w3 <- c(paste("ws", c(1:ncol(Gdata_WS_nefobiodiv)), sep = ""))
w4 <- c(paste("inst", c(1:nrow(Gdata_WS_nefobiodiv)), sep = ""))
w5 <- c(w3, w4)
w6 <- c(w1, w2)
nodes <- as.data.frame(cbind(w5, w6))
names(nodes) <- c("id", "name")
nodes$type_no <- NA
nodes[c(1:ncol(Gdata_WS_nefobiodiv)),3] <- 1
nodes[c((ncol(Gdata_WS_nefobiodiv)+1):nrow(nodes)),3] <- 2
nodes$type <- NA
nodes[c(1:ncol(Gdata_WS_nefobiodiv)),4] <- "workshop"
nodes[c((ncol(Gdata_WS_nefobiodiv)+1):nrow(nodes)),4] <- "institution"
nodes$kategorie <- NA
nodes[c(1:ncol(Gdata_WS_nefobiodiv)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] %in% nodes[c(1:ncol(Gdata_WS_nefobiodiv)),2])]
nodes[c((ncol(Gdata_WS_nefobiodiv)+1):nrow(nodes)),5] <- Gdata_WS_nefobiodiv_K
#nodes$weight <- NA
nodes$id <- as.character(nodes$id)
nodes$name <- as.character(nodes$name)

nodes$name[which(nodes$name %in% selbststaendig_nefobiodiv)] <- "Selbstst?ndig"
nodes$name[which(nodes$name %in% keineangabe_nefobiodiv)] <- "k.A."

## links
columns_Gdata <- c(1:ncol(Gdata_WS_nefobiodiv))
rows_Gdata <- c(1:nrow(Gdata_WS_nefobiodiv))
links <- data.frame(from=character(), to=character(), type=character(), no_participants=numeric(),
                        stringsAsFactors = FALSE)
for (c in columns_Gdata){
  for (r in rows_Gdata){
    if (Gdata_WS_nefobiodiv[r,c]!=0){
      links <- rbind(links,
                     c(w3[c], w4[r], "participated", Gdata_WS_nefobiodiv[r,c]),
                     stringsAsFactors = FALSE)
    } else {}
  }
}
colnames(links) <- c("from", "to", "type", "no_participants")
links$no_participants <- as.numeric(links$no_participants)

nodes_nefobiodiv <- nodes
links_nefobiodiv <- links
rm(w1, w2, w3, w4, w5, w6, columns_Gdata, rows_Gdata, c, r, nodes, links)


# Visualisierung
library(igraph)
library(RColorBrewer)

## Erstellen des Graph-Objektes
WS_nefobiodiv <- graph_from_data_frame(d = links_nefobiodiv, vertices = nodes_nefobiodiv, directed = F)
WS_nefobiodiv <- delete.isolates(WS_nefobiodiv) ### deleting isolates

## Berechnung statistischer Werte
V(WS_nefobiodiv)$degree <- degree(WS_nefobiodiv)
V(WS_nefobiodiv)$betweenness <- betweenness(WS_nefobiodiv, directed = F)

## Berechnung einer Farbpalette
coul6 <- brewer.pal(6, "YlOrBr")
palette_nefobiodiv <- as.numeric(degree(WS_nefobiodiv))  # Farbpalette entsprechend vertex.size
palette_nefobiodiv[which(palette_nefobiodiv == 1)] <- 1
palette_nefobiodiv[which(palette_nefobiodiv %in% c(2:5))] <- 2
palette_nefobiodiv[palette_nefobiodiv %in% c(6:10)] <- 3
palette_nefobiodiv[palette_nefobiodiv %in% c(11:15)] <- 4
palette_nefobiodiv[palette_nefobiodiv %in% c(16:20)] <- 5
palette_nefobiodiv[palette_nefobiodiv > 20] <- 6
farben_nefobiodiv <- coul6[palette_nefobiodiv]
farben_nefobiodiv[1:21] <- "dark grey"

## Plotten 1
V(WS_nefobiodiv)$vertex.size <- 3 * V(WS_nefobiodiv)$degree / max(V(WS_nefobiodiv)$degree) + 5
V(WS_nefobiodiv)$label.cex <- 1.5 * V(WS_nefobiodiv)$betweenness / max(V(WS_nefobiodiv)$betweenness)+ 0.5
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$type == "workshop"] <- rgb(69,121,163,max=255)
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$type == "institution"] <- "light grey"
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$type == "institution"] <- "light grey" # Institution in FN
E(WS_nefobiodiv)$color <- "light grey" #rgb(173,198,70,max=255)

lyout_WS_nefobiodiv <- layout.fruchterman.reingold(WS_nefobiodiv)

plot(WS_nefobiodiv, vertex.size = V(WS_nefobiodiv)$vertex.size, vertex.color = farben_nefobiodiv,
     vertex.label = V(WS_nefobiodiv)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefobiodiv)
plot(WS_nefobiodiv, vertex.size = 3, vertex.color = farben_nefobiodiv,
     vertex.label = NA, vertex.label.family = "Calibri",
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefobiodiv)

## Plotten 2
V(WS_nefobiodiv)$vertex.size <- 3 * V(WS_nefobiodiv)$degree / max(V(WS_nefobiodiv)$degree) + 5
V(WS_nefobiodiv)$label.cex <- 1.5 * V(WS_nefobiodiv)$betweenness / max(V(WS_nefobiodiv)$betweenness)+ 0.5
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$type == "workshop"] <- "dark grey"
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$kategorie == "Wissenschaft"] <- rgb(92,139,255,max=255)
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$kategorie == "Behoerde"] <- rgb(219,174,0,max=255)
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$kategorie == "Wirtschaft"] <- rgb(11,33,94,max=255)
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$kategorie == "Verbaende"] <- rgb(0,155,68,max=255)
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$kategorie == "Medien"] <- rgb(180,33,0,max=255)
V(WS_nefobiodiv)$color[V(WS_nefobiodiv)$kategorie == "keine Angabe"] <- rgb(255,161,213,max=255)
E(WS_nefobiodiv)$color <- "light grey"

plot(WS_nefobiodiv, vertex.size = V(WS_nefobiodiv)$vertex.size, vertex.color = V(WS_nefobiodiv)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS_nefobiodiv)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefobiodiv)

par(mfrow=c(1,2))
plot(WS_nefobiodiv, vertex.size = V(WS_nefobiodiv)$vertex.size, vertex.color = farben_nefobiodiv,
     vertex.label = V(WS_nefobiodiv)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefobiodiv)
plot(WS_nefobiodiv, vertex.size = V(WS_nefobiodiv)$vertex.size, vertex.color = V(WS_nefobiodiv)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS_nefobiodiv)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefobiodiv)
```
```{r SNA, eval=FALSE}
ntw_WS_nefobiodiv <- network::network(Gdata_WS_nefobiodiv)
summary(ntw_WS_nefobiodiv)
igraph::graph.density(igraph::graph.incidence(Gdata_WS_nefobiodiv))

round(sna::betweenness(ntw_WS_nefobiodiv))
betw_values_WS_nefobiodiv <- data.frame(betweenness = round(sna::betweenness(ntw_WS_nefobiodiv)), actor_abbr = c(row.names(Gdata_WS_nefobiodiv), names(Gdata_WS_nefobiodiv)), kat = c(Gdata_WS_nefobiodiv_K, nodes_nefobiodiv[c(1:21),5]))
betw_values_WS_nefobiodiv <- sort(betw_values_WS_nefobiodiv, decreasing = T)
xlsx::write.xlsx(betw_values_WS_nefobiodiv, file = "Workshops_nefobiodiv_betweenness.xls")

```

### NeFo-Workshops ipbes
```{r Deskriptive Analyse, eval=FALSE}
Gdata_WS_nefoipbes$Name <- as.character(Gdata_WS_nefoipbes$Name)
Gdata_WS_nefoipbes$Inst <- as.character(Gdata_WS_nefoipbes$Inst)
Gdata_WS_nefoipbes$Land <- as.character(Gdata_WS_nefoipbes$Land)
Gdata_WS_nefoipbes$Kategorie <- as.character(Gdata_WS_nefoipbes$Kategorie)
columnno <- c(5:ncol(Gdata_WS_nefoipbes))
for (c in columnno){
  Gdata_WS_nefoipbes[,c] <- as.numeric.factor(Gdata_WS_nefoipbes[,c])
  }
rm(columnno, c)

rowno <- c(1:nrow(Gdata_WS_nefoipbes))
for (r in rowno){
  if ((Gdata_WS_nefoipbes[r,2] == "keine Angabe") & (Gdata_WS_nefoipbes[r,3] == "keine Angabe")){
    Gdata_WS_nefoipbes[r,3] <- "Deutschland"}
  if (Gdata_WS_nefoipbes[r,4] == "Beh?rde"){
    Gdata_WS_nefoipbes[r,4] <- "Behoerde"}
  if (Gdata_WS_nefoipbes[r,4] == "Verb?nde"){
    Gdata_WS_nefoipbes[r,4] <- "Verbaende"}
}
rm(rowno, r)
Gdata_WS_nefoipbes <- subset(Gdata_WS_nefoipbes, Gdata_WS_nefoipbes$Land == "Deutschland")
Gdata_WS_nefoipbes <- Gdata_WS_nefoipbes[order(Gdata_WS_nefoipbes$Inst, Gdata_WS_nefoipbes$Name),]
Gdata_WS_nefoipbes$overview <- apply(Gdata_WS_nefoipbes[,c(5:ncol(Gdata_WS_nefoipbes))],1,paste,collapse="-")
Gdata_WS_nefoipbes <- Gdata_WS_nefoipbes[-c(which(Gdata_WS_nefoipbes$overview == paste(replicate((ncol(Gdata_WS_nefoipbes)-5), "0"), collapse = "-"))),]
Gdata_WS_nefoipbes <- Gdata_WS_nefoipbes[,-ncol(Gdata_WS_nefoipbes)]

selbststaendig_alt <- c(which(Gdata_WS_nefoipbes$Inst == "Selbstst?ndig"))
selbststaendig <- c(1:length(selbststaendig_alt))
selbststaendig_nefoipbes <- c(paste("Selbstst?ndig", selbststaendig, sep=" "))
keineangabe_alt <- c(which(Gdata_WS_nefoipbes$Inst == "keine Angabe"))
keineangabe <- c(1:length(keineangabe_alt))
keineangabe_nefoipbes <- c(paste("keine Angabe", keineangabe, sep=" "))
for (r in selbststaendig_alt){
  Gdata_WS_nefoipbes[r,2] <- selbststaendig_nefoipbes[which(selbststaendig_alt == r)]}
for (k in keineangabe_alt){
  Gdata_WS_nefoipbes[k,2] <- keineangabe_nefoipbes[which(keineangabe_alt == k)]}
rm(r, k, selbststaendig, selbststaendig_alt, keineangabe, keineangabe_alt)

length(unique(Gdata_WS_nefoipbes$Name)) # Anzahl Teilnehmer_innen: 243
length(unique(Gdata_WS_nefoipbes$Inst)) # Anzahl Institutionen: 97
length(unique(Gdata_WS_nefoipbes[duplicated(Gdata_WS_nefoipbes$Name),]$Name)) # Anzahl Teilnehmer_innen mit verschiedenen Inst: 10

# Anzahl Personen pro Kategorie
length(unique(Gdata_WS_nefoipbes$Name[which(Gdata_WS_nefoipbes$Kategorie == "Wissenschaft")])) #176
length(unique(Gdata_WS_nefoipbes$Name[which(Gdata_WS_nefoipbes$Kategorie == "Behoerde")])) #34
length(unique(Gdata_WS_nefoipbes$Name[which(Gdata_WS_nefoipbes$Kategorie == "Wirtschaft")])) #12
length(unique(Gdata_WS_nefoipbes$Name[which(Gdata_WS_nefoipbes$Kategorie == "Verbaende")])) #19
length(unique(Gdata_WS_nefoipbes$Name[which(Gdata_WS_nefoipbes$Kategorie == "Medien")])) #1
length(unique(Gdata_WS_nefoipbes$Name[which(Gdata_WS_nefoipbes$Kategorie == "keine Angabe")])) #7
249-243 # Anzahl Personen, die mit Inst-Wechsel auch Kat-Wechsel hatten: 6

# Anzahl Institutionen pro Kategorie
length(unique(Gdata_WS_nefoipbes$Inst[which(Gdata_WS_nefoipbes$Kategorie == "Wissenschaft")])) #49
length(unique(Gdata_WS_nefoipbes$Inst[which(Gdata_WS_nefoipbes$Kategorie == "Behoerde")])) #16
length(unique(Gdata_WS_nefoipbes$Inst[which(Gdata_WS_nefoipbes$Kategorie == "Wirtschaft")])) #7
length(unique(Gdata_WS_nefoipbes$Inst[which(Gdata_WS_nefoipbes$Kategorie == "Verbaende")])) #17
length(unique(Gdata_WS_nefoipbes$Inst[which(Gdata_WS_nefoipbes$Kategorie == "Medien")])) #1
length(unique(Gdata_WS_nefoipbes$Inst[which(Gdata_WS_nefoipbes$Kategorie == "keine Angabe")])) #7

# Kategorien prozentual
round(100/97*49, digits = 0) #51
round(100/97*16, digits = 0) #16
round(100/97*7, digits = 0) #7
round(100/97*17, digits = 0) #18
round(100/97*1, digits = 0) #1
round(100/97*7, digits = 0) #7

colno <- c(5:ncol(Gdata_WS_nefoipbes))
WS_nefoipbes_TN  <- 0
for (c in colno){
  WS_nefoipbes_TN <- WS_nefoipbes_TN + sum(as.numeric(Gdata_WS_nefoipbes[,c]))
}
rm(colno, c)
WS_nefoipbes_TN # Summe Teilnehmende an NeFo-Workshops: 397
WS_nefoipbes_TN/16 # Durchschnitt der Anzahl Teilnehmender: 24
```
```{r Transformation f?r Visualisierung, eval=FALSE}
WS_nefoipbes_institutions <- c(paste(sort(unique(Gdata_WS_nefoipbes$Inst))))
Gdata_WS_nefoipbes_institutions <- Gdata_WS_nefoipbes[-c(1:nrow(Gdata_WS_nefoipbes)),]
for (i in WS_nefoipbes_institutions){
  inst <- subset(Gdata_WS_nefoipbes, Gdata_WS_nefoipbes$Inst == i)
  inst <- rbind(inst,
                c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                  sum(inst[,5]),sum(inst[,6]),sum(inst[,7]),
                  sum(inst[,8]),sum(inst[,9]),sum(inst[,10]),sum(inst[,11]),
                  sum(inst[,12]),sum(inst[,13]),sum(inst[,14]),sum(inst[,15]),
                  sum(inst[,16]),sum(inst[,17]),sum(inst[,18]),sum(inst[,19]),
                  sum(inst[,20])),
                stringsAsFactors = FALSE)
  Gdata_WS_nefoipbes_institutions <- rbind(Gdata_WS_nefoipbes_institutions, inst[nrow(inst),])
}
rownames(Gdata_WS_nefoipbes_institutions) <- Gdata_WS_nefoipbes_institutions[,2] #Inst as rownames
Gdata_WS_nefoipbes_K <- as.character(Gdata_WS_nefoipbes_institutions$Kategorie)
Gdata_WS_nefoipbes <- Gdata_WS_nefoipbes_institutions[,-c(1:4)]
Gdata_WS_nefoipbes_institutions <- WS_nefoipbes_institutions
rm(inst, i, WS_nefoipbes_institutions)
```
```{r Visualisierung, eval=FALSE}
# edgelist
## nodes
w1 <- colnames(Gdata_WS_nefoipbes[1:ncol(Gdata_WS_nefoipbes)])
w2 <- rownames(Gdata_WS_nefoipbes)
w3 <- c(paste("ws", c(1:ncol(Gdata_WS_nefoipbes)), sep = ""))
w4 <- c(paste("inst", c(1:nrow(Gdata_WS_nefoipbes)), sep = ""))
w5 <- c(w3, w4)
w6 <- c(w1, w2)
nodes <- as.data.frame(cbind(w5, w6))
names(nodes) <- c("id", "name")
nodes$type_no <- NA
nodes[c(1:ncol(Gdata_WS_nefoipbes)),3] <- 1
nodes[c((ncol(Gdata_WS_nefoipbes)+1):nrow(nodes)),3] <- 2
nodes$type <- NA
nodes[c(1:ncol(Gdata_WS_nefoipbes)),4] <- "workshop"
nodes[c((ncol(Gdata_WS_nefoipbes)+1):nrow(nodes)),4] <- "institution"
nodes$kategorie <- NA
nodes[c(1:ncol(Gdata_WS_nefoipbes)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] %in% nodes[c(1:ncol(Gdata_WS_nefoipbes)),2])]
nodes[c((ncol(Gdata_WS_nefoipbes)+1):nrow(nodes)),5] <- Gdata_WS_nefoipbes_K # Kategorien des deutschen Subsets
#nodes$weight <- NA
nodes$id <- as.character(nodes$id)
nodes$name <- as.character(nodes$name)

nodes$name[which(nodes$name %in% selbststaendig_nefoipbes)] <- "Selbstst?ndig"
nodes$name[which(nodes$name %in% keineangabe_nefoipbes)] <- "k.A."

## links
columns_Gdata <- c(1:ncol(Gdata_WS_nefoipbes))
rows_Gdata <- c(1:nrow(Gdata_WS_nefoipbes))
links <- data.frame(from=character(), to=character(), type=character(), no_participants=numeric(),
                        stringsAsFactors = FALSE)
for (c in columns_Gdata){
  for (r in rows_Gdata){
    if (Gdata_WS_nefoipbes[r,c]!=0){
      links <- rbind(links,
                     c(w3[c], w4[r], "participated", Gdata_WS_nefoipbes[r,c]),
                     stringsAsFactors = FALSE)
    } else {}
  }
}
colnames(links) <- c("from", "to", "type", "no_participants")
links$no_participants <- as.numeric(links$no_participants)

nodes_nefoipbes <- nodes
links_nefoipbes <- links
rm(w1, w2, w3, w4, w5, w6, columns_Gdata, rows_Gdata, c, r, nodes, links)


# Visualisierung
library(igraph)
library(RColorBrewer)

## Erstellen des Graph-Objektes
WS_nefoipbes <- graph_from_data_frame(d = links_nefoipbes, vertices = nodes_nefoipbes, directed = F)
WS_nefoipbes <- delete.isolates(WS_nefoipbes) ### deleting isolates

## Berechnung statistischer Werte
V(WS_nefoipbes)$degree <- degree(WS_nefoipbes)
V(WS_nefoipbes)$betweenness <- betweenness(WS_nefoipbes, directed = F)

## Berechnung einer Farbpalette
coul6 <- brewer.pal(6, "YlOrBr")
palette_nefoipbes <- as.numeric(degree(WS_nefoipbes))  # Farbpalette entsprechend vertex.size
palette_nefoipbes[which(palette_nefoipbes == 1)] <- 1
palette_nefoipbes[which(palette_nefoipbes %in% c(2:5))] <- 2
palette_nefoipbes[palette_nefoipbes %in% c(6:10)] <- 3
palette_nefoipbes[palette_nefoipbes %in% c(11:15)] <- 4
palette_nefoipbes[palette_nefoipbes %in% c(16:20)] <- 5
palette_nefoipbes[palette_nefoipbes > 20] <- 6
farben_nefoipbes <- coul6[palette_nefoipbes]
farben_nefoipbes[1:16] <- "dark grey"

## Plotten 1
V(WS_nefoipbes)$vertex.size <- 3 * V(WS_nefoipbes)$degree / max(V(WS_nefoipbes)$degree) + 5
V(WS_nefoipbes)$label.cex <- 1.5 * V(WS_nefoipbes)$betweenness / max(V(WS_nefoipbes)$betweenness)+ 0.5
V(WS_nefoipbes)$color[V(WS_nefoipbes)$type == "workshop"] <- rgb(69,121,163,max=255)
V(WS_nefoipbes)$color[V(WS_nefoipbes)$type == "institution"] <- "light grey"
V(WS_nefoipbes)$color[V(WS_nefoipbes)$type == "institution"] <- "light grey" # Institution in FN
E(WS_nefoipbes)$color <- "light grey" #rgb(173,198,70,max=255)

lyout_WS_nefoipbes <- layout.fruchterman.reingold(WS_nefoipbes)

plot(WS_nefoipbes, vertex.size = V(WS_nefoipbes)$vertex.size, vertex.color = farben_nefoipbes,
     vertex.label = V(WS_nefoipbes)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefoipbes)
plot(WS_nefoipbes, vertex.size = 3, vertex.color = farben_nefoipbes,
     vertex.label = NA, vertex.label.family = "Calibri",
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefoipbes)

## Plotten 2
V(WS_nefoipbes)$vertex.size <- 3 * V(WS_nefoipbes)$degree / max(V(WS_nefoipbes)$degree) + 5
V(WS_nefoipbes)$label.cex <- 1.5 * V(WS_nefoipbes)$betweenness / max(V(WS_nefoipbes)$betweenness)+ 0.5
V(WS_nefoipbes)$color[V(WS_nefoipbes)$type == "workshop"] <- "dark grey"
V(WS_nefoipbes)$color[V(WS_nefoipbes)$kategorie == "Wissenschaft"] <- rgb(92,139,255,max=255)
V(WS_nefoipbes)$color[V(WS_nefoipbes)$kategorie == "Behoerde"] <- rgb(219,174,0,max=255)
V(WS_nefoipbes)$color[V(WS_nefoipbes)$kategorie == "Wirtschaft"] <- rgb(11,33,94,max=255)
V(WS_nefoipbes)$color[V(WS_nefoipbes)$kategorie == "Verbaende"] <- rgb(0,155,68,max=255)
V(WS_nefoipbes)$color[V(WS_nefoipbes)$kategorie == "Medien"] <- rgb(180,33,0,max=255)
V(WS_nefoipbes)$color[V(WS_nefoipbes)$kategorie == "keine Angabe"] <- rgb(255,161,213,max=255)
E(WS_nefoipbes)$color <- "light grey"

plot(WS_nefoipbes, vertex.size = V(WS_nefoipbes)$vertex.size, vertex.color = V(WS_nefoipbes)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS_nefoipbes)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefoipbes)

par(mfrow=c(1,2))
plot(WS_nefoipbes, vertex.size = V(WS_nefoipbes)$vertex.size, vertex.color = farben_nefoipbes,
     vertex.label = V(WS_nefoipbes)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefoipbes)
plot(WS_nefoipbes, vertex.size = V(WS_nefoipbes)$vertex.size, vertex.color = V(WS_nefoipbes)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS_nefoipbes)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_nefoipbes)
```
```{r SNA, eval=FALSE}
ntw_WS_nefoipbes <- network::network(Gdata_WS_nefoipbes)
summary(ntw_WS_nefoipbes)
igraph::graph.density(igraph::graph.incidence(Gdata_WS_nefoipbes))

round(sna::betweenness(ntw_WS_nefoipbes))
betw_values_WS_nefoipbes <- data.frame(betweenness = round(sna::betweenness(ntw_WS_nefoipbes)), actor_abbr = c(row.names(Gdata_WS_nefoipbes), names(Gdata_WS_nefoipbes)), kat = c(Gdata_WS_nefoipbes_K, nodes_nefoipbes[c(1:16),5]))
betw_values_WS_nefoipbes <- sort(betw_values_WS_nefoipbes, decreasing = T)
xlsx::write.xlsx(betw_values_WS_nefoipbes, file = "Workshops_nefoipbes_betweenness.xls")

```

### NeFo-Workshops pro Jahr
```{r Deskriptive Analyse, eval=FALSE}
Gdata_WS_jahr$Name <- as.character(Gdata_WS_jahr$Name)
Gdata_WS_jahr$Inst <- as.character(Gdata_WS_jahr$Inst)
Gdata_WS_jahr$Land <- as.character(Gdata_WS_jahr$Land)
Gdata_WS_jahr$Kategorie <- as.character(Gdata_WS_jahr$Kategorie)
columnno <- c(5:ncol(Gdata_WS_jahr))
for (c in columnno){
  Gdata_WS_jahr[,c] <- as.numeric.factor(Gdata_WS_jahr[,c])
  }
rm(columnno, c)

rowno <- c(1:nrow(Gdata_WS_jahr))
for (r in rowno){
  if ((Gdata_WS_jahr[r,2] == "keine Angabe") & (Gdata_WS_jahr[r,3] == "keine Angabe")){
    Gdata_WS_jahr[r,3] <- "Deutschland"}
  if (Gdata_WS_jahr[r,4] == "Beh?rde"){
    Gdata_WS_jahr[r,4] <- "Behoerde"}
  if (Gdata_WS_jahr[r,4] == "Verb?nde"){
    Gdata_WS_jahr[r,4] <- "Verbaende"}
}
rm(rowno, r)
Gdata_WS_jahr <- subset(Gdata_WS_jahr, Gdata_WS_jahr$Land == "Deutschland")
Gdata_WS_jahr <- Gdata_WS_jahr[order(Gdata_WS_jahr$Inst, Gdata_WS_jahr$Name),]
Gdata_WS_jahr$overview <- apply(Gdata_WS_jahr[,c(5:ncol(Gdata_WS_jahr))],1,paste,collapse="-")
Gdata_WS_jahr <- Gdata_WS_jahr[-c(which(Gdata_WS_jahr$overview == paste(replicate((ncol(Gdata_WS_jahr)-5), "0"), collapse = "-"))),]
Gdata_WS_jahr <- Gdata_WS_jahr[,-ncol(Gdata_WS_jahr)]

selbststaendig_alt <- c(which(Gdata_WS_jahr$Inst == "Selbstst?ndig"))
selbststaendig <- c(1:length(selbststaendig_alt))
selbststaendig_jahr <- c(paste("Selbstst?ndig", selbststaendig, sep=" "))
keineangabe_alt <- c(which(Gdata_WS_jahr$Inst == "keine Angabe"))
keineangabe <- c(1:length(keineangabe_alt))
keineangabe_jahr <- c(paste("keine Angabe", keineangabe, sep=" "))
for (r in selbststaendig_alt){
  Gdata_WS_jahr[r,2] <- selbststaendig_jahr[which(selbststaendig_alt == r)]}
for (k in keineangabe_alt){
  Gdata_WS_jahr[k,2] <- keineangabe_jahr[which(keineangabe_alt == k)]}
rm(r, k, selbststaendig, selbststaendig_alt, keineangabe, keineangabe_alt)

length(unique(Gdata_WS_jahr$Name)) # Anzahl Teilnehmer_innen = x
length(unique(Gdata_WS_jahr$Inst)) # Anzahl Institutionen
length(unique(Gdata_WS_jahr[duplicated(Gdata_WS_jahr$Name),]$Name)) # Anzahl Teilnehmer_innen mit verschiedenen Inst

# Anzahl Personen pro Kategorie
length(unique(Gdata_WS_jahr$Name[which(Gdata_WS_jahr$Kategorie == "Wissenschaft")]))
length(unique(Gdata_WS_jahr$Name[which(Gdata_WS_jahr$Kategorie == "Behoerde")]))
length(unique(Gdata_WS_jahr$Name[which(Gdata_WS_jahr$Kategorie == "Wirtschaft")]))
length(unique(Gdata_WS_jahr$Name[which(Gdata_WS_jahr$Kategorie == "Verbaende")]))
length(unique(Gdata_WS_jahr$Name[which(Gdata_WS_jahr$Kategorie == "Medien")]))
length(unique(Gdata_WS_jahr$Name[which(Gdata_WS_jahr$Kategorie == "keine Angabe")]))
# Summe = y
x-y # Anzahl Personen, die mit Inst-Wechsel auch Kat-Wechsel hatten

# Anzahl Institutionen pro Kategorie
length(unique(Gdata_WS_jahr$Inst[which(Gdata_WS_jahr$Kategorie == "Wissenschaft")]))
length(unique(Gdata_WS_jahr$Inst[which(Gdata_WS_jahr$Kategorie == "Behoerde")]))
length(unique(Gdata_WS_jahr$Inst[which(Gdata_WS_jahr$Kategorie == "Wirtschaft")]))
length(unique(Gdata_WS_jahr$Inst[which(Gdata_WS_jahr$Kategorie == "Verbaende")]))
length(unique(Gdata_WS_jahr$Inst[which(Gdata_WS_jahr$Kategorie == "Medien")]))
length(unique(Gdata_WS_jahr$Inst[which(Gdata_WS_jahr$Kategorie == "keine Angabe")]))

# Kategorien prozentual
round(100/288*108, digits = 0) #edit
round(100/288*39, digits = 0) #edit
round(100/288*55, digits = 0) #edit
round(100/288*44, digits = 0) #edit
round(100/288*7, digits = 0) #edit
round(100/288*35, digits = 0) #edit

colno <- c(5:ncol(Gdata_WS_jahr))
WS_jahr_TN  <- 0
for (c in colno){
  WS_jahr_TN <- WS_jahr_TN + sum(as.numeric(Gdata_WS_jahr[,c]))
}
rm(colno, c)
WS_jahr_TN # Summe Teilnehmende an NeFo-Workshops
WS_jahr_TN/n # Durchschnitt der Anzahl Teilnehmender / Anzahl Workshops = n
```
```{r Transformation f?r Visualisierung, eval=FALSE}
WS_jahr_institutions <- c(paste(sort(unique(Gdata_WS_jahr$Inst))))
Gdata_WS_jahr_institutions <- Gdata_WS_jahr[-c(1:nrow(Gdata_WS_jahr)),]
for (i in WS_jahr_institutions){
  inst <- subset(Gdata_WS_jahr, Gdata_WS_jahr$Inst == i)
  inst <- rbind(inst,
                c(paste(inst[1,1]), paste(inst[1,2]), paste(inst[1,3]), paste(inst[1,4]),
                  sum(inst[,5]),sum(inst[,6]),sum(inst[,7]),sum(inst[,8])),#,sum(inst[,9]),sum(inst[,10]),sum(inst[,11]),sum(inst[,12]),sum(inst[,13]),sum(inst[,14]),sum(inst[,15]),sum(inst[,16]),sum(inst[,17]),sum(inst[,18]),sum(inst[,19]),sum(inst[,20]),sum(inst[,21]),sum(inst[,22]),sum(inst[,23]),sum(inst[,24]),sum(inst[,25]),sum(inst[,26]),sum(inst[,27]),sum(inst[,28]),sum(inst[,29]),sum(inst[,30]),sum(inst[,31]),sum(inst[,32]),sum(inst[,33]),sum(inst[,34]),sum(inst[,35]),sum(inst[,36]),sum(inst[,37]),sum(inst[,38]),sum(inst[,39]),sum(inst[,40]), sum(inst[,41])),
                stringsAsFactors = FALSE)
  Gdata_WS_jahr_institutions <- rbind(Gdata_WS_jahr_institutions, inst[nrow(inst),])
}
rownames(Gdata_WS_jahr_institutions) <- Gdata_WS_jahr_institutions[,2] #Inst as rownames
Gdata_WS_jahr_K <- as.character(Gdata_WS_jahr_institutions$Kategorie)
Gdata_WS_jahr <- Gdata_WS_jahr_institutions[,-c(1:4)]
Gdata_WS_jahr_institutions <- WS_jahr_institutions
rm(inst, i, WS_jahr_institutions) 
```
```{r Visualisierung, eval=FALSE}
# edgelist
## nodes
w1 <- colnames(Gdata_WS_jahr[1:ncol(Gdata_WS_jahr)])
w2 <- rownames(Gdata_WS_jahr)
w3 <- c(paste("ws", c(1:ncol(Gdata_WS_jahr)), sep = ""))
w4 <- c(paste("inst", c(1:nrow(Gdata_WS_jahr)), sep = ""))
w5 <- c(w3, w4)
w6 <- c(w1, w2)
nodes <- as.data.frame(cbind(w5, w6))
names(nodes) <- c("id", "name")
nodes$type_no <- NA
nodes[c(1:ncol(Gdata_WS_jahr)),3] <- 1
nodes[c((ncol(Gdata_WS_jahr)+1):nrow(nodes)),3] <- 2
nodes$type <- NA
nodes[c(1:ncol(Gdata_WS_jahr)),4] <- "workshop"
nodes[c((ncol(Gdata_WS_jahr)+1):nrow(nodes)),4] <- "institution"
nodes$kategorie <- NA
nodes[c(1:ncol(Gdata_WS_jahr)),5] <- as.character(WS_info$Kategorie)[which(WS_info[,1] %in% nodes[c(1:ncol(Gdata_WS_jahr)),2])]
nodes[c((ncol(Gdata_WS_jahr)+1):nrow(nodes)),5] <- Gdata_WS_jahr_K
#nodes$weight <- NA
nodes$id <- as.character(nodes$id)
nodes$name <- as.character(nodes$name)

nodes$name[which(nodes$name %in% selbststaendig_jahr)] <- "Selbstst?ndig"
nodes$name[which(nodes$name %in% keineangabe_jahr)] <- "k.A."

## links
columns_Gdata <- c(1:ncol(Gdata_WS_jahr))
rows_Gdata <- c(1:nrow(Gdata_WS_jahr))
links <- data.frame(from=character(), to=character(), type=character(), no_participants=numeric(),
                        stringsAsFactors = FALSE)
for (c in columns_Gdata){
  for (r in rows_Gdata){
    if (Gdata_WS_jahr[r,c]!=0){
      links <- rbind(links,
                     c(w3[c], w4[r], "participated", Gdata_WS_jahr[r,c]),
                     stringsAsFactors = FALSE)
    } else {}
  }
}
colnames(links) <- c("from", "to", "type", "no_participants")
links$no_participants <- as.numeric(links$no_participants)

nodes_jahr <- nodes
links_jahr <- links
rm(w1, w2, w3, w4, w5, w6, columns_Gdata, rows_Gdata, c, r, nodes, links)


# Visualisierung
library(igraph)
library(RColorBrewer)

## Erstellen des Graph-Objektes
WS_jahr <- graph_from_data_frame(d = links_jahr, vertices = nodes_jahr, directed = F)
WS_jahr <- delete.isolates(WS_jahr) ### deleting isolates

## Berechnung statistischer Werte
V(WS_jahr)$degree <- degree(WS_jahr)
V(WS_jahr)$betweenness <- betweenness(WS_jahr, directed = F)

## Berechnung einer Farbpalette
coul6 <- brewer.pal(6, "YlOrBr")
palette_jahr <- as.numeric(degree(WS_jahr))  # Farbpalette entsprechend vertex.size
palette_jahr[which(palette_jahr == 1)] <- 1
palette_jahr[which(palette_jahr %in% c(2:5))] <- 2
palette_jahr[palette_jahr %in% c(6:10)] <- 3
palette_jahr[palette_jahr %in% c(11:15)] <- 4
palette_jahr[palette_jahr %in% c(16:20)] <- 5
palette_jahr[palette_jahr > 20] <- 6
farben_jahr <- coul6[palette_jahr]
farben_jahr[1:ncol(Gdata_WS_jahr)] <- "dark grey"

## Plotten 1
V(WS_jahr)$vertex.size <- 3 * V(WS_jahr)$degree / max(V(WS_jahr)$degree) + 5
V(WS_jahr)$label.cex <- 1.5 * V(WS_jahr)$betweenness / max(V(WS_jahr)$betweenness)+ 0.5
V(WS_jahr)$color[V(WS_jahr)$type == "workshop"] <- rgb(69,121,163,max=255)
V(WS_jahr)$color[V(WS_jahr)$type == "institution"] <- "light grey"
V(WS_jahr)$color[V(WS_jahr)$type == "institution"] <- "light grey" # Institution in FN
E(WS_jahr)$color <- "light grey" #rgb(173,198,70,max=255)

V(WS_jahr)$namecover <- V(WS_jahr)$name
V(WS_jahr)$namecover[1:ncol(Gdata_WS_jahr)] <- NA
V(WS_jahr)$framecolorcover <- NA
V(WS_jahr)$framecolorcover[1:ncol(Gdata_WS_jahr)] <- "black"

lyout_WS_jahr <- layout.fruchterman.reingold(WS_jahr)

plot(WS_jahr, vertex.size = V(WS_jahr)$vertex.size, vertex.color = farben_jahr,
     vertex.label = V(WS_jahr)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_jahr)
plot(WS_jahr, vertex.size = 3, vertex.color = farben_jahr,
     vertex.label = NA, vertex.label.family = "Calibri",
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_jahr)
plot(WS_jahr, vertex.size = V(WS_jahr)$vertex.size, vertex.color = farben_jahr,
     vertex.label = V(WS_jahr)$namecover, vertex.label.family = "Calibri",
     vertex.frame.color = V(WS_jahr)$framecolorcover, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_jahr)

## Plotten 2
V(WS_jahr)$vertex.size <- 3 * V(WS_jahr)$degree / max(V(WS_jahr)$degree) + 5
V(WS_jahr)$label.cex <- 1.5 * V(WS_jahr)$betweenness / max(V(WS_jahr)$betweenness)+ 0.5
V(WS_jahr)$color[V(WS_jahr)$type == "workshop"] <- "dark grey"
V(WS_jahr)$color[V(WS_jahr)$kategorie == "Wissenschaft"] <- rgb(92,139,255,max=255)
V(WS_jahr)$color[V(WS_jahr)$kategorie == "Behoerde"] <- rgb(219,174,0,max=255)
V(WS_jahr)$color[V(WS_jahr)$kategorie == "Wirtschaft"] <- rgb(11,33,94,max=255)
V(WS_jahr)$color[V(WS_jahr)$kategorie == "Verbaende"] <- rgb(0,155,68,max=255)
V(WS_jahr)$color[V(WS_jahr)$kategorie == "Medien"] <- rgb(180,33,0,max=255)
V(WS_jahr)$color[V(WS_jahr)$kategorie == "keine Angabe"] <- rgb(255,161,213,max=255)
E(WS_jahr)$color <- "light grey"

plot(WS_jahr, vertex.size = V(WS_jahr)$vertex.size, vertex.color = V(WS_jahr)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_jahr)

par(mfrow=c(1,2))
plot(WS_jahr, vertex.size = V(WS_jahr)$vertex.size, vertex.color = farben_jahr,
     vertex.label = V(WS_jahr)$name, vertex.label.family = "Calibri",
     vertex.frame.color = NA, vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_jahr)
plot(WS_jahr, vertex.size = V(WS_jahr)$vertex.size, vertex.color = V(WS_jahr)$color,
     vertex.label = NA, vertex.label.family = "Calibri", #V(WS)$name
     vertex.frame.color = "black", vertex.label.color = "black",
     edge.arrow.size = 0,
     layout = lyout_WS_jahr)

```
```{r SNA, eval=FALSE}
ntw_WS_jahr <- network::network(Gdata_WS_jahr)
summary(ntw_WS_jahr)
igraph::graph.density(igraph::graph.incidence(Gdata_WS_jahr))

round(sna::betweenness(ntw_WS_jahr))
betw_values_WS_jahr <- data.frame(betweenness = round(sna::betweenness(ntw_WS_jahr)), actor_abbr = c(row.names(Gdata_WS_jahr), names(Gdata_WS_jahr)), kat = c(Gdata_WS_jahr_K, nodes_jahr[c(1:37),5]))
betw_values_WS_jahr <- sort(betw_values_WS_jahr, decreasing = T)
xlsx::write.xlsx(betw_values_WS_jahr, file = "Workshops_nefo_betweenness.xls")

```



